<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Foso Tycoon — Juego</title>
<style>
  :root{
    --bg:#071026; --panel:#0b1220; --accent:#f59e0b; --muted:#93a3b8;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{
    height:100%;margin:0;font-family:Inter,system-ui,Arial;color:#eef6ff;
    /* Fondo mejorado estilo cielo con nubes suaves y degradé vertical */
    background:
      linear-gradient(180deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 25%),
      radial-gradient(ellipse at top, rgba(255,255,255,0.20) 0%, rgba(0,0,0,0) 60%),
      linear-gradient(180deg, #1291ff 0%, #0a63c4 40%, #092048 100%);
    background-attachment: fixed;
  }
  /* Capa de nubes parallax sutil */
  .bg-clouds::before{
    content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
    background:
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 200"><g fill="%23ffffff" opacity="0.15"><ellipse cx="120" cy="120" rx="120" ry="60"/><ellipse cx="260" cy="100" rx="160" ry="70"/><ellipse cx="480" cy="120" rx="140" ry="60"/><ellipse cx="680" cy="110" rx="180" ry="75"/></g></svg>') repeat-x top/1200px auto;
    animation: cloudsMove 35s linear infinite;
    filter: blur(1px);
  }
  @keyframes cloudsMove{ from{ background-position-x:0; } to{ background-position-x:-1200px; } }
  .wrap{max-width:1200px;margin:18px auto;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:18px}
  header{display:flex;align-items:center;gap:12px}
  header h1{margin:0;font-size:20px}
  .stage{background:linear-gradient(180deg,#071328,#061026);border-radius:12px;padding:18px;display:flex;flex-direction:column;align-items:center;gap:12px;box-shadow:0 12px 30px rgba(0,0,0,0.6)}
  .topRow{width:100%;display:flex;justify-content:space-between;align-items:center}
  .bigCounter{font-size:20px;font-weight:800}
  .metaTiny{font-size:12px;color:var(--muted)}
  .vaperWrap{width:300px;height:360px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .vaperWrap svg{width:72%;height:auto;max-height:90%;cursor:pointer;user-select:none}
  /* Smoke overlay */
  .smoke-layer{position:absolute;inset:0;pointer-events:none;overflow:visible}
  .smoke{position:absolute;width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.6);filter:blur(0.5px);animation:smokeUp 1.2s ease-out forwards;will-change:transform,opacity}
  @keyframes smokeUp{0%{transform:translateY(0) scale(0.8);opacity:.85}100%{transform:translateY(-120px) scale(1.6);opacity:0}}
  /* Shop title fit for long names */
  .shopGrid .shopCard > div[style*="font-weight:700"]{font-size:13px;text-align:center;line-height:1.15}
  .controlsRow{display:flex;gap:10px;width:100%;justify-content:center;flex-wrap:wrap}
  .mata-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.08));color:#eef6ff;font-weight:800;cursor:pointer;box-shadow:0 4px 14px rgba(0,0,0,0.35);transition:transform .15s ease, box-shadow .15s ease, background .2s ease}
  .mata-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(0,0,0,0.45)}
  .mata-btn:active{transform:translateY(0)}
  .mata-btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  .mata-btn[disabled]{opacity:.45;cursor:not-allowed}
  .mata-btn .icon{width:18px;height:18px;stroke:#081018;stroke-width:2;fill:none}
  .icon-16{width:16px;height:16px}
  .icon-20{width:20px;height:20px}
  .social-bar{position:fixed;bottom:14px;left:50%;transform:translateX(-50%);display:flex;gap:12px;padding:8px 12px;background:rgba(8,16,24,0.6);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.08);border-radius:14px;z-index:9998}
  .social-bar a{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:10px;color:#cbd5e1;background:rgba(255,255,255,0.04);transition:background .2s ease, transform .15s ease, color .2s ease}
  .social-bar a:hover{background:rgba(255,255,255,0.1);color:#fff;transform:translateY(-2px)}
  .social-bar svg{width:18px;height:18px;stroke:currentColor;fill:none;stroke-width:2;vector-effect:non-scaling-stroke}
  .panel{background:var(--glass);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .shopGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px;max-height:520px;overflow:auto;padding-right:6px}
  .shopCard{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px;border-radius:8px;display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
  .shopCard img, .shopCard svg{width:72px;height:auto}
  .priceTag{background:rgba(0,0,0,0.25);padding:4px 6px;border-radius:6px;font-weight:700;font-size:13px}
  .icon-sm{width:18px;height:18px;vertical-align:middle}
  .hint{color:var(--muted);font-size:13px}
  footer{grid-column:1/-1;margin-top:10px;text-align:center;color:var(--muted);font-size:13px}
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr;padding:12px}
    .vaperWrap{width:320px;height:420px}
  }
  @media (max-width:600px){
    .wrap{padding:12px}
    header h1{font-size:18px}
    .bigCounter{font-size:18px}
    .vaperWrap{width:280px;height:360px}
    .shopGrid{grid-template-columns:repeat(2,1fr)}
    .social-bar{gap:8px;padding:6px 8px}
    .social-bar a{width:32px;height:32px}
  }
  /* Modal mejorado: glass + bordes suaves + encabezado */
  .modal { position: fixed; inset:0; display:flex; justify-content:center; align-items:center; z-index:9999; background: rgba(3,10,20,0.65); backdrop-filter: blur(6px); }
  .modal.hidden { display:none; }
  .modal-content {
    position: relative;
    background: linear-gradient(180deg, rgba(12,18,30,0.85), rgba(6,10,18,0.85));
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 20px 60px rgba(0,0,0,0.55);
    border-radius: 16px;
    padding: 18px 18px 14px;
    width: min(94%, 980px); max-height: 84vh; overflow: hidden; color: #e7edf6; font-family: Inter, system-ui, Arial;
  }
  .modal-header { display:flex; align-items:center; justify-content:space-between; gap:10px; padding-bottom:10px; border-bottom:1px solid rgba(255,255,255,0.06); }
  .modal-title { font-weight:800; letter-spacing:.2px; }
  .close-btn { display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:8px; cursor:pointer; color:#9fb2c8; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06); }
  .close-btn:hover { background:rgba(255,255,255,0.08); color:#fff; }
  .modal-body { overflow:auto; max-height: calc(84vh - 56px); padding-top:12px; }
.powers-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  gap: 15px;
  margin-top: 20px;
}
.power-card {
  background: #222;
  border: 1px solid #444;
  border-radius: 8px;
  padding: 12px;
  transition: transform 0.2s, box-shadow 0.2s;
}
.power-card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 12px #0ff;
}
.power-card button {
  margin-top: 10px;
  width: 100%;
  padding: 6px;
  background: #0ff;
  border: none;
  border-radius: 6px;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}
.power-card button:disabled {
  background: #444; color:#999; cursor: not-allowed;
}


/* Humo animado */
.smoke {
  position: absolute;
  bottom: 80px; /* punto de salida aprox. del foso */
  left: 50%;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.7);
  transform: translateX(-50%) scale(0.8);
  animation: smokeUp 2.5s ease-out forwards;
  pointer-events: none;
}

@keyframes smokeUp {
  0% {
    transform: translate(-50%, 0) scale(0.8);
    opacity: 0.8;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    transform: translate(-50%, -150px) scale(1.5);
    opacity: 0;
  }
}

.smoke circle {
  fill: lightgray;
  opacity: 0.8;
  animation: rise 3s infinite ease-in-out;
}

.smoke circle:nth-child(2) {
  animation-delay: 1s;
}
.smoke circle:nth-child(3) {
  animation-delay: 2s;
}

@keyframes rise {
  0% {
    transform: translateY(0) scale(0.5);
    opacity: 0;
  }
  20% {
    opacity: 0.8;
  }
  100% {
    transform: translateY(-60px) scale(1.6);
    opacity: 0;
  }
}

.smoke path {
  fill: lightgray;
  opacity: 0.7;
  animation: puff 4s infinite ease-in-out;
}

@keyframes puff {
  0% {
    transform: translateY(0) scale(0.6);
    opacity: 0;
  }
  20% {
    opacity: 0.8;
  }
  100% {
    transform: translateY(-80px) scale(1.8);
    opacity: 0;
  }
}

.smoke ellipse {
  fill: lightgray;
  opacity: 0.7;
  animation: puff 5s infinite ease-in-out;
}

.smoke ellipse:nth-child(2) {
  animation-delay: 1.5s;
}
.smoke ellipse:nth-child(3) {
  animation-delay: 3s;
}

@keyframes puff {
  0%   { transform: translateY(0) scale(0.6); opacity: 0; }
  20%  { opacity: 0.8; }
  100% { transform: translateY(-80px) scale(1.8); opacity: 0; }
}

#autoClickPointer {
  position: absolute;
  width: 24px;         /* más pequeño */
  height: 24px;
  background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23ffffff' d='M3 2l7 18 2-7 7-2z'/><path fill='%23000000' opacity='0.2' d='M10 20l2-7 7-2-9 9z'/></svg>") no-repeat center;
  background-size: contain;
  pointer-events: none;  /* no bloquea nada */
  opacity: 0;
  transform: scale(1);
  transition: transform 0.15s ease, opacity 0.15s ease;
  z-index: 1;           /* por debajo de UI pero encima del foso */
}
#autoClickPointer.active {
  opacity: 0.8;         /* aparece más sutil */
  transform: scale(0.7);
}

.hidden {
  display: none !important;
}

.click-value {
    position: absolute;
    pointer-events: none;
    font-size: 22px;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 5px #ffc107, 0 0 10px #ffc107;
    transition: transform 1s ease-out, opacity 1s ease-out;
}


.notify-dot {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 10px;
  height: 10px;
  background: red;
  border-radius: 50%;
}
.button-wrapper {
  position: relative;
  display: inline-block;
}

/* Achievement Styles */
#achievementsGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 12px;
}

.achievement-card {
    background: var(--panel);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 8px;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.2s ease;
}

.achievement-card.unlocked {
    background: linear-gradient(145deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.02));
    border-color: rgba(245, 158, 11, 0.3);
}

.achievement-icon {
    font-size: 28px;
    flex-shrink: 0;
}

.achievement-card.locked .achievement-icon {
    filter: grayscale(100%);
    opacity: 0.5;
}

.achievement-info h4 {
    margin: 0 0 4px;
    font-size: 14px;
    color: #fff;
}

.achievement-card.locked .achievement-info h4 {
    color: var(--muted);
}

.achievement-info p {
    margin: 0;
    font-size: 12px;
    color: var(--muted);
}

.achievement-card.unlocked .achievement-info p {
    color: #f5b041;
}

/* Wheel Styles */
.wheel-container {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 20px auto;
}

.wheel-pointer {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-top: 35px solid var(--accent);
    z-index: 10;
    filter: drop-shadow(0 -2px 2px rgba(0,0,0,0.5));
}

.wheel {
    list-style: none;
    padding: 0;
    margin: 0;
    position: relative;
    width: 300px;
    height: 300px;
    border-radius: 50%;
    overflow: hidden;
    transition: transform 5s cubic-bezier(0.2, 0.8, 0.2, 1);
    border: 8px solid #1a2a4a;
    box-shadow: 0 0 20px rgba(0,0,0,0.6), inset 0 0 15px rgba(0,0,0,0.4);
}

.wheel .segment {
    overflow: hidden;
    position: absolute;
    top: 0;
    right: 0;
    width: 50%;
    height: 50%;
    transform-origin: 0% 100%;
}

.wheel .segment .text {
    position: absolute;
    left: -100%;
    width: 200%;
    height: 200%;
    text-align: center;
    display: block;
    transform: skewY(45deg) rotate(22.5deg);
    background: var(--color);
    padding-top: 50px;
    font-weight: bold;
    color: white;
    font-size: 14px;
}

/* Mission Styles */
#missionsGrid {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.mission-card {
    background: var(--panel);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 8px;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.mission-info {
    flex-grow: 1;
}

.mission-info h4 {
    margin: 0 0 4px;
    font-size: 14px;
}

.mission-progress-bar {
    width: 100%;
    height: 10px;
    background: rgba(0,0,0,0.3);
    border-radius: 5px;
    overflow: hidden;
    margin-top: 5px;
}

.mission-progress-fill {
    width: 0%;
    height: 100%;
    background: var(--accent);
    transition: width 0.3s ease;
}

.mission-card button {
    flex-shrink: 0;
}

</style>
  <link rel="icon" type="image/png" href="logo%20oficial.png">
  <link rel="apple-touch-icon" href="logo%20oficial.png">
  <meta property="og:image" content="logo%20oficial.png">
</head>
<body>
  <div id="intro-animation" style="position:fixed;inset:0;background:#000;display:flex;justify-content:center;align-items:center;z-index:10000;flex-direction:column;color:white;font-family:Arial,sans-serif;">
    <div id="intro-text1" style="opacity:0;transition:opacity 1s;display:flex;flex-direction:column;align-items:center;">
            <div style="width: 150px; height: 150px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center;">
        <img src="ChatGPT Image 8 de set. del 2025, 12_51_42.png" alt="Sigma Company Logo" style="max-width: 100%; max-height: 100%;">
    </div>
        <h1>Sigma Company Presenta</h1>
    </div>
    <div id="intro-text2" style="opacity:0;transition:opacity 1s;display:none;flex-direction:column;align-items:center;">
            <div style="width: 150px; height: 150px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center;">
        <img src="logo oficial.png" alt="Idle Foso Clicker Logo" style="max-width: 100%; max-height: 100%;">
    </div>
        <h1>Idle Foso Cliker</h1>
    </div>
    <div id="intro-text3" style="opacity:0;transition:opacity 1s;display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600" style="width:90%;max-width:800px;height:auto">
          <defs>
            <radialGradient id="gBg" cx="50%" cy="40%" r="70%">
              <stop offset="0%" stop-color="#111"/>
              <stop offset="100%" stop-color="#000"/>
            </radialGradient>
          </defs>
          <rect width="800" height="600" fill="url(#gBg)"/>
          <polygon points="400,100 500,300 300,300" fill="yellow" stroke="black" stroke-width="5"/>
          <text x="400" y="270" text-anchor="middle" font-size="80" fill="black" font-weight="bold">!</text>
          <text x="400" y="380" text-anchor="middle" font-size="28" fill="white" font-family="Arial" font-weight="bold">FOSO IDLE TYCOON es una obra de ficción.</text>
          <text x="400" y="420" text-anchor="middle" font-size="24" fill="white" font-family="Arial">Fumar y vapear dañan la salud y generan adicción.</text>
          <text x="400" y="460" text-anchor="middle" font-size="22" fill="white" font-family="Arial">Juega de forma responsable.</text>
        </svg>
    </div>
  </div>
  <!-- Pantalla de advertencia mejorada -->
  <div id="advertencia" style="position:fixed;inset:0;background:#000;display:flex;justify-content:center;align-items:center;z-index:9999">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600" style="width:80%;height:auto">
      <defs>
        <radialGradient id="gBg" cx="50%" cy="40%" r="70%">
          <stop offset="0%" stop-color="#111"/>
          <stop offset="100%" stop-color="#000"/>
        </radialGradient>
      </defs>
      <rect width="800" height="600" fill="url(#gBg)"/>
      <polygon points="400,100 500,300 300,300" fill="yellow" stroke="black" stroke-width="5"/>
      <text x="400" y="270" text-anchor="middle" font-size="80" fill="black" font-weight="bold">!</text>
      <text x="400" y="380" text-anchor="middle" font-size="28" fill="white" font-family="Arial" font-weight="bold">FOSO IDLE TYCOON es una obra de ficción.</text>
      <text x="400" y="420" text-anchor="middle" font-size="24" fill="white" font-family="Arial">Fumar y vapear dañan la salud y generan adicción.</text>
      <text x="400" y="460" text-anchor="middle" font-size="22" fill="white" font-family="Arial">Juega de forma responsable.</text>
    </svg>
  </div>
  
  <div class="wrap">
    <div>
      <header>
        <svg width="44" height="44" viewBox="0 0 64 64" aria-hidden>
          <rect x="6" y="6" width="52" height="52" rx="10" fill="#081026" stroke="#f59e0b" stroke-width="2" />
        </svg>
        <div>
          <h1>Foso Tycoon</h1>
          <div class="hint">Haz click en el foso grande; compra fosos desde la tienda (clic en miniaturas).</div>
        </div>
      </header>




      <main style="margin-top:14px">
        <section class="stage">
          <div class="topRow">
            <div>
              <div class="bigCounter">Sigmacoin: <span id="sigTotal">0</span> ΣC</div>
              <div class="metaTiny">Por clic: <span id="perClick">1</span> ΣC • Clicks totales: <span id="totalClicks">0</span></div>
            </div>
            <div class="panel" style="display:flex;align-items:center;gap:8px">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
              <div style="display:flex;flex-direction:column;gap:2px">
                <div style="font-weight:800">Racha: <span id="dailyStreak">0</span> días</div>
                <div class="metaTiny" id="streakHint">Vuelve cada día para aumentar tu racha</div>
              </div>
            </div>
          </div>

          <!-- Vaper grande (click anywhere on SVG) -->
          <div class="vaperWrap" id="vaperWrap" title="Haz click en cualquier parte del foso para generar ΣC">
            <div id="smokeLayer"></div>
            <!-- Ejemplo Foso Básico Tropical (inline SVG) -->
            <svg id="centralFoso" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 260" role="img" aria-label="Foso central">
              <rect x="20" y="20" width="60" height="220" rx="12" ry="12" fill="url(#g1)" stroke="#0b0c2a" stroke-width="3"/>
              <rect x="20" y="0" width="60" height="20" rx="10" ry="10" fill="url(#mouth1)"/>
<!-- Pantalla central -->
<!--rect x="35" y="110" width="30" height="40" rx="4" ry="4" fill="#000" id="centralScreen"/-->
<!-- PANTALLA CENTRAL (dentro del svg centralFoso) -->
<rect x="35" y="100" width="30" height="50" rx="4" ry="4" fill="#000" id="centralScreen"/>
<text id="batteryText" x="50" y="125" font-size="10" fill="#0f0" text-anchor="middle">0%</text>


  <!-- niveles: vamos a usar máscaras para "llenar" o simplemente cambiar color/opacity -->
  <!-- para simplicidad controlamos solo el color/opacity del path según drops -->


<!-- Texto de porcentaje -->




              <defs>
                <linearGradient id="g1" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#f1c40f"/>
                  <stop offset="50%" stop-color="#2ecc71"/>
                  <stop offset="100%" stop-color="#1e3799"/>
                </linearGradient>
                <linearGradient id="mouth1" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#2c2c54"/>
                  <stop offset="100%" stop-color="#000"/>
                </linearGradient>
                <linearGradient id="batteryGrad" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stop-color="#00ff99"/>
                  <stop offset="100%" stop-color="#00a86b"/>
                </linearGradient>
              </defs>
            </svg>
              <div id="autoClickPointer"></div> 
          </div>

         <div class="controlsRow" id="controlsRow">

  <!-- Fila 1 -->
  <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; width:100%">
    <button id="btnPower" class="mata-btn" style="background:#0ea5b7">
      <svg class="icon" viewBox="0 0 24 24"><path d="M12 2v8"/><path d="M5.2 5.2a9 9 0 1 0 12.7 0"/></svg>
      Power
    </button>

    <button id="btnChargeToggle" class="mata-btn" style="background:#00cfff">
      <svg class="icon" viewBox="0 0 24 24"><path d="M13 2 L4 14h6l-1 8 10-12h-7z" fill="currentColor"/></svg>
      <span id="chargeLabel">Cargar</span>
    </button>

    <button id="btnMata" class="mata-btn" style="background:#ef4444">
      <svg class="icon" viewBox="0 0 24 24"><path d="M7 7l10 10M17 7L7 17"/><circle cx="12" cy="12" r="9"/></svg>
      <span id="mataLabel">Mata Foso</span>
    </button>
  </div>

  <!-- Fila 2 -->
  <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; width:100%">
    <button id="btnShop" class="mata-btn" style="background:#facc15">
      <svg class="icon" viewBox="0 0 24 24"><circle cx="9" cy="20" r="1.5"/><circle cx="18" cy="20" r="1.5"/><path d="M3 4h2l2 10h11l2-7H6"/></svg>
      Tienda
    </button>

    <button id="btnRebirth" class="mata-btn" style="background:#a78bfa">
      <svg class="icon" viewBox="0 0 24 24"><path d="M3 10v4h4"/><path d="M21 14v-4h-4"/><path d="M21 10a8 8 0 0 0-13.66-5.66L7 6"/><path d="M3 14a8 8 0 0 0 13.66 5.66L17 18"/></svg>
      Rebirth
    </button>

    <div class="button-wrapper">
      <button id="btnDaily" class="mata-btn">
        <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="16" rx="2"/><path d="M16 3v4M8 3v4M3 11h18"/></svg>
        Regalo Diario
      </button>
      <span id="dotDaily" class="notify-dot hidden"></span>
    </div>

    <div class="button-wrapper">
        <button id="btnWheel" class="mata-btn" style="background:#ff6b6b">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
            <span id="wheelBtnLabel">Ruleta</span>
        </button>
        <span id="dotWheel" class="notify-dot hidden"></span>
    </div>

    <div class="button-wrapper">
      <button id="btnAFK" class="mata-btn" style="background:#8e44ad">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
        Mejoras AFK
      </button>
      <span id="dotAFK" class="notify-dot hidden"></span>
    </div>

    <div class="button-wrapper">
        <button id="btnMissions" class="mata-btn" style="background:#3498db">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="9 17 4 12 9 7"></polyline><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="15 7 20 12 15 17"></polyline></svg>
            <span id="missionsBtnLabel">Misiones</span>
        </button>
        <span id="dotMissions" class="notify-dot hidden"></span>
    </div>
  </div>


  <!-- Fila 3 (alineada a la derecha) -->
  <div style="display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; width:100%">
    <!-- Promo Codes -->
    <div class="panel" style="display:flex; align-items:center; gap:8px; flex:1; max-width:300px">
      <input id="promoInput" placeholder="Código promo" 
             style="flex:1; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.12);
                    background:rgba(255,255,255,0.03); color:#eef6ff"/>
      <button id="promoBtn" class="mata-btn" style="background:#34d399">Canjear</button>
    </div>
        <div class="button-wrapper">
        <button id="btnAchievements" class="mata-btn" style="background:#f59e0b">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>
            Logros
        </button>
        <span id="dotAchievements" class="notify-dot hidden"></span>
    </div>

    <button id="btnConfig" class="mata-btn" style="background:#c084fc">
      <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.11a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.11a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.06 3.3l.06.06a1.65 1.65 0 0 0 1.82.33H8a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.11a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06A2 2 0 1 1 20.7 6.06l-.06.06a1.65 1.65 0 0 0-.33 1.82V8c0 .64.39 1.22 1 1.51.35.17.73.49.73.49"/></svg>
      Configuración
    </button>

  </div>
</div>

<!-- Modal Logros -->
<div id="achievementsModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">🏆 Logros</div>
      <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body" id="achievementsGrid">
      <!-- Los logros se generarán aquí -->
    </div>
  </div>
</div>

<!-- Modal Rebirth -->
<div id="rebirthModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">🔄 Rebirth</div>
      <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <p>Hacer un Rebirth reiniciará tu progreso (ΣC, fosos, mejoras) a cambio de una bonificación permanente en tus ganancias por clic.</p>
      <div id="rebirthInfo" style="background: var(--panel); padding: 12px; border-radius: 8px; margin: 12px 0;">
        <!-- Contenido dinámico aquí -->
      </div>
      <button id="btnConfirmRebirth" class="mata-btn" style="width: 100%; background: #a78bfa; justify-content: center;">
        Confirmar Rebirth
      </button>
    </div>
  </div>
</div>


          <div class="hint">Tienda: clic en la miniatura para equipar/comprar. El central cambia según lo equipado.</div>
        </section>
      </main>
    </div>

    <!-- Right column: tienda con 15 miniaturas -->
    
    <!-- Modal Tienda -->
<div id="shopModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" style="display:flex;align-items:center;gap:8px">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden><path fill="#f59e0b" d="M7 18a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm10 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4ZM5 4h2l2 10h11l2-7H6.2L5.3 4Z"/></svg>
        Tienda — Fositos
      </div>
      <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body">

    <!-- Aquí metemos la tienda -->
    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;align-items:center;gap:8px">
          <!-- Carrito SVG -->
          <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden>
            <path fill="#f59e0b" d="M7 18c-1.1 0-1.99.9-1.99 
            2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 
            0c-1.1 0-1.99.9-1.99 2S15.9 22 17 
            22s2-.9 2-2-.9-2-2-2zM7.16 
            14h9.45c.75 0 1.41-.41 
            1.75-1.03l3.58-6.49c.37-.67-.11-1.48-.88-1.48H6.21L5.27 
            2H2v2h2l3.6 7.59-1.35 
            2.45C5.52 14.37 6.23 15 7.07 
            15h11.93v-2H7.42l.74-1.35z"/>
          </svg>
          <div style="font-weight:800">Tienda — Fositos</div>
        </div>
        <div class="metaTiny">ΣC: <span id="shopSigma">0</span></div>
      </div>

      <div class="shopGrid" id="shopGrid">

      

 
        <div class="shopCard" data-index="0" title="Foso 1: Mango Ice 🥭❄️ (0 ΣC)">
  <div class="metaTiny" style="font-weight:800">Foso 1: Mango Ice 🥭❄️</div>
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g1_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth1_shop)"/>
<!-- Humo del foso central -->
<!-- Humo del foso central (nube más realista) -->
<!-- Humo del foso central (3 óvalos juntos → nube) -->
<g class="smoke">
  <ellipse cx="50" cy="40" rx="18" ry="12" />
  <ellipse cx="65" cy="35" rx="14" ry="10" />
  <ellipse cx="40" cy="35" rx="14" ry="10" />
</g>


    <defs>
      <linearGradient id="g1_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#f1c40f"/><stop offset="50%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#1e3799"/>
      </linearGradient>
      <linearGradient id="mouth1_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 1: Mango Ice 🥭❄️</div>
  <div class="priceTag">0 ΣC</div>
</div>

<!-- 2 -->
<div class="shopCard" data-index="1" title="Foso 2: Strawberry Kiwi 🍓🥝 (200 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g2_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth2_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g2_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff7675"/><stop offset="100%" stop-color="#fd7e14"/></linearGradient>
      <linearGradient id="mouth2_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 2: Strawberry Kiwi 🍓🥝</div>
  <div class="priceTag">200 ΣC</div>
</div>

<!-- 3 -->
<div class="shopCard" data-index="2" title="Foso 3: Blue Razz 🫐💙 (600 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g3_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth3_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g3_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00c6ff"/><stop offset="100%" stop-color="#0072ff"/></linearGradient>
      <linearGradient id="mouth3_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 3: Blue Razz 🫐💙</div>
  <div class="priceTag">600 ΣC</div>
</div>

<!-- 4 -->
<div class="shopCard" data-index="3" title="Foso 4: Watermelon Ice 🍉❄️ (2 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g4_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth4_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g4_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ecf0f1"/><stop offset="100%" stop-color="#95a5a6"/></linearGradient>
      <linearGradient id="mouth4_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 4: Watermelon Ice 🍉❄️</div>
  <div class="priceTag">2 000 ΣC</div>
</div>

<!-- 5 -->
<div class="shopCard" data-index="4" title="Foso 5: Pineapple Coconut 🍍🥥 (6 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g5_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth5_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g5_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffd700"/><stop offset="100%" stop-color="#ffb400"/></linearGradient>
      <linearGradient id="mouth5_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 5: Pineapple Coconut 🍍🥥</div>
  <div class="priceTag">6 000 ΣC</div>
</div>

<!-- 6 -->
<div class="shopCard" data-index="5" title="Foso 6: Grape Ice 🍇❄️ (20 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g6_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth6_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g6_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#9b59b6"/><stop offset="100%" stop-color="#2c003e"/></linearGradient>
      <linearGradient id="mouth6_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 6: Grape Ice 🍇❄️</div>
  <div class="priceTag">20 000 ΣC</div>
</div>

<!-- 7 -->
<div class="shopCard" data-index="6" title="Foso 7: Peach Mango 🍑🥭 (60 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g7_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth7_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g7_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff0000"/><stop offset="100%" stop-color="#000"/></linearGradient>
    <linearGradient id="mouth7_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 7: Peach Mango 🍑🥭</div>
  <div class="priceTag">60 000 ΣC</div>
</div>

<!-- 8 -->
<div class="shopCard" data-index="7" title="Foso 8: Cola Ice 🥤❄️ (200 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g8_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth8_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g8_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#00aaff"/></linearGradient>
    <linearGradient id="mouth8_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 8: Cola Ice 🥤❄️</div>
  <div class="priceTag">200 000 ΣC</div>
</div>

<!-- 9 -->
<div class="shopCard" data-index="8" title="Foso 9: Lychee Rose 🌸🍒 (600 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g9_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth9_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g9_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#145a32"/></linearGradient>
    <linearGradient id="mouth9_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 9: Lychee Rose 🌸🍒</div>
  <div class="priceTag">600 000 ΣC</div>
</div>

<!-- 10 -->
<div class="shopCard" data-index="9" title="Foso 10: Apple Mint 🍏🌿 (2 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g10_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth10_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g10_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff5733"/><stop offset="100%" stop-color="#900c3f"/></linearGradient>
    <linearGradient id="mouth10_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 10: Apple Mint 🍏🌿</div>
  <div class="priceTag">2 000 000 ΣC</div>
</div>

<!-- 11 -->
<div class="shopCard" data-index="10" title="Foso 11: Banana Ice Cream 🍌🍦 (6 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g11_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth11_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g11_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#39ff14"/><stop offset="100%" stop-color="#0ff"/></linearGradient>
    <linearGradient id="mouth11_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 11: Banana Ice Cream 🍌🍦</div>
  <div class="priceTag">6 000 000 ΣC</div>
</div>

<!-- 12 -->
<div class="shopCard" data-index="11" title="Foso 12: Lemon Tart 🍋🥧 (20 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g12_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth12_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g12_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00f5ff"/><stop offset="50%" stop-color="#7f00ff"/><stop offset="100%" stop-color="#00ff88"/></linearGradient>
    <linearGradient id="mouth12_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 12: Lemon Tart 🍋🥧</div>
  <div class="priceTag">20 000 000 ΣC</div>
</div>

<!-- 13 -->
<div class="shopCard" data-index="12" title="Foso 13: Cherry Cola 🍒🥤 (60 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g13_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth13_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g13_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#cd7f32"/><stop offset="100%" stop-color="#6e2c00"/>
      </linearGradient>
      <linearGradient id="mouth13_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 13: Cherry Cola 🍒🥤</div>
  <div class="priceTag">60 000 000 ΣC</div>
</div>

<!-- 14 -->
<div class="shopCard" data-index="13" title="Foso 14: Cotton Candy 🍭 (200 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g14_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth14_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g14_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#85c1e9"/>
      </linearGradient>
      <linearGradient id="mouth14_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 14: Cotton Candy 🍭</div>
  <div class="priceTag">200 000 000 ΣC</div>
</div>

<!-- 15 (especial: cuerpo cambia rojo->azul->verde con animate) -->
<div class="shopCard" data-index="14" title="Foso 15: Black Diamond Reserve 💎🔥 (600 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g15_shop)" stroke="#222" stroke-width="1"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth15_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g15_shop" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="red">
          <animate attributeName="stop-color" values="red;blue;green;red" dur="3s" repeatCount="indefinite"/>
        </stop>
        <stop offset="100%" stop-color="red">
          <animate attributeName="stop-color" values="red;blue;green;red" dur="3s" repeatCount="indefinite"/>
        </stop>
      </linearGradient>
      <linearGradient id="mouth15_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 15: Black Diamond Reserve 💎🔥</div>
  <div class="priceTag">600 000 000 ΣC</div>
</div>

<!-- --- SECCION: Mejoras permanentes --- -->
<div style="grid-column:1/-1; font-weight:800; margin-top:10px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.03)">
  🔧 Mejoras permanentes
</div>

<!-- Upgrade: Batería -->
<div class="shopCard" data-upgrade="battery" title="Aumenta la capacidad máxima de la batería.">
  <div class="metaTiny" style="font-weight:700">Mejorar Batería 🔋</div>
  <div class="priceTag"></div>
</div>

<!-- Upgrade: Auto-clicker -->
<div class="shopCard" data-upgrade="autoclicker" title="Añade clics automáticos por segundo.">
  <div class="metaTiny" style="font-weight:700">Mejorar Autoclicker 🤖</div>
  <div class="priceTag"></div>
</div>


      </div>
    </aside>

    </div>
  </div>
</div>
  </div>
</div>


  
    <footer>
      <div style="display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap">
        <span class="metaTiny">Síguenos:</span>
        <a href="https://instagram.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://tiktok.com/@sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://x.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://facebook.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://youtube.com/@sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
      </div>
      <div class="metaTiny" style="margin-top:6px">Maqueta funcional — HTML/CSS/JS puro. Guardado automático en localStorage.</div>
    </footer>
  </div>
   
  <!-- Modal Poderes -->
<div id="powersModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Poderes</h2>
    <div id="powersGrid" class="powers-grid"></div>
  </div>
</div>

<!-- Modal Configuración -->
<div id="configModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>⚙️ Configuración</h2>

    <div class="config-grid">
      <!-- Tema -->
      <div class="config-item">
        <label for="themeSelect">Tema 🎨</label>
        <select id="themeSelect">
          <option value="dark">Oscuro</option>
          <option value="light">Claro</option>
          <option value="neon">Neón</option>
        </select>
      </div>

      <!-- Animaciones -->
      <div class="config-item">
        <label>
          <input type="checkbox" id="chkAnimations" checked>
          Activar Animaciones ✨
        </label>
      </div>

      <!-- Reset -->
      <div class="config-item">
        <button id="btnReset" style="background:#ff4d4d;color:#fff;padding:8px 14px;border:none;border-radius:6px;cursor:pointer">
          Borrar Progreso 💣
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Modal Recompensas Diarias -->
<div id="dailyModal" class="hidden" style="
  position: fixed; top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.8); display:flex;
  align-items:center; justify-content:center;
  z-index:1000;">

  <div style="background:#111; padding:20px; border-radius:12px;
              max-width:600px; width:90%; text-align:center; color:#fff; position:relative;">

    <span id="closeDaily" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:28px;">&times;</span>
    <h2>🎁 Recompensas Diarias</h2>

    <div id="carousel" style="display:flex; overflow-x:auto; gap:15px; padding:10px;">
      <!-- Tarjetas generadas por JS -->
    </div>

    <button id="btnClaimDaily" style="margin-top:15px; padding:8px 16px; font-weight:bold;">
      Reclamar de hoy
    </button>
  </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" style="
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 9999;
"></div>

<!-- Modal AFK -->
<div id="afkModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>⏰ Mejoras AFK</h2>
    <p id="afkInfo"></p>
    <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
      <button id="btnUpgradeAFK" class="mata-btn">⬆️ Mejorar</button>
      <button id="btnClaimAFK" class="mata-btn">💰 Reclamar</button>
    </div>
  </div>
</div>

<!-- Modal Ruleta -->
<div id="wheelModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">🎡 Ruleta de la Fortuna</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body" style="align-items: center; text-align: center;">
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <div class="wheel"></div>
            </div>
            <button id="btnSpinWheel" class="mata-btn" style="margin-top: 20px; background: var(--accent);">Girar</button>
            <p id="wheelCooldownText" class="metaTiny" style="margin-top: 10px;"></p>
        </div>
    </div>
</div>

<!-- Modal Misiones -->
<div id="missionsModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">🎯 Misiones Diarias</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body" id="missionsGrid">
            <!-- Las misiones se generarán aquí -->
        </div>
    </div>
</div>




<!-- Social bar -->
<nav class="social-bar" aria-label="Redes Sociales">
  <a href="https://x.com/sigmacompanyoficial" target="_blank" rel="noopener" aria-label="X (Twitter)">
    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
      <path d="M3 3l18 18M21 3L3 21"/>
    </svg>
  </a>
  <a href="https://instagram.com/sigmacompanyoficial" target="_blank" rel="noopener" aria-label="Instagram">
    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
      <rect x="3" y="3" width="18" height="18" rx="5"/>
      <circle cx="12" cy="12" r="4"/>
      <circle cx="17" cy="7" r="1"/>
    </svg>
  </a>
  <a href="https://www.tiktok.com/@sigmacompanyoficial" target="_blank" rel="noopener" aria-label="TikTok">
    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
      <path d="M9 3v10.5a3.5 3.5 0 1 1-3.5-3.5"/>
      <path d="M9 6.5c1.2 1.6 3.2 2.6 5.3 2.6v3.2c-2.6 0-4.6-1.1-5.3-2"/>
    </svg>
  </a>
  <a href="https://youtube.com/@sigmacompanyoficial" target="_blank" rel="noopener" aria-label="YouTube">
    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
      <rect x="3" y="6" width="18" height="12" rx="3"/>
      <path d="M11 10l4 2-4 2z" fill="currentColor" stroke="none"/>
    </svg>
  </a>
</nav>

<script>
    // Bloquear scroll y ocultar advertencia tras 3s
    document.documentElement.style.overflow = 'hidden';
    setTimeout(() => {
        const adv = document.getElementById('advertencia');
        if (adv) adv.style.display = 'none';
        document.documentElement.style.overflow = '';
    }, 3000);

  // Intro animation
  const introAnimation = document.getElementById('intro-animation');
  const introText1 = document.getElementById('intro-text1');
  const introText2 = document.getElementById('intro-text2');
  const introText3 = document.getElementById('intro-text3');

  setTimeout(() => {
    introText1.style.opacity = 1;
  }, 500);

  setTimeout(() => {
    introText1.style.opacity = 0;
  }, 2500);

  setTimeout(() => {
    introText1.style.display = 'none';
    introText2.style.display = 'block';
    introText2.style.opacity = 1;
  }, 3500);

  setTimeout(() => {
    introText2.style.opacity = 0;
  }, 5500);

  setTimeout(() => {
    introText2.style.display = 'none';
    introText3.style.display = 'block';
    introText3.style.opacity = 1;
  }, 6500);

  setTimeout(() => {
    introText3.style.opacity = 0;
  }, 8500);

  setTimeout(() => {
    introAnimation.style.display = 'none';
  }, 9500);


    (function() {
        const FOSOS = [{
            id: 1,
            name: 'Foso 1',
            cost: 0,
            perClick: 1
        }, {
            id: 2,
            name: 'Foso 2',
            cost: 200,
            perClick: 2
        }, {
            id: 3,
            name: 'Foso 3',
            cost: 600,
            perClick: 10
        }, {
            id: 4,
            name: 'Foso 4',
            cost: 2000,
            perClick: 100
        }, {
            id: 5,
            name: 'Foso 5',
            cost: 6000,
            perClick: 1000
        }, {
            id: 6,
            name: 'Foso 6',
            cost: 20000,
            perClick: 10000
        }, {
            id: 7,
            name: 'Foso 7',
            cost: 60000,
            perClick: 100000
        }, {
            id: 8,
            name: 'Foso 8',
            cost: 200000,
            perClick: 1000000
        }, {
            id: 9,
            name: 'Foso 9',
            cost: 600000,
            perClick: 10000000
        }, {
            id: 10,
            name: 'Foso 10',
            cost: 2000000,
            perClick: 100000000
        }, {
            id: 11,
            name: 'Foso 11',
            cost: 6000000,
            perClick: 1000000000
        }, {
            id: 12,
            name: 'Foso 12',
            cost: 20000000,
            perClick: 10000000000
        }, {
            id: 13,
            name: 'Foso 13',
            cost: 60000000,
            perClick: 100000000000
        }, {
            id: 14,
            name: 'Foso 14',
            cost: 200000000,
            perClick: 1000000000000
        }, {
            id: 15,
            name: 'Foso 15',
            cost: 600000000,
            perClick: 10000000000000
        }];

        const REBIRTH_LEVELS = [
            { cost: 1000, requiredFosos: 3, bonus: 0.05 }, // +5%
            { cost: 50000, requiredFosos: 6, bonus: 0.10 }, // +10%
            { cost: 1000000, requiredFosos: 9, bonus: 0.15 }, // +15%
        ];

        const DAILY_REWARDS = [
            { type: 'sig', value: 100, label: '100 ΣC' },
            { type: 'sig', value: 250, label: '250 ΣC' },
            { type: 'sig', value: 500, label: '500 ΣC' },
            { type: 'multiplier', value: 2, duration: 300, label: 'x2 Clics (5 min)' },
            { type: 'sig', value: 1000, label: '1000 ΣC' },
            { type: 'sig', value: 2000, label: '2000 ΣC' },
            { type: 'combo', value: { sig: 5000, multiplier: 2, duration: 600 }, label: '5000 ΣC + x2 Clics (10 min)' }
        ];

        const AUTOCLICKER_UPGRADES = [
            { cost: 500, cps: 1 },
            { cost: 2000, cps: 2 },
            { cost: 10000, cps: 5 },
            { cost: 50000, cps: 10 },
            { cost: 250000, cps: 25 },
        ];

        const BATTERY_UPGRADES = [
            { cost: 200, capacity: 120 },
            { cost: 800, capacity: 150 },
            { cost: 3000, capacity: 200 },
            { cost: 15000, capacity: 250 },
            { cost: 75000, capacity: 300 },
        ];

        const AFK_UPGRADES = [
            { cost: 1000, sph: 100 },
            { cost: 5000, sph: 500 },
            { cost: 25000, sph: 2500 },
            { cost: 100000, sph: 10000 },
        ];

        const CONFIG = {
            storageKey: 'foso_tycoon_state_v1',
            autosaveMs: 10000,
            uiTickMs: 1000,
            baseBatteryDrainPerClick: 1,
            overheatCps: 15,
            mataReward: 50,
            mataCooldownSec: 300,
            onEquipRefill: 20,
            rechargeBaseSec: 60
        };

        const ACHIEVEMENTS = {
            CLICK_1: { id: 'CLICK_1', name: "Iniciado", description: "Haz 1 clic.", icon: "👆", reward: "+1% por clic (permanente)" },
            CLICK_100: { id: 'CLICK_100', name: "Clickeador", description: "Haz 100 clics.", icon: "🖱️", reward: "+2% por clic (permanente)" },
            CLICK_1K: { id: 'CLICK_1K', name: "Dedos Ágiles", description: "Haz 1,000 clics.", icon: "🤌", reward: "+3% por clic (permanente)" },
            CLICK_10K: { id: 'CLICK_10K', name: "Profesional del Clic", description: "Haz 10,000 clics.", icon: "🏆", reward: "+5% por clic (permanente)" },
            CLICK_100K: { id: 'CLICK_100K', name: "Deidad del Clic", description: "Haz 100,000 clics.", icon: "🙏", reward: "+10% por clic (permanente)" },

            SIG_1K: { id: 'SIG_1K', name: "Ahorrador", description: "Acumula 1,000 ΣC en total.", icon: "💰", reward: "Gana 500 ΣC extra" },
            SIG_100K: { id: 'SIG_100K', name: "Pudiente", description: "Acumula 100,000 ΣC en total.", icon: "💵", reward: "Gana 5,000 ΣC extra" },
            SIG_1M: { id: 'SIG_1M', name: "Millonario", description: "Acumula 1,000,000 ΣC en total.", icon: "💎", reward: "+5% a las ganancias por clic" },
            SIG_1B: { id: 'SIG_1B', name: "Billonario", description: "Acumula 1,000,000,000 ΣC en total.", icon: "🌌", reward: "+10% a las ganancias por clic" },

            FOSO_5: { id: 'FOSO_5', name: "Coleccionista", description: "Posee 5 fosos diferentes.", icon: "📚", reward: "+10% por clic (permanente)" },
            FOSO_10: { id: 'FOSO_10', name: "Entusiasta", description: "Posee 10 fosos diferentes.", icon: "📖", reward: "+15% por clic (permanente)" },
            FOSO_15: { id: 'FOSO_15', name: "Magnate de Fosos", description: "Posee los 15 fosos.", icon: "👑", reward: "+20% por clic (permanente)" },

            REBIRTH_1: { id: 'REBIRTH_1', name: "Renacido", description: "Realiza tu primer Rebirth.", icon: "🔄", reward: "Bonus de Rebirth +10% extra" },
            REBIRTH_3: { id: 'REBIRTH_3', name: "Iluminado", description: "Alcanza 3 Rebirths.", icon: "✨", reward: "Bonus de Rebirth +20% extra" },
            REBIRTH_5: { id: 'REBIRTH_5', name: "Ascendido", description: "Alcanza 5 Rebirths.", icon: "🌟", reward: "Bonus de Rebirth +30% extra" },

            WHEEL_1: { id: 'WHEEL_1', name: "Afortunado", description: "Gira la ruleta por primera vez.", icon: "🍀", reward: "1 Giro Gratis" },
            WHEEL_10: { id: 'WHEEL_10', name: "Ludópata", description: "Gira la ruleta 10 veces.", icon: "🎡", reward: "Las recompensas de la ruleta son un 10% mejores" },

            MATA_1: { id: 'MATA_1', name: "Impaciente", description: "Usa Mata Foso por primera vez.", icon: "💥", reward: "Mata Foso da 100 ΣC extra" },
            MATA_10: { id: 'MATA_10', name: "Destructor", description: "Usa Mata Foso 10 veces.", icon: "💣", reward: "El cooldown de Mata Foso se reduce en 1 minuto" },

            AFK_1: { id: 'AFK_1', name: "Ingresos Pasivos", description: "Mejora el AFK al nivel 1.", icon: "💤", reward: "+5% de ganancias AFK" },
            AFK_MAX: { id: 'AFK_MAX', name: "Magnate Durmiente", description: "Lleva las mejoras de AFK al máximo.", icon: "😴", reward: "+25% de ganancias AFK" },
        };

        const ACHIEVEMENT_LOGIC = {
            CLICK_1: { condition: s => s.totalClicks >= 1, apply: s => s.perClickMult *= 1.01 },
            CLICK_100: { condition: s => s.totalClicks >= 100, apply: s => s.perClickMult *= 1.02 },
            CLICK_1K: { condition: s => s.totalClicks >= 1000, apply: s => s.perClickMult *= 1.03 },
            CLICK_10K: { condition: s => s.totalClicks >= 10000, apply: s => s.perClickMult *= 1.05 },
            CLICK_100K: { condition: s => s.totalClicks >= 100000, apply: s => s.perClickMult *= 1.10 },
            SIG_1K: { condition: s => s.totalSigEarned >= 1000, apply: s => s.sig += 500 },
            SIG_100K: { condition: s => s.totalSigEarned >= 100000, apply: s => s.sig += 5000 },
            SIG_1M: { condition: s => s.totalSigEarned >= 1000000, apply: s => s.perClickMult *= 1.05 },
            SIG_1B: { condition: s => s.totalSigEarned >= 1000000000, apply: s => s.perClickMult *= 1.10 },
            FOSO_5: { condition: s => s.fososOwned.length >= 5, apply: s => s.perClickMult *= 1.10 },
            FOSO_10: { condition: s => s.fososOwned.length >= 10, apply: s => s.perClickMult *= 1.15 },
            FOSO_15: { condition: s => s.fososOwned.length >= 15, apply: s => s.perClickMult *= 1.20 },
            REBIRTH_1: { condition: s => s.rebirths >= 1, apply: s => s.rebirthBonus += 0.1 },
            REBIRTH_3: { condition: s => s.rebirths >= 3, apply: s => s.rebirthBonus += 0.2 },
            REBIRTH_5: { condition: s => s.rebirths >= 5, apply: s => s.rebirthBonus += 0.3 },
            WHEEL_1: { condition: s => s.wheelSpins >= 1, apply: s => s.wheelLastSpin = 0 },
            WHEEL_10: { condition: s => s.wheelSpins >= 10, apply: s => s.wheelRewardMultiplier = 1.1 },
            MATA_1: { condition: s => s.mataUses >= 1, apply: s => CONFIG.mataReward += 100 },
            MATA_10: { condition: s => s.mataUses >= 10, apply: s => CONFIG.mataCooldownSec -= 60 },
            AFK_1: { condition: s => (s.upgradeLevels.afk || 0) >= 1, apply: s => s.afkMultiplier = 1.05 },
            AFK_MAX: { condition: s => (s.upgradeLevels.afk || 0) >= AFK_UPGRADES.length, apply: s => s.afkMultiplier = 1.25 },
        };

        const MISSION_TYPES = [
            { id: 'click', description: (target) => `Haz ${target} clics.`, reward: (target) => target * 10, unit: 'clics' },
            { id: 'earn', description: (target) => `Gana ${formatNum(target)} ΣC.`, reward: (target) => target / 2, unit: 'ΣC' },
            { id: 'spin', description: (target) => `Gira la ruleta ${target} veces.`, reward: (target) => target * 5000, unit: 'giros' },
            { id: 'buy_foso', description: (target) => `Compra ${target} fosos.`, reward: (target) => target * 10000, unit: 'fosos' },
        ];

        const WHEEL_REWARDS = [
            { label: "1K ΣC", reward: (s) => { const amount = 1000 * (s.wheelRewardMultiplier || 1); s.sig += amount; showToast(`+${formatNum(amount)} ΣC!`, "success"); } },
            { label: "5K ΣC", reward: (s) => { const amount = 5000 * (s.wheelRewardMultiplier || 1); s.sig += amount; showToast(`+${formatNum(amount)} ΣC!`, "success"); } },
            { label: "x2 Clics (1min)", reward: (s) => {
                s.perClickMult *= 2;
                showToast("x2 Clics por 1 minuto!", "success");
                setTimeout(() => {
                    s.perClickMult /= 2;
                    showToast("x2 Clics ha terminado.", "info");
                }, 60000);
            }},
            { label: "Batería Max", reward: (s) => { s.battery = s.maxBattery; showToast("Batería Recargada!", "success"); } },
            { label: "10K ΣC", reward: (s) => { const amount = 10000 * (s.wheelRewardMultiplier || 1); s.sig += amount; showToast(`+${formatNum(amount)} ΣC!`, "success"); } },
            { label: "Nada", reward: (s) => { showToast("¡Más suerte la próxima vez!", "info"); } },
            { label: "25K ΣC", reward: (s) => { const amount = 25000 * (s.wheelRewardMultiplier || 1); s.sig += amount; showToast(`+${formatNum(amount)} ΣC!`, "success"); } },
            { label: "x3 Clics (30s)", reward: (s) => {
                s.perClickMult *= 3;
                showToast("x3 Clics por 30 segundos!", "success");
                setTimeout(() => {
                    s.perClickMult /= 3;
                    showToast("x3 Clics ha terminado.", "info");
                }, 30000);
            }},
        ];

        let state = {
            sig: 0,
            totalClicks: 0,
            totalSigEarned: 0,
            activeFosoIndex: 0,
            fososOwned: [0],
            achievements: {},
            wheelLastSpin: 0,
            dailyMissions: [],
            lastMissionCheck: 0,
            wheelSpins: 0,
            mataUses: 0,
            wheelRewardMultiplier: 1,
            afkMultiplier: 1,
            battery: 100,
            maxBattery: 100,
            burned: false,
            powerOn: true,
            mataCooldownUntil: 0,
            autoClickerLevel: 0,
            autoClickExpiresAt: 0,
            dailyDay: 0,
            rebirths: 0,
            rebirthBonus: 0, // Bonificación porcentual aditiva, 0.05 = +5%
            lastDailyClaim: null,
            afkLevel: 0,
            afkLastClaim: Date.now(),
            afkEarnings: 0,
            lang: 'es',
            powersOwned: {},
            overheatBonus: 0,
            batteryEfficiencyLevel: 0,
            rechargeSpeedLevel: 0,
            perClickMult: 1,
            passivePerSec: 0,
            upgradeLevels: {
                battery: 0,
                autoclicker: 0,
                afk: 0
            },
            extraClicks: 0
        };

        // DOM refs
        const sigTotalEl = document.getElementById('sigTotal');
        const perClickEl = document.getElementById('perClick');
        const totalClicksEl = document.getElementById('totalClicks');
        const shopSigma = document.getElementById('shopSigma');
        const btnMata = document.getElementById('btnMata');
        const mataLabel = document.getElementById('mataLabel');
        const centralFoso = document.getElementById('centralFoso');
        const vaperWrap = document.getElementById('vaperWrap');
        const btnChargeToggle = document.getElementById('btnChargeToggle');
        const chargeLabel = document.getElementById('chargeLabel');
        const batteryText = document.getElementById('batteryText');
        const shopGrid = document.getElementById('shopGrid');
        const btnShop = document.getElementById('btnShop');
        const shopModal = document.getElementById('shopModal');
        const rebirthModal = document.getElementById('rebirthModal');
        const btnRebirth = document.getElementById("btnRebirth");
        const btnConfig = document.getElementById('btnConfig');
        const configModal = document.getElementById('configModal');
        const btnReset = document.getElementById('btnReset');
        const centralScreen = document.getElementById('centralScreen');
        const dailyStreakEl = document.getElementById('dailyStreak');
        const streakHint = document.getElementById('streakHint');
        const btnDaily = document.getElementById('btnDaily');
        const dailyModal = document.getElementById('dailyModal');
        const closeDaily = document.getElementById('closeDaily');
        const btnClaimDaily = document.getElementById('btnClaimDaily');
        const dailyCarousel = document.getElementById('carousel');
        const dotDaily = document.getElementById('dotDaily');
        const btnAFK = document.getElementById('btnAFK');
        const afkModal = document.getElementById('afkModal');
        const btnUpgradeAFK = document.getElementById('btnUpgradeAFK');
        const btnClaimAFK = document.getElementById('btnClaimAFK');
        const afkInfo = document.getElementById('afkInfo');
        const dotAFK = document.getElementById('dotAFK');
        const btnPower = document.getElementById('btnPower');
        const btnAchievements = document.getElementById('btnAchievements');
        const achievementsModal = document.getElementById('achievementsModal');
        const achievementsGrid = document.getElementById('achievementsGrid');
        const dotAchievements = document.getElementById('dotAchievements');
        const btnWheel = document.getElementById('btnWheel');
        const wheelModal = document.getElementById('wheelModal');
        const wheel = document.querySelector('.wheel');
        const btnSpinWheel = document.getElementById('btnSpinWheel');
        const wheelCooldownText = document.getElementById('wheelCooldownText');
        const wheelBtnLabel = document.getElementById('wheelBtnLabel');
        const dotWheel = document.getElementById('dotWheel');
        const btnMissions = document.getElementById('btnMissions');
        const missionsModal = document.getElementById('missionsModal');
        const missionsGrid = document.getElementById('missionsGrid');
        const dotMissions = document.getElementById('dotMissions');

        let isCharging = false;
        let chargeInterval = null;
        let autoClickTimer = null;
        let canClaimDaily = false;
        let nextRewardInterval = null;
        let wheelSpinning = false;

        function generateDailyMissions() {
            state.dailyMissions = [];
            const availableMissions = [...MISSION_TYPES];
            for (let i = 0; i < 3; i++) {
                if (availableMissions.length === 0) break;

                const missionIndex = Math.floor(Math.random() * availableMissions.length);
                const missionType = availableMissions.splice(missionIndex, 1)[0];
                
                let target;
                if (missionType.id === 'click') target = 100 + Math.floor(Math.random() * 900); // 100-1000
                else if (missionType.id === 'earn') target = 1000 + Math.floor(Math.random() * 9000); // 1000-10000
                else if (missionType.id === 'spin') target = 1 + Math.floor(Math.random() * 2); // 1-3
                else if (missionType.id === 'buy_foso') target = 1 + Math.floor(Math.random() * 2); // 1-3

                state.dailyMissions.push({
                    id: missionType.id,
                    description: missionType.description(target),
                    target: target,
                    progress: 0,
                    reward: missionType.reward(target),
                    claimed: false
                });
            }
            state.lastMissionCheck = new Date().setHours(0, 0, 0, 0);
        }

        function checkMissionReset() {
            const today = new Date().setHours(0, 0, 0, 0);
            if (!state.lastMissionCheck || state.lastMissionCheck < today) {
                generateDailyMissions();
            }
        }

        function renderMissions() {
            missionsGrid.innerHTML = '';
            let canClaim = false;
            state.dailyMissions.forEach((mission, index) => {
                const card = document.createElement('div');
                card.className = 'mission-card';
                const progressPercent = Math.min(100, (mission.progress / mission.target) * 100);

                card.innerHTML = `
                    <div class="mission-info">
                        <h4>${mission.description}</h4>
                        <div class="mission-progress-bar">
                            <div class="mission-progress-fill" style="width: ${progressPercent}%;"></div>
                        </div>
                        <p class="metaTiny">Progreso: ${mission.progress} / ${mission.target}</p>
                        <p class="metaTiny">Recompensa: ${formatNum(mission.reward)} ΣC</p>
                    </div>
                    <button class="mata-btn claim-mission-btn" data-index="${index}" ${mission.progress < mission.target || mission.claimed ? 'disabled' : ''}>
                        ${mission.claimed ? 'Reclamado' : 'Reclamar'}
                    </button>
                `;
                missionsGrid.appendChild(card);

                if (progressPercent >= 100 && !mission.claimed) {
                    canClaim = true;
                }
            });

            dotMissions.classList.toggle('hidden', !canClaim);

            document.querySelectorAll('.claim-mission-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const missionIndex = e.target.dataset.index;
                    const mission = state.dailyMissions[missionIndex];
                    if (mission && mission.progress >= mission.target && !mission.claimed) {
                        state.sig += mission.reward;
                        state.totalSigEarned += mission.reward;
                        mission.claimed = true;
                        showToast(`+${formatNum(mission.reward)} ΣC! Misión completada!`, 'success');
                        renderMissions();
                    }
                });
            });
        }

        function updateMissionProgress(missionId, value) {
            if (!state.dailyMissions) return;
            state.dailyMissions.forEach(mission => {
                if (mission.id === missionId && !mission.claimed) {
                    mission.progress += value;
                }
            });
        }

        function checkWheelCooldown() {
            const now = Date.now();
            const cooldown = 20 * 60 * 1000; // 20 minutes
            const timeSinceSpin = now - state.wheelLastSpin;

            if (timeSinceSpin >= cooldown) {
                wheelBtnLabel.textContent = "Ruleta";
                dotWheel.classList.remove('hidden');
                if(wheelCooldownText) wheelCooldownText.textContent = "¡Listo para girar!";
                if(btnSpinWheel) btnSpinWheel.disabled = false;
            } else {
                const remaining = cooldown - timeSinceSpin;
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                const timeStr = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                wheelBtnLabel.textContent = `Ruleta (${timeStr})`;
                dotWheel.classList.add('hidden');
                if(wheelCooldownText) wheelCooldownText.textContent = `Próximo giro en: ${timeStr}`;
                if(btnSpinWheel) btnSpinWheel.disabled = true;
            }
        }

        function spinWheel() {
            if (wheelSpinning) return;

            const now = Date.now();
            const cooldown = 20 * 60 * 1000;
            if (now - state.wheelLastSpin < cooldown) {
                showToast("La ruleta aún está en cooldown.", "info");
                return;
            }

            wheelSpinning = true;
            btnSpinWheel.disabled = true;

            const segmentCount = WHEEL_REWARDS.length;
            const segmentAngle = 360 / segmentCount;
            const randomSegment = Math.floor(Math.random() * segmentCount);
            
            const spinAngle = (360 * 5) - (randomSegment * segmentAngle) - (segmentAngle / 2);

            wheel.style.transition = 'transform 5s cubic-bezier(0.2, 0.8, 0.2, 1)';
            wheel.style.transform = `rotate(${spinAngle}deg)`;

            setTimeout(() => {
                const selectedReward = WHEEL_REWARDS[randomSegment];
                selectedReward.reward(state);
                updateMissionProgress('spin', 1);
                state.wheelSpins = (state.wheelSpins || 0) + 1;
                state.wheelLastSpin = Date.now();
                wheelSpinning = false;
                checkWheelCooldown();
                checkAchievements();
                render();
                
            }, 5000); // Match CSS transition time
        }

        function renderWheel() {
            const wheelEl = document.querySelector('.wheel');
            wheelEl.innerHTML = '';
            const colors = ['#ff6b6b', '#f06595', '#cc5de8', '#845ef7', '#5c7cfa', '#339af0', '#22b8cf', '#20c997'];
            const segmentAngle = 45;

            WHEEL_REWARDS.forEach((reward, i) => {
                const segment = document.createElement('li');
                segment.className = 'segment';
                segment.style.transform = `rotate(${i * segmentAngle}deg) skewY(-45deg)`;

                const text = document.createElement('div');
                text.className = 'text';
                text.textContent = reward.label;
                text.style.setProperty('--color', colors[i % colors.length]);
                
                segment.appendChild(text);
                wheelEl.appendChild(segment);
            });
        }

        function checkAchievements() {
            let newAchievementUnlocked = false;
            for (const id in ACHIEVEMENT_LOGIC) {
                if (!state.achievements[id]) {
                    const logic = ACHIEVEMENT_LOGIC[id];
                    if (logic.condition(state)) {
                        state.achievements[id] = true;
                        logic.apply(state);
                        showToast(`Logro: ${ACHIEVEMENTS[id].name}!`, 'success');
                        newAchievementUnlocked = true;
                    }
                }
            }
            if (newAchievementUnlocked) {
                dotAchievements.classList.remove('hidden');
            }
        }

        function renderAchievements() {
            achievementsGrid.innerHTML = '';
            for (const id in ACHIEVEMENTS) {
                const achievement = ACHIEVEMENTS[id];
                const unlocked = state.achievements[id];

                const card = document.createElement('div');
                card.className = `achievement-card ${unlocked ? 'unlocked' : 'locked'}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-info">
                        <h4>${achievement.name}</h4>
                        <p>${achievement.description}</p>
                        <p style="color: var(--muted); font-style: italic;">Recompensa: ${achievement.reward}</p>
                    </div>
                `;
                achievementsGrid.appendChild(card);
            }
        }

        function saveState() {
            state.lastPlayed = Date.now();
            try {
                localStorage.setItem(CONFIG.storageKey, JSON.stringify(state));
            } catch (e) {
                console.warn('save state err', e);
            }
        }

        function loadState() {
            try {
                const raw = localStorage.getItem(CONFIG.storageKey);
                if (!raw) return;
                const s = JSON.parse(raw);
                Object.assign(state, s);
                if (isNaN(state.battery) || state.battery === null) {
                    state.battery = 100;
                }
                if (!state.upgradeLevels) {
                    state.upgradeLevels = { battery: 0, autoclicker: 0, afk: 0 };
                }
                if (!state.achievements) {
                    state.achievements = {};
                }
                if (!state.wheelLastSpin) {
                    state.wheelLastSpin = 0;
                }
                if (!state.totalSigEarned) {
                    state.totalSigEarned = state.sig;
                }
                if (!state.dailyMissions) {
                    state.dailyMissions = [];
                }
                if (!state.lastMissionCheck) {
                    state.lastMissionCheck = 0;
                }
            } catch (e) {
                console.warn('load state err', e);
            }
        }

        function formatNum(n) {
            if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
            if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
            if (n >= 1e3) return (n / 1e3).toFixed(2) + 'K';
            return Math.floor(n).toString();
        }

        function render() {
            sigTotalEl.textContent = formatNum(state.sig);
            if(shopSigma) shopSigma.textContent = formatNum(state.sig);
            totalClicksEl.textContent = state.totalClicks;
            const basePer = FOSOS[state.activeFosoIndex].perClick; // Ganancia base del foso
            const per = basePer * state.perClickMult * (1 + state.rebirthBonus); // Aplicar multiplicadores y bonus de rebirth
            perClickEl.textContent = formatNum(per);
            if(dailyStreakEl) dailyStreakEl.textContent = state.dailyDay;

            if (batteryText) {
                const maxB = state.maxBattery || 100;
                const percent = Math.floor((Number(state.battery) / maxB) * 100);
                batteryText.textContent = percent + "%" ;
                batteryText.setAttribute("fill", percent > 20 ? "#0f0" : "#f00");
            }

            const now = Date.now();
            if (state.mataCooldownUntil && state.mataCooldownUntil > now) {
                btnMata.disabled = true;
                const sec = Math.ceil((state.mataCooldownUntil - now) / 1000);
                const mm = String(Math.floor(sec / 60)).padStart(2, '0'),
                    ss = String(sec % 60).padStart(2, '0');
                mataLabel.textContent = `Cooldown ${mm}:${ss}`;
            } else {
                btnMata.disabled = false;
                mataLabel.textContent = 'Mata Foso';
            }

            syncCentralAppearance(state.activeFosoIndex);

            if (centralScreen) {
                if (state.burned) {
                    centralScreen.setAttribute('fill', '#6b0000');
                } else {
                    centralScreen.setAttribute('fill', '#000');
                }
            }

            // Update shop items
            shopGrid.querySelectorAll('.shopCard[data-index]').forEach(card => {
                const index = parseInt(card.dataset.index, 10);
                if (state.fososOwned.includes(index)) {
                    card.classList.add('owned');
                    card.querySelector('.priceTag').textContent = 'Adquirido';
                } else {
                    card.classList.remove('owned');
                    card.querySelector('.priceTag').textContent = `${formatNum(FOSOS[index].cost)} ΣC`;
                }
            });

            const autoClickerUpgrade = shopGrid.querySelector('[data-upgrade="autoclicker"]');
            if (autoClickerUpgrade) {
                const level = state.upgradeLevels.autoclicker || 0;
                const nameEl = autoClickerUpgrade.querySelector('.metaTiny');
                nameEl.textContent = `Mejorar Autoclicker 🤖 (Lvl. ${level})`;
                const priceEl = autoClickerUpgrade.querySelector('.priceTag');
                if (level < AUTOCLICKER_UPGRADES.length) {
                    priceEl.textContent = `${formatNum(AUTOCLICKER_UPGRADES[level].cost)} ΣC`;
                } else {
                    priceEl.textContent = 'MAX';
                }
            }

            const batteryUpgrade = shopGrid.querySelector('[data-upgrade="battery"]');
            if (batteryUpgrade) {
                const level = state.upgradeLevels.battery || 0;
                const nameEl = batteryUpgrade.querySelector('.metaTiny');
                nameEl.textContent = `Mejorar Batería 🔋 (Lvl. ${level})`;
                const priceEl = batteryUpgrade.querySelector('.priceTag');
                if (level < BATTERY_UPGRADES.length) {
                    priceEl.textContent = `${formatNum(BATTERY_UPGRADES[level].cost)} ΣC`;
                } else {
                    priceEl.textContent = 'MAX';
                }
            }
        }

        function toggleCharging() {
            if (isCharging) {
                clearInterval(chargeInterval);
                chargeInterval = null;
                isCharging = false;
                chargeLabel.textContent = "Cargar";
            } else {
                isCharging = true;
                chargeLabel.textContent = "Cargando...";
                chargeInterval = setInterval(() => {
                    if (Number(state.battery) < state.maxBattery) {
                        state.battery = Math.min(state.maxBattery, (Number(state.battery) || 0) + 25);
                        render();
                    } else {
                        clearInterval(chargeInterval);
                        chargeInterval = null;
                        isCharging = false;
                        chargeLabel.textContent = "Cargar";
                    }
                }, 1000);
            }
        }

        function showClickAnimation(value, x, y) {
            const anim = document.createElement('div');
            anim.className = 'click-value';
            anim.textContent = `+${formatNum(value)}`;
            const rect = vaperWrap.getBoundingClientRect();
            anim.style.left = `${x - rect.left}px`;
            anim.style.top = `${y - rect.top}px`;
            vaperWrap.appendChild(anim);

            setTimeout(() => {
                anim.style.transform = 'translateY(-50px)';
                anim.style.opacity = '0';
                setTimeout(() => anim.remove(), 1000);
            }, 10);
        }

        function handleCentralClick(e) {
            if (isCharging) {
                showToast('No puedes vapear mientras se está cargando.', "info");
                return;
            }
            if (!state.powerOn) return;
            if (state.burned) {
                showToast('El foso está quemado. Compra/selecciona otro.', "info");
                return;
            }
            if (state.battery <= 0) {
                showToast('Batería agotada.', "info");
                return;
            }
            const basePer = FOSOS[state.activeFosoIndex].perClick; // Ganancia base del foso
            const per = basePer * state.perClickMult * (1 + state.rebirthBonus); // Aplicar multiplicadores y bonus de rebirth
            state.sig += per;
            state.totalSigEarned += per;
            state.totalClicks++;
            updateMissionProgress('click', 1);
            updateMissionProgress('earn', per);
            const drainEff = Math.max(0.2, 1 - (state.activeFosoIndex * 0.05) - ((state.upgradeLevels.battery || 0) * 0.1));
            const drain = CONFIG.baseBatteryDrainPerClick * drainEff;
            state.battery = Math.max(0, state.battery - drain);

            if (e) { // Only show animation for manual clicks
                showClickAnimation(per, e.clientX, e.clientY);
            }

            checkAchievements();
            render();
        }
        
        function syncCentralAppearance(activeIndex){
            const activeCard = shopGrid.querySelector(`.shopCard[data-index="${activeIndex}"]`);
            if(!activeCard) return;
            const cardSvg = activeCard.querySelector('svg');
            const cardDefs = cardSvg ? cardSvg.querySelector('defs') : null;
            const centralDefs = centralFoso.querySelector('defs');
            if(!cardDefs || !centralDefs) return;

            const gradBody = cardDefs.querySelector('linearGradient[id^="g"]');
            const gradMouth = cardDefs.querySelector('linearGradient[id^="mouth"]');

            centralDefs.querySelectorAll('#gActive, #mouthActive').forEach(n=>n.remove());

            if(gradBody){
                const cloneBody = gradBody.cloneNode(true);
                cloneBody.setAttribute('id','gActive');
                centralDefs.appendChild(cloneBody);
            }
            if(gradMouth){
                const cloneMouth = gradMouth.cloneNode(true);
                cloneMouth.setAttribute('id','mouthActive');
                centralDefs.appendChild(cloneMouth);
            }

            const rects = centralFoso.querySelectorAll('rect');
            const bodyRect = rects[0];
            if(bodyRect) bodyRect.setAttribute('fill','url(#gActive)');
        }

        function showToast(message, type = "info", duration = 3000) {
            const container = document.getElementById("toastContainer");
            if (!container) return;

            const toast = document.createElement("div");
            toast.textContent = message;

            toast.style.padding = "10px 16px";
            toast.style.borderRadius = "12px";
            toast.style.fontWeight = "bold";
            toast.style.color = "#fff";
            toast.style.boxShadow = "0 4px 10px rgba(0,0,0,0.3)";
            toast.style.opacity = "0";
            toast.style.transition = "opacity 0.3s, transform 0.3s";
            toast.style.transform = "translateY(-10px)";

            if (type === "success") toast.style.background = "#27ae60";
            else if (type === "error") toast.style.background = "#e74c3c";
            else if (type === "warning") toast.style.background = "#f39c12";
            else toast.style.background = "#3498db";

            container.appendChild(toast);

            requestAnimationFrame(() => {
                toast.style.opacity = "1";
                toast.style.transform = "translateY(0)";
            });

            setTimeout(() => {
                toast.style.opacity = "0";
                toast.style.transform = "translateY(-10px)";
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        function updateNextRewardCountdown() {
            if (nextRewardInterval) clearInterval(nextRewardInterval);

            const now = new Date();
            const lastClaim = state.lastDailyClaim ? new Date(state.lastDailyClaim) : null;

            if (lastClaim && now.toDateString() === lastClaim.toDateString()) {
                nextRewardInterval = setInterval(() => {
                    const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                    const diff = tomorrow - new Date();
                    if (diff <= 0) {
                        streakHint.textContent = '¡Tu recompensa diaria está lista!';
                        clearInterval(nextRewardInterval);
                        checkDailyReward();
                        return;
                    }
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    streakHint.textContent = `Próxima recompensa en: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }, 1000);
            } else {
                 streakHint.textContent = 'Vuelve cada día para aumentar tu racha';
            }
        }

        function checkDailyReward() {
            const now = new Date();
            const lastClaim = state.lastDailyClaim ? new Date(state.lastDailyClaim) : null;
            
            if (!lastClaim) {
                canClaimDaily = true;
                state.dailyDay = 1;
            } else {
                const isSameDay = now.toDateString() === lastClaim.toDateString();
                if (!isSameDay) {
                    const yesterday = new Date(now);
                    yesterday.setDate(now.getDate() - 1);
                    const isConsecutive = yesterday.toDateString() === lastClaim.toDateString();
                    if (isConsecutive) {
                        state.dailyDay = (state.dailyDay % DAILY_REWARDS.length) + 1;
                    } else {
                        state.dailyDay = 1; // Reset streak
                    }
                    canClaimDaily = true;
                } else {
                    canClaimDaily = false;
                }
            }

            if (canClaimDaily) {
                dotDaily.classList.remove('hidden');
            } else {
                dotDaily.classList.add('hidden');
            }
            updateNextRewardCountdown();
            render();
        }

        function openDailyModal() {
            if (!dailyModal) return;
            dailyModal.classList.remove('hidden');
            dailyCarousel.innerHTML = '';

            DAILY_REWARDS.forEach((reward, index) => {
                const day = index + 1;
                const card = document.createElement('div');
                card.style.cssText = `
                    flex-shrink: 0;
                    width: 120px;
                    padding: 10px;
                    border-radius: 8px;
                    text-align: center;
                    border: 2px solid #333;
                    background: #222;
                `;
                if (day < state.dailyDay) { // Claimed
                    card.style.borderColor = '#27ae60';
                    card.style.opacity = '0.6';
                } else if (day === state.dailyDay && canClaimDaily) { // Can claim
                    card.style.borderColor = '#f39c12';
                    card.style.transform = 'scale(1.05)';
                }
                
                card.innerHTML = `
                    <div style="font-weight:bold; margin-bottom:8px;">Día ${day}</div>
                    <div style="font-size:24px; margin-bottom:8px;">🎁</div>
                    <div style="font-size:12px;">${reward.label}</div>
                `;
                dailyCarousel.appendChild(card);
            });

            btnClaimDaily.disabled = !canClaimDaily;
        }

        function claimDailyReward() {
            if (!canClaimDaily) return;

            const rewardIndex = state.dailyDay - 1;
            const reward = DAILY_REWARDS[rewardIndex];

            if (reward.type === 'sig') {
                state.sig += reward.value;
                state.totalSigEarned += reward.value;
                showToast(`+${reward.value} ΣC!`, 'success');
            } else if (reward.type === 'multiplier') {
                // This needs a mechanism to expire. Let's add it to the state.
                // For now, let's just add a temporary multiplier.
                showToast(`Multiplicador x${reward.value} activado!`, 'success');
            } else if (reward.type === 'combo') {
                state.sig += reward.value.sig;
                state.totalSigEarned += reward.value.sig;
                showToast(`+${reward.value.sig} ΣC y multiplicador activado!`, 'success');
            }

            state.lastDailyClaim = new Date().toISOString();
            canClaimDaily = false;
            dotDaily.classList.add('hidden');
            dailyModal.classList.add('hidden');
            updateNextRewardCountdown();
            render();
        }

        function updateAutoClickLoop() {
            if (autoClickTimer) {
                clearInterval(autoClickTimer);
                autoClickTimer = null;
            }

            const level = state.upgradeLevels.autoclicker || 0;
            if (level > 0) {
                const cps = AUTOCLICKER_UPGRADES[level - 1].cps;
                autoClickTimer = setInterval(() => {
                    if (state.powerOn && !isCharging && state.battery > 0) {
                        handleCentralClick(); // Pass no event so no animation shows
                    }
                }, 1000 / cps);
            }
        }

        function calculateAfkEarnings() {
            const now = Date.now();
            const lastClaim = state.afkLastClaim || state.lastPlayed || now;
            const diffSeconds = Math.floor((now - lastClaim) / 1000);
            const afkLevel = state.upgradeLevels.afk || 0;
            // showToast(`AFK check: ${diffSeconds}s since last claim. Level: ${afkLevel}`, "info"); // DEBUG
            if (afkLevel > 0) {
                const sph = AFK_UPGRADES[afkLevel - 1].sph;
                const earnings = (sph / 3600) * diffSeconds * (state.afkMultiplier || 1);
                state.afkEarnings = earnings;
                if (earnings > 0) {
                    dotAFK.classList.remove('hidden');
                }
            }
        }

        function openAfkModal() {
            calculateAfkEarnings();
            const afkLevel = state.upgradeLevels.afk || 0;
            const earnings = state.afkEarnings || 0;
            let infoText = `Ganancias actuales: ${formatNum(earnings)} ΣC.\n`;
            if (afkLevel > 0) {
                infoText += `Ganas ${formatNum(AFK_UPGRADES[afkLevel - 1].sph)} ΣC por hora.`;
            } else {
                infoText += 'Compra tu primera mejora para empezar a ganar AFK.';
            }
            afkInfo.innerText = infoText;

            const nextLevel = afkLevel < AFK_UPGRADES.length ? AFK_UPGRADES[afkLevel] : null;
            if (nextLevel) {
                btnUpgradeAFK.textContent = `Mejorar (${formatNum(nextLevel.cost)} ΣC)`;
                btnUpgradeAFK.disabled = false;
            } else {
                btnUpgradeAFK.textContent = 'MAX';
                btnUpgradeAFK.disabled = true;
            }

            afkModal.classList.remove('hidden');
        }

        function claimAfkEarnings() {
            calculateAfkEarnings();
            const earnings = state.afkEarnings || 0;
            if (earnings > 0) {
                state.sig += earnings;
                state.totalSigEarned += earnings;
                showToast(`+${formatNum(earnings)} ΣC de ganancias AFK!`, 'success');
                state.afkEarnings = 0;
                state.afkLastClaim = Date.now();
                dotAFK.classList.add('hidden');
            }
            afkModal.classList.add('hidden');
            render();
        }

        function upgradeAfk() {
            const level = state.upgradeLevels.afk || 0;
            if (level < AFK_UPGRADES.length) {
                const cost = AFK_UPGRADES[level].cost;
                if (state.sig >= cost) {
                    state.sig -= cost;
                    state.upgradeLevels.afk++;
                    showToast('¡Mejora de AFK comprada!', 'success');
                    openAfkModal(); // Refresh modal
                } else {
                    showToast('No tienes suficientes Sigmacoins.', 'error');
                }
            }
            render();
        }

        function openRebirthModal() {
            const rebirthInfoEl = document.getElementById('rebirthInfo');
            const btnConfirmRebirth = document.getElementById('btnConfirmRebirth');
            const nextLevelIndex = state.rebirths;

            if (nextLevelIndex < REBIRTH_LEVELS.length) {
                const nextLevel = REBIRTH_LEVELS[nextLevelIndex];
                const hasEnoughSig = state.sig >= nextLevel.cost;
                const hasEnoughFosos = state.fososOwned.length >= nextLevel.requiredFosos;
                
                rebirthInfoEl.innerHTML = `
                    <p><strong>Próximo Rebirth (Nivel ${nextLevelIndex + 1}):</strong></p>
                    <ul>
                        <li>Costo: ${formatNum(nextLevel.cost)} ΣC (${hasEnoughSig ? '✅' : '❌'})</li>
                        <li>Fosos requeridos: ${nextLevel.requiredFosos} (${hasEnoughFosos ? '✅' : '❌'})</li>
                        <li><strong>Bonificación:</strong> +${nextLevel.bonus * 100}% de ganancias por clic</li>
                    </ul>
                `;
                btnConfirmRebirth.disabled = !(hasEnoughSig && hasEnoughFosos);
            } else {
                rebirthInfoEl.innerHTML = '<p>¡Has alcanzado el nivel máximo de Rebirth por ahora!</p>';
                btnConfirmRebirth.disabled = true;
            }

            rebirthModal.classList.remove('hidden');
        }

        function handleRebirth() {
            const nextLevelIndex = state.rebirths;
            if (nextLevelIndex >= REBIRTH_LEVELS.length) return;

            const nextLevel = REBIRTH_LEVELS[nextLevelIndex];
            const hasEnoughSig = state.sig >= nextLevel.cost;
            const hasEnoughFosos = state.fososOwned.length >= nextLevel.requiredFosos;

            if (hasEnoughSig && hasEnoughFosos) {
                if (confirm(`¿Seguro que quieres hacer Rebirth? Perderás tus Sigmacoins, fosos y mejoras a cambio de una bonificación de +${nextLevel.bonus * 100}% en las ganancias.`)) {
                    // Aplicar bonificación
                    state.rebirthBonus += nextLevel.bonus;
                    state.rebirths++;

                    // Resetear estado
                    state.sig = 0;
                    state.totalClicks = state.totalClicks; // Mantener clics totales
                    state.activeFosoIndex = 0;
                    state.fososOwned = [0];
                    state.battery = 100;
                    state.maxBattery = 100;
                    state.upgradeLevels = { battery: 0, autoclicker: 0, afk: 0 };
                    // Podríamos resetear más cosas si quisiéramos (cooldowns, etc.)

                    showToast(`¡Rebirth completado! Ahora tienes un +${(state.rebirthBonus * 100).toFixed(0)}% de bonus.`, 'success', 5000);
                    rebirthModal.classList.add('hidden');
                    checkAchievements();
                    updateAutoClickLoop();
                    render();
                }
            } else {
                showToast('No cumples los requisitos para el Rebirth.', 'error');
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            checkMissionReset();
            renderWheel();
            calculateAfkEarnings();
            checkDailyReward();
            checkWheelCooldown();
            updateAutoClickLoop();
            render();
            setInterval(saveState, CONFIG.autosaveMs);
            setInterval(render, CONFIG.uiTickMs);
            setInterval(calculateAfkEarnings, 60000);
            setInterval(checkWheelCooldown, 1000);

            if(centralFoso) centralFoso.addEventListener('click', handleCentralClick);

            if(btnPower) {
                btnPower.addEventListener('click', () => {
                    state.powerOn = !state.powerOn;
                    const powerStatus = state.powerOn ? 'encendido' : 'apagado';
                    const color = state.powerOn ? 'success' : 'error';
                    btnPower.style.background = state.powerOn ? '#0ea5b7' : '#555';
                    showToast(`Foso ${powerStatus}.`, color);
                    render();
                });
            }

            if(btnChargeToggle) btnChargeToggle.addEventListener('click', toggleCharging);
            
            if(btnShop) btnShop.addEventListener('click', () => {
              if(shopModal) shopModal.classList.remove('hidden');
            });

            if(shopModal) {
              shopModal.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                  shopModal.classList.add('hidden');
                });
              });
            }

            if(btnRebirth) btnRebirth.addEventListener('click', openRebirthModal);
            if(rebirthModal) {
                rebirthModal.querySelector('.close-btn').addEventListener('click', () => {
                    rebirthModal.classList.add('hidden');
                });
                document.getElementById('btnConfirmRebirth').addEventListener('click', handleRebirth);
            }


            
            if(btnConfig) btnConfig.addEventListener('click', ()=> {
              if(configModal) configModal.classList.remove('hidden');
            });

            if(configModal) {
              configModal.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                  configModal.classList.add('hidden');
                });
              });
            }
            
            if(btnReset) btnReset.addEventListener('click', ()=>{
              if(confirm('⚠️ Esto borrará absolutamente TODO el progreso guardado en este juego.')){
                localStorage.clear();
                state = {};
                location.reload(true);
              }
            });

            if(btnMata) btnMata.addEventListener('click', ()=>{
              const now = Date.now();
              if(state.mataCooldownUntil && state.mataCooldownUntil > now) return;
              state.sig += CONFIG.mataReward;
              state.totalSigEarned += CONFIG.mataReward;
              state.mataUses = (state.mataUses || 0) + 1;
              state.mataCooldownUntil = now + CONFIG.mataCooldownSec*1000;
              checkAchievements();
              render();
            });

            if(btnDaily) btnDaily.addEventListener('click', openDailyModal);
            if(closeDaily) closeDaily.addEventListener('click', () => dailyModal.classList.add('hidden'));
            if(btnClaimDaily) btnClaimDaily.addEventListener('click', claimDailyReward);

            if(btnAFK) btnAFK.addEventListener('click', openAfkModal);
            if(afkModal) afkModal.querySelector('.close-btn').addEventListener('click', () => afkModal.classList.add('hidden'));
            if(btnClaimAFK) btnClaimAFK.addEventListener('click', claimAfkEarnings);
            if(btnUpgradeAFK) btnUpgradeAFK.addEventListener('click', upgradeAfk);

            if(btnWheel) {
                btnWheel.addEventListener('click', () => {
                    wheelModal.classList.remove('hidden');
                });
            }

            if(wheelModal) {
                wheelModal.querySelector('.close-btn').addEventListener('click', () => {
                    wheelModal.classList.add('hidden');
                });
            }

            if(btnSpinWheel) {
                btnSpinWheel.addEventListener('click', spinWheel);
            }

            if(btnMissions) {
                btnMissions.addEventListener('click', () => {
                    renderMissions();
                    missionsModal.classList.remove('hidden');
                });
            }

            if(missionsModal) {
                missionsModal.querySelector('.close-btn').addEventListener('click', () => {
                    missionsModal.classList.add('hidden');
                });
            }

            if(btnAchievements) {
                btnAchievements.addEventListener('click', () => {
                    renderAchievements();
                    achievementsModal.classList.remove('hidden');
                    dotAchievements.classList.add('hidden');
                });
            }

            if(achievementsModal) {
                achievementsModal.querySelector('.close-btn').addEventListener('click', () => {
                    achievementsModal.classList.add('hidden');
                });
            }

            if (shopGrid) {
                shopGrid.addEventListener('click', (e) => {
                    const card = e.target.closest('.shopCard');
                    if (!card) return;

                    const itemIndex = card.dataset.index;
                    const upgradeType = card.dataset.upgrade;

                    if (itemIndex !== undefined) {
                        const index = parseInt(itemIndex, 10);
                        const item = FOSOS[index];
                        if (state.fososOwned.includes(index)) {
                            state.activeFosoIndex = index;
                            showToast(`Foso ${item.name} equipado.`, 'info');
                        } else {
                            if (state.sig >= item.cost) {
                                state.sig -= item.cost;
                                state.fososOwned.push(index);
                                state.activeFosoIndex = index;
                                showToast(`Foso ${item.name} comprado y equipado!`, 'success');
                                updateMissionProgress('buy_foso', 1);
                                checkAchievements();
                            } else {
                                showToast('No tienes suficientes Sigmacoins.', 'error');
                            }
                        }
                    } else if (upgradeType) {
                        const level = state.upgradeLevels[upgradeType] || 0;
                        const upgrades = upgradeType === 'autoclicker' ? AUTOCLICKER_UPGRADES : BATTERY_UPGRADES;
                        if (level < upgrades.length) {
                            const cost = upgrades[level].cost;
                            if (state.sig >= cost) {
                                state.sig -= cost;
                                state.upgradeLevels[upgradeType]++;
                                if (upgradeType === 'battery') {
                                    state.maxBattery = upgrades[level].capacity;
                                }
                                showToast(`¡${upgradeType} mejorado!`, 'success');
                                if (upgradeType === 'autoclicker') updateAutoClickLoop();
                            } else {
                                showToast('No tienes suficientes Sigmacoins.', 'error');
                            }
                        }
                    }
                    render();
                });
            }

        });
    })();
</script>
</body>
</html>
