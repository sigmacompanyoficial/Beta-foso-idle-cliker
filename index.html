<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Foso Tycoon ‚Äî Juego</title>
<style>
  :root{
    --bg:#071026; --panel:#0b1220; --accent:#f59e0b; --muted:#93a3b8;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:#eef6ff;
    /* Est√©tica tipo Cookie Clicker: franjas azules y vi√±eta */
    background:
      radial-gradient(ellipse at center, rgba(255,255,255,0.12) 0%, rgba(0,0,0,0) 60%),
      repeating-linear-gradient( to bottom, #1b4b7a 0 10px, #1a456f 10px 20px),
      #0a1f3b;
  }
  .wrap{max-width:1200px;margin:18px auto;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:18px}
  header{display:flex;align-items:center;gap:12px}
  header h1{margin:0;font-size:20px}
  .stage{background:linear-gradient(180deg,#071328,#061026);border-radius:12px;padding:18px;display:flex;flex-direction:column;align-items:center;gap:12px;box-shadow:0 12px 30px rgba(0,0,0,0.6)}
  .topRow{width:100%;display:flex;justify-content:space-between;align-items:center}
  .bigCounter{font-size:20px;font-weight:800}
  .metaTiny{font-size:12px;color:var(--muted)}
  .vaperWrap{width:300px;height:360px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .vaperWrap svg{width:72%;height:auto;max-height:90%;cursor:pointer;user-select:none}
  /* Smoke overlay */
  .smoke-layer{position:absolute;inset:0;pointer-events:none;overflow:visible}
  .smoke{position:absolute;width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.6);filter:blur(0.5px);animation:smokeUp 1.2s ease-out forwards;will-change:transform,opacity}
  @keyframes smokeUp{0%{transform:translateY(0) scale(0.8);opacity:.85}100%{transform:translateY(-120px) scale(1.6);opacity:0}}
  /* Shop title fit for long names */
  .shopGrid .shopCard > div[style*="font-weight:700"]{font-size:13px;text-align:center;line-height:1.15}
  .controlsRow{display:flex;gap:10px;width:100%;justify-content:center}
  .mata-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:none;background:#ff4d4d;color:#081018;font-weight:900;cursor:pointer}
  .mata-btn[disabled]{opacity:.45;cursor:not-allowed}
  .panel{background:var(--glass);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .shopGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px;max-height:520px;overflow:auto;padding-right:6px}
  .shopCard{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px;border-radius:8px;display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
  .shopCard img, .shopCard svg{width:72px;height:auto}
  .priceTag{background:rgba(0,0,0,0.25);padding:4px 6px;border-radius:6px;font-weight:700;font-size:13px}
  .icon-sm{width:18px;height:18px;vertical-align:middle}
  .hint{color:var(--muted);font-size:13px}
  footer{grid-column:1/-1;margin-top:10px;text-align:center;color:var(--muted);font-size:13px}
  @media (max-width:980px){.wrap{grid-template-columns:1fr;padding:12px}.vaperWrap{width:320px;height:420px}}
  .modal {
  position: fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.8);
  display: flex; justify-content:center; align-items:center;
  z-index: 9999;
}
.modal.hidden { display: none; }
.modal-content {
  background: #111;
  border: 2px solid #0ff;
  box-shadow: 0 0 20px #0ff;
  border-radius: 12px;
  padding: 20px;
  width: 80%; max-height: 80%; overflow-y: auto;
  color: #eee;
  font-family: monospace;
}
.close-btn {
  float: right; font-size: 24px; cursor: pointer;
  color: #0ff;
}
.powers-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  gap: 15px;
  margin-top: 20px;
}
.power-card {
  background: #222;
  border: 1px solid #444;
  border-radius: 8px;
  padding: 12px;
  transition: transform 0.2s, box-shadow 0.2s;
}
.power-card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 12px #0ff;
}
.power-card button {
  margin-top: 10px;
  width: 100%;
  padding: 6px;
  background: #0ff;
  border: none;
  border-radius: 6px;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}
.power-card button:disabled {
  background: #444; color:#999; cursor: not-allowed;
}


/* Humo animado */
.smoke {
  position: absolute;
  bottom: 80px; /* punto de salida aprox. del foso */
  left: 50%;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.7);
  transform: translateX(-50%) scale(0.8);
  animation: smokeUp 2.5s ease-out forwards;
  pointer-events: none;
}

@keyframes smokeUp {
  0% {
    transform: translate(-50%, 0) scale(0.8);
    opacity: 0.8;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    transform: translate(-50%, -150px) scale(1.5);
    opacity: 0;
  }
}

.smoke circle {
  fill: lightgray;
  opacity: 0.8;
  animation: rise 3s infinite ease-in-out;
}

.smoke circle:nth-child(2) {
  animation-delay: 1s;
}
.smoke circle:nth-child(3) {
  animation-delay: 2s;
}

@keyframes rise {
  0% {
    transform: translateY(0) scale(0.5);
    opacity: 0;
  }
  20% {
    opacity: 0.8;
  }
  100% {
    transform: translateY(-60px) scale(1.6);
    opacity: 0;
  }
}

.smoke path {
  fill: lightgray;
  opacity: 0.7;
  animation: puff 4s infinite ease-in-out;
}

@keyframes puff {
  0% {
    transform: translateY(0) scale(0.6);
    opacity: 0;
  }
  20% {
    opacity: 0.8;
  }
  100% {
    transform: translateY(-80px) scale(1.8);
    opacity: 0;
  }
}

.smoke ellipse {
  fill: lightgray;
  opacity: 0.7;
  animation: puff 5s infinite ease-in-out;
}

.smoke ellipse:nth-child(2) {
  animation-delay: 1.5s;
}
.smoke ellipse:nth-child(3) {
  animation-delay: 3s;
}

@keyframes puff {
  0%   { transform: translateY(0) scale(0.6); opacity: 0; }
  20%  { opacity: 0.8; }
  100% { transform: translateY(-80px) scale(1.8); opacity: 0; }
}

#autoClickPointer {
  position: absolute;
  width: 24px;         /* m√°s peque√±o */
  height: 24px;
  background: url('https://cdn-icons-png.flaticon.com/512/32/32339.png') no-repeat center;
  background-size: contain;
  pointer-events: none;  /* no bloquea nada */
  opacity: 0;
  transform: scale(1);
  transition: transform 0.15s ease, opacity 0.15s ease;
  z-index: 1;           /* por debajo de UI pero encima del foso */
}
#autoClickPointer.active {
  opacity: 0.8;         /* aparece m√°s sutil */
  transform: scale(0.7);
}

.hidden {
  display: none !important;
}



</style>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%23f59e0b'/%3E%3Ctext x='16' y='21' font-size='14' text-anchor='middle' fill='%23081018' font-family='Arial'%3EŒ£%3C/text%3E%3C/svg%3E">
</head>
<body>
  <!-- Pantalla de advertencia mejorada -->
  <div id="advertencia" style="position:fixed;inset:0;background:#000;display:flex;justify-content:center;align-items:center;z-index:9999">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600" style="width:80%;height:auto">
      <defs>
        <radialGradient id="gBg" cx="50%" cy="40%" r="70%">
          <stop offset="0%" stop-color="#111"/>
          <stop offset="100%" stop-color="#000"/>
        </radialGradient>
      </defs>
      <rect width="800" height="600" fill="url(#gBg)"/>
      <polygon points="400,100 500,300 300,300" fill="yellow" stroke="black" stroke-width="5"/>
      <text x="400" y="270" text-anchor="middle" font-size="80" fill="black" font-weight="bold">!</text>
      <text x="400" y="380" text-anchor="middle" font-size="28" fill="white" font-family="Arial" font-weight="bold">FOSO IDLE TYCOON es una obra de ficci√≥n.</text>
      <text x="400" y="420" text-anchor="middle" font-size="24" fill="white" font-family="Arial">Fumar y vapear da√±an la salud y generan adicci√≥n.</text>
      <text x="400" y="460" text-anchor="middle" font-size="22" fill="white" font-family="Arial">Juega de forma responsable.</text>
    </svg>
  </div>
  <script>
    // Bloquear scroll y ocultar advertencia tras 3s
    document.documentElement.style.overflow = 'hidden';
    setTimeout(()=>{
      const adv = document.getElementById('advertencia');
      if(adv) adv.style.display = 'none';
      document.documentElement.style.overflow = '';
    }, 3000);
  </script>
  
  <div class="wrap">
    <div>
      <header>
        <svg width="44" height="44" viewBox="0 0 64 64" aria-hidden>
          <rect x="6" y="6" width="52" height="52" rx="10" fill="#081026" stroke="#f59e0b" stroke-width="2" />
        </svg>
        <div>
          <h1>Foso Tycoon</h1>
          <div class="hint">Haz click en el foso grande; compra fosos desde la tienda (clic en miniaturas).</div>
        </div>
      </header>

      <button id="btnDaily" class="mata-btn">üéÅ Regalo Diario</button>


      <main style="margin-top:14px">
        <section class="stage">
          <div class="topRow">
            <div>
              <div class="bigCounter">Sigmacoin: <span id="sigTotal">0</span> Œ£C</div>
              <div class="metaTiny">Por clic: <span id="perClick">1</span> Œ£C ‚Ä¢ Clicks totales: <span id="totalClicks">0</span></div>
            </div>

          </div>

          <!-- Vaper grande (click anywhere on SVG) -->
          <div class="vaperWrap" id="vaperWrap" title="Haz click en cualquier parte del foso para generar Œ£C">
            <div id="smokeLayer"></div>
            <!-- Ejemplo Foso B√°sico Tropical (inline SVG) -->
            <svg id="centralFoso" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 260" role="img" aria-label="Foso central">
              <rect x="20" y="20" width="60" height="220" rx="12" ry="12" fill="url(#g1)" stroke="#0b0c2a" stroke-width="3"/>
              <rect x="20" y="0" width="60" height="20" rx="10" ry="10" fill="url(#mouth1)"/>
<!-- Pantalla central -->
<!--rect x="35" y="110" width="30" height="40" rx="4" ry="4" fill="#000" id="centralScreen"/-->
<!-- PANTALLA CENTRAL (dentro del svg centralFoso) -->
<rect x="35" y="100" width="30" height="50" rx="4" ry="4" fill="#000" id="centralScreen"/>
<rect x="35" y="100" width="30" height="50" rx="4" ry="4" fill="#000" id="centralScreen"/>
<text id="batteryText" x="50" y="125" font-size="10" fill="#0f0" text-anchor="middle">100%</text>

  <!-- niveles: vamos a usar m√°scaras para "llenar" o simplemente cambiar color/opacity -->
  <!-- para simplicidad controlamos solo el color/opacity del path seg√∫n drops -->


<!-- Texto de porcentaje -->




              <defs>
                <linearGradient id="g1" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#f1c40f"/>
                  <stop offset="50%" stop-color="#2ecc71"/>
                  <stop offset="100%" stop-color="#1e3799"/>
                </linearGradient>
                <linearGradient id="mouth1" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#2c2c54"/>
                  <stop offset="100%" stop-color="#000"/>
                </linearGradient>
                <linearGradient id="batteryGrad" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stop-color="#00ff99"/>
                  <stop offset="100%" stop-color="#00a86b"/>
                </linearGradient>
              </defs>
            </svg>
              <div id="autoClickPointer"></div> 
          </div>

         <div class="controlsRow" id="controlsRow">
        
  <!-- Power -->
  <button id="btnPower" class="mata-btn" style="background:#10b981">
    <svg class="icon-sm" viewBox="0 0 24 24"><path fill="black" d="M12 2v10h10v2H12v10h-2V14H0v-2h10V2h2z"/></svg>
    Power
  </button>

  <!-- Cargar -->
  <button id="btnChargeToggle" class="mata-btn" style="background:#00cfff">
    <svg class="icon-sm" viewBox="0 0 24 24"><path fill="black" d="M12 2L4 20h16L12 2z"/></svg>
    Cargar
  </button>

  <!-- Nuevo/Reparar Foso -->
  <button id="btnNuevoFoso" class="mata-btn" style="background:#ffa726">
    <svg class="icon-sm" viewBox="0 0 24 24"><path fill="black" d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6h2c0-4.42-3.58-8-8-8z"/></svg>
    Nuevo Foso
  </button>

  <!-- Mata Foso -->
  <button id="btnMata" class="mata-btn" style="background:#ff4d4d">
    <svg class="icon-sm" viewBox="0 0 24 24"><path fill="black" d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"/></svg>
    <span id="mataLabel">Mata Foso</span>
  </button>


  <!-- Tienda -->
 <!-- Tienda -->
<button id="btnShop" class="mata-btn" style="background:#facc15">
  <svg class="icon-sm" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path fill="black" d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 
      2-.9 2-2-.9-2-2-2zm10 
      0c-1.1 0-2 .9-2 2s.9 2 2 2 
      2-.9 2-2-.9-2-2-2zm-9.84-4h9.45c.75 
      0 1.41-.41 1.75-1.03l3.58-6.49c.37-.67-.11-1.48-.88-1.48H6.21L5.27 
      2H2v2h2l3.6 7.59-1.35 
      2.45C5.52 14.37 6.23 15 7.07 
      15h11.93v-2H7.42l.74-1.35z"/>
  </svg>
  Tienda
</button>


  <!-- Configuraci√≥n -->
  <button id="btnConfig" class="mata-btn" style="background:#c084fc">
    <svg class="icon-sm" viewBox="0 0 24 24"><path fill="black" d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zM19.43 12.97a7.962 7.962 0 0 0 0-1.94l2.11-1.65a.5.5 0 0 0 .11-.64l-2-3.46a.5.5 0 0 0-.61-.22l-2.49 1a7.902 7.902 0 0 0-1.68-.97l-.38-2.65a.5.5 0 0 0-.5-.42h-4a.5.5 0 0 0-.5.42l-.38 2.65c-.61.25-1.18.58-1.68.97l-2.49-1a.5.5 0 0 0-.61.22l-2 3.46a.5.5 0 0 0 .11.64l2.11 1.65c-.05.32-.07.65-.07.97s.02.65.07.97l-2.11 1.65a.5.5 0 0 0-.11.64l2 3.46c.14.24.43.34.69.22l2.49-1c.5.39 1.07.72 1.68.97l.38 2.65a.5.5 0 0 0 .5.42h4c.25 0 .46-.18.5-.42l.38-2.65c.61-.25 1.18-.58 1.68-.97l2.49 1c.26.12.55.02.69-.22l2-3.46a.5.5 0 0 0-.11-.64l-2.11-1.65z"/></svg>
    Configuraci√≥n
  </button>
</div>


          <div class="hint">Tienda: clic en la miniatura para equipar/comprar. El central cambia seg√∫n lo equipado.</div>
        </section>
      </main>
    </div>

    <!-- Right column: tienda con 15 miniaturas -->
    
    <!-- Modal Tienda -->
<div id="shopModal" class="modal hidden">
  <div class="modal-content" style="width:90%;max-width:1000px">
    <span class="close-btn">&times;</span>

    <!-- Aqu√≠ metemos la tienda -->
    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;align-items:center;gap:8px">
          <!-- Carrito SVG -->
          <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden>
            <path fill="#f59e0b" d="M7 18c-1.1 0-1.99.9-1.99 
            2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 
            0c-1.1 0-1.99.9-1.99 2S15.9 22 17 
            22s2-.9 2-2-.9-2-2-2zM7.16 
            14h9.45c.75 0 1.41-.41 
            1.75-1.03l3.58-6.49c.37-.67-.11-1.48-.88-1.48H6.21L5.27 
            2H2v2h2l3.6 7.59-1.35 
            2.45C5.52 14.37 6.23 15 7.07 
            15h11.93v-2H7.42l.74-1.35z"/>
          </svg>
          <div style="font-weight:800">Tienda ‚Äî Fositos</div>
        </div>
        <div class="metaTiny">Œ£C: <span id="shopSigma">0</span></div>
      </div>

      <div class="shopGrid" id="shopGrid">

      

 
        <div class="shopCard" data-index="0" title="Foso 1: Mango Ice ü•≠‚ùÑÔ∏è (0 Œ£C)">
  <div class="metaTiny" style="font-weight:800">Foso 1: Mango Ice ü•≠‚ùÑÔ∏è</div>
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g1_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth1_shop)"/>
<!-- Humo del foso central -->
<!-- Humo del foso central (nube m√°s realista) -->
<!-- Humo del foso central (3 √≥valos juntos ‚Üí nube) -->
<g class="smoke">
  <ellipse cx="50" cy="40" rx="18" ry="12" />
  <ellipse cx="65" cy="35" rx="14" ry="10" />
  <ellipse cx="40" cy="35" rx="14" ry="10" />
</g>


    <defs>
      <linearGradient id="g1_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#f1c40f"/><stop offset="50%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#1e3799"/>
      </linearGradient>
      <linearGradient id="mouth1_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 1: Mango Ice ü•≠‚ùÑÔ∏è</div>
  <div class="priceTag">0 Œ£C</div>
</div>

<!-- 2 -->
<div class="shopCard" data-index="1" title="Foso 2: Strawberry Kiwi üçìü•ù (200 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g2_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth2_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g2_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff7675"/><stop offset="100%" stop-color="#fd7e14"/></linearGradient>
      <linearGradient id="mouth2_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 2: Strawberry Kiwi üçìü•ù</div>
  <div class="priceTag">100 Œ£C</div>
</div>

<!-- 3 -->
<div class="shopCard" data-index="2" title="Foso 3: Blue Razz ü´êüíô (400 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g3_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth3_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g3_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00c6ff"/><stop offset="100%" stop-color="#0072ff"/></linearGradient>
      <linearGradient id="mouth3_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 3: Blue Razz ü´êüíô</div>
  <div class="priceTag">10&nbsp;000</div>
</div>

<!-- 4 -->
<div class="shopCard" data-index="3" title="Foso 4: Watermelon Ice üçâ‚ùÑÔ∏è (1 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g4_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth4_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g4_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ecf0f1"/><stop offset="100%" stop-color="#95a5a6"/></linearGradient>
      <linearGradient id="mouth4_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 4: Watermelon Ice üçâ‚ùÑÔ∏è</div>
  <div class="priceTag">100&nbsp;000</div>
</div>

<!-- 5 -->
<div class="shopCard" data-index="4" title="Foso 5: Pineapple Coconut üççü•• (5 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g5_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth5_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g5_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffd700"/><stop offset="100%" stop-color="#ffb400"/></linearGradient>
      <linearGradient id="mouth5_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 5: Pineapple Coconut üççü••</div>
  <div class="priceTag">1&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 6 -->
<div class="shopCard" data-index="5" title="Foso 6: Grape Ice üçá‚ùÑÔ∏è (20 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g6_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth6_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g6_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#9b59b6"/><stop offset="100%" stop-color="#2c003e"/></linearGradient>
      <linearGradient id="mouth6_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">10&nbsp;000&nbsp;000 </div>
  <div class="priceTag">20&nbsp;000 Œ£C</div>
</div>

<!-- 7 -->
<div class="shopCard" data-index="6" title="Foso 7: Peach Mango üçëü•≠ (50 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g7_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth7_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g7_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff0000"/><stop offset="100%" stop-color="#000"/></linearGradient>
    <linearGradient id="mouth7_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 7: Peach Mango üçëü•≠</div>
  <div class="priceTag">100&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 8 -->
<div class="shopCard" data-index="7" title="Foso 8: Cola Ice ü•§‚ùÑÔ∏è (80 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g8_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth8_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g8_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#00aaff"/></linearGradient>
    <linearGradient id="mouth8_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 8: Cola Ice ü•§‚ùÑÔ∏è</div>
  <div class="priceTag">1&nbsp;000&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 9 -->
<div class="shopCard" data-index="8" title="Foso 9: Lychee Rose üå∏üçí (120 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g9_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth9_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g9_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#145a32"/></linearGradient>
    <linearGradient id="mouth9_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 9: Lychee Rose üå∏üçí</div>
  <div class="priceTag">10&nbsp;000&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 10 -->
<div class="shopCard" data-index="9" title="Foso 10: Apple Mint üçèüåø (250 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g10_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth10_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g10_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff5733"/><stop offset="100%" stop-color="#900c3f"/></linearGradient>
    <linearGradient id="mouth10_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 10: Apple Mint üçèüåø</div>
  <div class="priceTag">100&nbsp;000&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 11 -->
<div class="shopCard" data-index="10" title="Foso 11: Banana Ice Cream üçåüç¶ (500 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g11_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth11_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g11_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#39ff14"/><stop offset="100%" stop-color="#0ff"/></linearGradient>
    <linearGradient id="mouth11_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 11: Banana Ice Cream üçåüç¶</div>
  <div class="priceTag">1&nbsp;000&nbsp;000&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 12 -->
<div class="shopCard" data-index="11" title="Foso 12: Lemon Tart üçãü•ß (1 000 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g12_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth12_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g12_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00f5ff"/><stop offset="50%" stop-color="#7f00ff"/><stop offset="100%" stop-color="#00ff88"/></linearGradient>
    <linearGradient id="mouth12_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 12: Lemon Tart üçãü•ß</div>
  <div class="priceTag">10&nbsp;000&nbsp;000&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 13 -->
<div class="shopCard" data-index="12" title="Foso 13: Cherry Cola üçíü•§ (2 500 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g13_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth13_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g13_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#cd7f32"/><stop offset="100%" stop-color="#6e2c00"/>
      </linearGradient>
      <linearGradient id="mouth13_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 13: Cherry Cola üçíü•§</div>
  <div class="priceTag">100&nbsp;000&nbsp;000&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 14 -->
<div class="shopCard" data-index="13" title="Foso 14: Cotton Candy üç≠ (5 000 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g14_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth14_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g14_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#85c1e9"/>
      </linearGradient>
      <linearGradient id="mouth14_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 14: Cotton Candy üç≠</div>
  <div class="priceTag">1&nbsp;000&nbsp;000&nbsp;000&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- 15 (especial: cuerpo cambia rojo->azul->verde con animate) -->
<div class="shopCard" data-index="14" title="Foso 15: Black Diamond Reserve üíéüî• (10 000 000 Œ£C)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g15_shop)" stroke="#222" stroke-width="1"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth15_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g15_shop" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="red">
          <animate attributeName="stop-color" values="red;blue;green;red" dur="3s" repeatCount="indefinite"/>
        </stop>
        <stop offset="100%" stop-color="red">
          <animate attributeName="stop-color" values="red;blue;green;red" dur="3s" repeatCount="indefinite"/>
        </stop>
      </linearGradient>
      <linearGradient id="mouth15_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 15: Black Diamond Reserve üíéüî•</div>
  <div class="priceTag">10&nbsp;000&nbsp;000&nbsp;000&nbsp;000&nbsp;000 Œ£C</div>
</div>

<!-- --- SECCION: Mejoras permanentes --- -->
<div style="grid-column:1/-1; font-weight:800; margin-top:10px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.03)">
  üîß Mejoras permanentes
</div>

<!-- Upgrade: Bater√≠a -->
<div class="shopCard" data-upgrade="battery_plus50" title="Aumenta la bater√≠a en +50">
  <div class="metaTiny" style="font-weight:700">Bater√≠a +50</div>
  <div class="priceTag"></div>
</div>

<!-- Upgrade: Auto-clicker -->
<div class="shopCard" data-upgrade="autoclick_1" title="A√±ade 1 clic autom√°tico por segundo">
  <div class="metaTiny" style="font-weight:700">Auto-clicker +1 CPS</div>
  <div class="priceTag"></div>
</div>

<!-- Upgrade: Extra clic -->
<div class="shopCard" data-upgrade="extra_click" title="Permite 1 clic extra antes de gastar bater√≠a">
  <div class="metaTiny" style="font-weight:700">+1 clic extra</div>
  <div class="priceTag"></div>
</div>


      </div>
    </aside>
  </div>
</div>



  
    <footer>
      <div style="display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap">
        <span class="metaTiny">S√≠guenos:</span>
        <a href="https://instagram.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>‚Ä¢</span>
        <a href="https://tiktok.com/@sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>‚Ä¢</span>
        <a href="https://x.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>‚Ä¢</span>
        <a href="https://facebook.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>‚Ä¢</span>
        <a href="https://youtube.com/@sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
      </div>
      <div class="metaTiny" style="margin-top:6px">Maqueta funcional ‚Äî HTML/CSS/JS puro. Guardado autom√°tico en localStorage.</div>
    </footer>
  </div>
   <button id="btnSigmaHack">üí∞ Sigma Infinito</button>
  <!-- Modal Poderes -->
<div id="powersModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Poderes</h2>
    <div id="powersGrid" class="powers-grid"></div>
  </div>
</div>

<!-- Modal Configuraci√≥n -->
<div id="configModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>‚öôÔ∏è Configuraci√≥n</h2>

    <div class="config-grid">
      <!-- Tema -->
      <div class="config-item">
        <label for="themeSelect">Tema üé®</label>
        <select id="themeSelect">
          <option value="dark">Oscuro</option>
          <option value="light">Claro</option>
          <option value="neon">Ne√≥n</option>
        </select>
      </div>

      <!-- Animaciones -->
      <div class="config-item">
        <label>
          <input type="checkbox" id="chkAnimations" checked>
          Activar Animaciones ‚ú®
        </label>
      </div>

      <!-- Reset -->
      <div class="config-item">
        <button id="btnReset" style="background:#ff4d4d;color:#fff;padding:8px 14px;border:none;border-radius:6px;cursor:pointer">
          Borrar Progreso üí£
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Recompensas Diarias -->
<div id="dailyModal" class="hidden" style="
  position: fixed; top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.8); display:flex;
  align-items:center; justify-content:center;
  z-index:1000;">

  <div style="background:#111; padding:20px; border-radius:12px;
              max-width:600px; width:90%; text-align:center; color:#fff; position:relative;">

    <span id="closeDaily" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:28px;">&times;</span>
    <h2>üéÅ Recompensas Diarias</h2>

    <div id="carousel" style="display:flex; overflow-x:auto; gap:15px; padding:10px;">
      <!-- Tarjetas generadas por JS -->
    </div>

    <button id="btnClaimDaily" style="margin-top:15px; padding:8px 16px; font-weight:bold;">
      Reclamar de hoy
    </button>
  </div>
</div>


<script>
// --- Configuraci√≥n de recompensas diarias ---
const DAILY_REWARDS = [
  { type: "coins", amount: 100, label: "100 Œ£C", icon: "üí∞" },
  { type: "coins", amount: 500, label: "500 Œ£C", icon: "üí∞" },
  { type: "power", effect: "x2", duration: 60, label: "Poder x2 por 1 min", icon: "‚ö°" },
  { type: "coins", amount: 2000, label: "2000 Œ£C", icon: "üí∞" },
  { type: "power", effect: "x2", duration: 300, label: "Poder x2 por 5 min", icon: "‚ö°" },
  { 
    type: "foso",
    foso: {
      name: "Foso Especial üíé",
      perClick: 100,
      svg: `
        <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
          <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#gSpecial)"/>
          <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouthSpecial)"/>
          <defs>
            <linearGradient id="gSpecial" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#00eaff"/>
              <stop offset="100%" stop-color="#0077ff"/>
            </linearGradient>
            <linearGradient id="mouthSpecial" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#2c2c54"/>
              <stop offset="100%" stop-color="#000"/>
            </linearGradient>
          </defs>
        </svg>`
    },
    label: "Foso Especial (100 Œ£C/click)", icon: "üíé"
  }
];

document.addEventListener("DOMContentLoaded", () => {
  const dailyModal = document.getElementById("dailyModal");
  const btnDaily = document.getElementById("btnDaily");
  const btnClaimDaily = document.getElementById("btnClaimDaily");
  const closeDaily = document.getElementById("closeDaily");
  const carousel = document.getElementById("carousel");

  let countdownInterval;

  // --- Formatear tiempo en hh:mm:ss ---
  function formatTime(ms) {
    const totalSec = Math.max(0, Math.floor(ms / 1000));
    const h = String(Math.floor(totalSec / 3600)).padStart(2, "0");
    const m = String(Math.floor((totalSec % 3600) / 60)).padStart(2, "0");
    const s = String(totalSec % 60).padStart(2, "0");
    return `${h}:${m}:${s}`;
  }

  // --- Abrir modal y rellenar carrusel ---
  function openDailyModal() {
    if (!carousel) return;
    carousel.innerHTML = "";

    DAILY_REWARDS.forEach((reward, idx) => {
      const card = document.createElement("div");
      card.style.minWidth = "120px";
      card.style.padding = "10px";
      card.style.borderRadius = "8px";
      card.style.background = (idx === (state.dailyDay || 0)) ? "#facc15" : "#333";
      card.style.color = "#fff";
      card.style.textAlign = "center";

      let extra = "";
      if (idx === (state.dailyDay || 0) && state.nextDailyTime) {
        const msLeft = state.nextDailyTime - Date.now();
        if (msLeft > 0) {
          extra = `<div id="dailyCountdownCard" style="margin-top:6px; font-size:12px; color:#000">‚è≥ ${formatTime(msLeft)}</div>`;
        }
      }

      card.innerHTML = `
        <div style="font-size:32px">${reward.icon}</div>
        <div><strong>D√≠a ${idx + 1}</strong></div>
        <div style="font-size:14px">${reward.label}</div>
        ${extra}
      `;
      carousel.appendChild(card);
    });

    updateCountdown();
    countdownInterval = setInterval(updateCountdown, 1000);

    dailyModal.classList.remove("hidden");
  }

  // --- Actualizar cuenta atr√°s ---
  function updateCountdown() {
    const btn = btnClaimDaily;
    const countdownCard = document.getElementById("dailyCountdownCard");

    if (!state.nextDailyTime) {
      btn.disabled = false;
      if (countdownCard) countdownCard.textContent = "";
      return;
    }

    const msLeft = state.nextDailyTime - Date.now();

    if (msLeft > 0) {
      btn.disabled = true;
      btn.textContent = `üéÅ Reclamar recompensa diaria (‚è≥ ${formatTime(msLeft)})`;
      if (countdownCard) countdownCard.textContent = `‚è≥ ${formatTime(msLeft)}`;
    } else {
      btn.disabled = false;
      btn.textContent = "üéÅ Reclamar recompensa diaria";
      if (countdownCard) countdownCard.textContent = "‚úÖ Disponible!";
      clearInterval(countdownInterval);
    }
  }

  // --- Reclamar recompensa ---
  function claimDailyReward() {
    const now = Date.now();
    if (state.nextDailyTime && now < state.nextDailyTime) {
      alert("Ya reclamaste tu recompensa diaria, vuelve m√°s tarde!");
      return;
    }

    const reward = DAILY_REWARDS[state.dailyDay] || DAILY_REWARDS[DAILY_REWARDS.length - 1];

    switch (reward.type) {
      case "coins":
        state.sig = (state.sig || 0) + reward.amount;
        break;

      case "power":
        const mult = reward.effect === "x2" ? 2 : 1;
        state.perClickMult = (state.perClickMult || 1) * mult;
        if (reward.duration) {
          setTimeout(() => { state.perClickMult /= mult; }, reward.duration * 1000);
        }
        break;

      case "foso":
        if (reward.foso) {
          FOSOS.push(reward.foso);
        }
        break;
    }

    state.lastDailyClaim = new Date().toDateString();
    state.dailyDay = (state.dailyDay || 0) + 1;
    state.nextDailyTime = now + 24 * 60 * 60 * 1000; // 24 horas

    if (typeof saveState === "function") saveState();
    if (typeof render === "function") render();
    if (typeof renderShop === "function") renderShop();

    alert(`Has ganado: ${reward.label}`);
    dailyModal.classList.add("hidden");
    clearInterval(countdownInterval);
  }

  // --- Listeners ---
  if (btnDaily) btnDaily.addEventListener("click", openDailyModal);

  if (btnClaimDaily) {
    btnClaimDaily.type = "button";
    btnClaimDaily.addEventListener("click", (e) => {
      e.stopPropagation();
      claimDailyReward();
    });
  }

  if (closeDaily) {
    closeDaily.addEventListener("click", (e) => {
      e.stopPropagation();
      dailyModal.classList.add("hidden");
      clearInterval(countdownInterval);
    });
  }

  if (dailyModal) {
    dailyModal.addEventListener("click", (e) => {
      if (e.target === dailyModal) {
        dailyModal.classList.add("hidden");
        clearInterval(countdownInterval);
      }
    });
  }
});
</script>




<!-- REEMPLAZA/PEGAR: Bloque limpio para Recompensas Diarias (solo 1 copia) -->

<!-- FIN bloque limpio -->



<style>
  .config-grid {
    display: grid;
    gap: 15px;
    margin-top: 20px;
  }
  .config-item {
    background: #222;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #444;
  }
  .config-item label {
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .config-item select {
    background: #111;
    color: #fff;
    border: 1px solid #555;
    padding: 5px;
    border-radius: 4px;
  }
</style>
<script>
window.onload = () => {
  const btnShop = document.getElementById("btnShop");
  console.log("¬øEncontr√≥ el bot√≥n?", btnShop);

  if (btnShop) {
    btnShop.addEventListener("click", () => {
      console.log("üü° Hiciste clic en el bot√≥n Tienda!");
    });
  }
};
</script>
<script>
/* L√≥gica JS m√≠nima para la maqueta:
   - 15 fosos con costes y sigmacoin-per-click
   - central clickable (anywhere inside SVG)
   - shop: click miniatura buys/equips foso (if enough Œ£C)
   - battery: each click consumes battery; buy battery restores
   - overheating (>7 cps) burns the active foso (requires buying another)
   - Mata Foso: +50 Œ£C, cooldown 1800s (30 min)
   - Save/load to localStorage
*/

// Configuraci√≥n inicial (puedes ajustar)
const FOSOS = [
 {id:1,  name:'Foso 1',  cost:0,                    perClick:1},
 {id:2,  name:'Foso 2',  cost:100,                  perClick:2},
 {id:3,  name:'Foso 3',  cost:10_000,               perClick:10},
 {id:4,  name:'Foso 4',  cost:100_000,              perClick:100},
 {id:5,  name:'Foso 5',  cost:1_000_000,            perClick:1_000},
 {id:6,  name:'Foso 6',  cost:10_000_000,           perClick:10_000},
 {id:7,  name:'Foso 7',  cost:100_000_000,          perClick:100_000},
 {id:8,  name:'Foso 8',  cost:1_000_000_000,        perClick:1_000_000},
 {id:9,  name:'Foso 9',  cost:10_000_000_000,       perClick:10_000_000},
 {id:10, name:'Foso 10', cost:100_000_000_000,      perClick:100_000_000},
 {id:11, name:'Foso 11', cost:1_000_000_000_000,    perClick:1_000_000_000},
 {id:12, name:'Foso 12', cost:10_000_000_000_000,   perClick:10_000_000_000},
 {id:13, name:'Foso 13', cost:100_000_000_000_000,  perClick:100_000_000_000},
 {id:14, name:'Foso 14', cost:1_000_000_000_000_000, perClick:1_000_000_000_000},
 {id:15, name:'Foso 15', cost:10_000_000_000_000_000, perClick:10_000_000_000_000}
];


const shopGrid = document.getElementById('shopGrid');
// --- Habilitar compra de fosos desde la tienda ---
shopGrid.querySelectorAll(".shopCard[data-index]").forEach(card => {
  card.addEventListener("click", () => {
    const idx = parseInt(card.dataset.index);
    const foso = FOSOS[idx];

    if (!foso) return;

    if (state.sig >= foso.cost) {
      state.sig -= foso.cost;               // Resta monedas
      state.activeFosoIndex = idx;          // Activa el foso comprado
      state.battery = Math.min(
        state.battery + CONFIG.onEquipRefill,
        state.maxBattery
      ); // recarga un poco al equipar
      saveState();
      render();
      alert(`‚úÖ Compraste y equipaste ${foso.name}`);
    } else {
      alert("‚ùå No tienes suficientes Œ£C");
    }
  });
});


let autoClickTimer = null;



// Estado
let state = {
  sig: 0,
  totalClicks: 0,
  activeFosoIndex: 0, // index in FOSOS array, default 0
  battery: 100, // percent
  maxBattery: 100, // can be increased with upgrades
  burned: false,
  powerOn: true,
  mataCooldownUntil: 0, // timestamp
  autoClickerLevel: 0,
  smokerOn: false,
  autoClickExpiresAt: 0, // timestamp when autoclick boost ends
  smokerExpiresAt: 0,
  dailyDay: 0,        // progreso en la lista de recompensas
lastDailyClaim: null,  // fecha del √∫ltimo reclamo (timestamp)


  // caladas acumuladas desde √∫ltima recarga
  // Nuevos campos
  lang: 'es',
  powersOwned: {}, // id -> true
  overheatBonus: 0, // +cps al umbral
  batteryEfficiencyLevel: 0, // each level reduces drain by 10%
  rechargeSpeedLevel: 0, // each level increases recharge rate by 10%
  perClickMult: 1,
  passivePerSec: 0,

  // üîß a√±adidos para que no salga undefined:
  upgradeLevels: {
    battery_plus50: 0,
    autoclick_1: 0,
    extra_click: 0
  },
  extraClicks: 0
};


// DOM refs
const sigTotalEl = document.getElementById('sigTotal');
const perClickEl = document.getElementById('perClick');
const totalClicksEl = document.getElementById('totalClicks');
const batteryFill = document.getElementById('batteryFill');
const batteryLabel = document.getElementById('batteryLabel');
const shopSigma = document.getElementById('shopSigma');
const btnMata = document.getElementById('btnMata');
const mataLabel = document.getElementById('mataLabel');

const centralFoso = document.getElementById('centralFoso');
const vaperWrap = document.getElementById('vaperWrap');

const CONFIG = {
  storageKey: 'foso_tycoon_state_v1',
  autosaveMs: 10000,
  uiTickMs: 1000,
  // Battery drains slower with better fosos (multiplier applied)
  baseBatteryDrainPerClick: 1,
  // Base overheat threshold (poderes pueden aumentarlo)
  overheatCps: 15,
  mataReward: 50,
  // 5 minutes cooldown
  mataCooldownSec: 300,
  // timed recharge (no cost): seconds to fully recharge baseline
  rechargeBaseSec: 120,
  // boost on click: extra recharge during continuous clicking
  clickRechargeBoost: 0.9, // 90% of base per-click as extra timed recharge
  onEquipRefill: 20 // +20% bater√≠a al equipar/comprar un foso
};
const STORAGE_KEY = CONFIG.storageKey;

// Bot√≥n de "Borrar Progreso üí£" dentro del modal Configuraci√≥n
// Bot√≥n de "Borrar Progreso üí£" dentro del modal Configuraci√≥n
// Abrir modal de configuraci√≥n
document.getElementById('btnConfig')?.addEventListener('click', ()=>{
  document.getElementById('configModal').classList.remove('hidden');
});

// Cerrar modal de configuraci√≥n
document.querySelectorAll('#configModal .close-btn').forEach(btn=>{
  btn.addEventListener('click', ()=> document.getElementById('configModal').classList.add('hidden'));
});

// Bot√≥n de "Borrar Progreso üí£"
document.getElementById('btnReset')?.addEventListener('click', ()=>{
  if(confirm('‚ö†Ô∏è Esto borrar√° absolutamente TODO el progreso guardado en este juego.')){
    localStorage.clear();         // üî• borra todas las claves del localStorage
    state = {};                   // resetea tambi√©n la variable en memoria
    location.reload(true);        // recarga la p√°gina desde cero
  }
});
     // recarga la p√°gina limpia
     // Bot√≥n de Tienda
const btnShop = document.getElementById('btnShop');
const shopModal = document.getElementById('shopModal');

// Abrir tienda
btnShop?.addEventListener('click', () => {
  shopModal.classList.remove('hidden');
});

// Cerrar tienda (los botones con la clase .close-btn dentro del modal)
shopModal.querySelectorAll('.close-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    shopModal.classList.add('hidden');
  });
});





// load/save
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);
    Object.assign(state, s);
  }catch(e){ console.warn('load state err', e); }
}
function saveState(){
  state.lastPlayed = Date.now();   // üëà guarda hora de salida
  localStorage.setItem("gameState", JSON.stringify(state));

  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){}
}
setInterval(saveState, CONFIG.autosaveMs);
loadState();

// helper
function formatNum(n){
  if(n>=1e9) return (n/1e9).toFixed(2)+'B';
  if(n>=1e6) return (n/1e6).toFixed(2)+'M';
  if(n>=1e3) return (n/1e3).toFixed(2)+'K';
  return Math.floor(n).toString();
}

// UI update
function syncCentralAppearance(activeIndex){
  const activeCard = shopGrid.querySelector(`.shopCard[data-index="${activeIndex}"]`);
  if(!activeCard) return;
  const cardSvg = activeCard.querySelector('svg');
  const cardDefs = cardSvg ? cardSvg.querySelector('defs') : null;
  const centralDefs = centralFoso.querySelector('defs');
  if(!cardDefs || !centralDefs) return;

  // Find gradient nodes in card defs
  const gradBody = cardDefs.querySelector('linearGradient[id^="g"]');
  const gradMouth = cardDefs.querySelector('linearGradient[id^="mouth"]');

  // Remove previous active gradients
  centralDefs.querySelectorAll('#gActive, #mouthActive').forEach(n=>n.remove());

  // Clone and rename gradients
  if(gradBody){
    const cloneBody = gradBody.cloneNode(true);
    cloneBody.setAttribute('id','gActive');
    centralDefs.appendChild(cloneBody);
  }
  if(gradMouth){
    const cloneMouth = gradMouth.cloneNode(true);
    cloneMouth.setAttribute('id','mouthActive');
    centralDefs.appendChild(cloneMouth);
  }

  // Apply fills to central rects (body and mouth)
  const rects = centralFoso.querySelectorAll('rect');
  const bodyRect = rects[0];
  const mouthRect = rects[1];
  if(bodyRect) bodyRect.setAttribute('fill','url(#gActive)');
  if(mouthRect) mouthRect.setAttribute('fill','url(#mouthActive)');
    // Recompensa AFK
  if (state.lastPlayed) {
    const diffSec = Math.floor((Date.now() - state.lastPlayed) / 1000);
    if (diffSec > 5) { // m√≠nimo 5s de inactividad
      const reward = Math.min(diffSec * (state.passivePerSec || 1), 10000); // l√≠mite 10K
      state.sig += reward;
      alert(`üí§ Bienvenido de nuevo! Has ganado ${formatNum(reward)} Œ£C mientras estabas AFK.`);
    }
  }

}

function render(){
  sigTotalEl.textContent = formatNum(state.sig);
  shopSigma.textContent = formatNum(state.sig);
  totalClicksEl.textContent = state.totalClicks;
  const basePer = FOSOS[state.activeFosoIndex].perClick;
  const per = basePer * state.perClickMult;
  perClickEl.textContent = formatNum(per);
const batteryText = document.getElementById("batteryText");
if (batteryText) {
  const maxB = state.maxBattery || 100;
  const percent = Math.floor((state.battery / maxB) * 100);

  batteryText.textContent = percent + "%";
  batteryText.setAttribute("fill", percent > 20 ? "#0f0" : "#f00");
}


  // Mata cooldown
  const now = Date.now();
  if(state.mataCooldownUntil && state.mataCooldownUntil > now){
    btnMata.disabled = true;
    const sec = Math.ceil((state.mataCooldownUntil - now)/1000);
    const mm = String(Math.floor(sec/60)).padStart(2,'0'), ss = String(sec%60).padStart(2,'0');
    mataLabel.textContent = `Cooldown ${mm}:${ss}`;
  } else {
    btnMata.disabled = false;
    mataLabel.textContent = 'Mata Foso';
  }

  // Sync central SVG appearance with active foso
  syncCentralAppearance(state.activeFosoIndex);

  // burned visual: tint the central screen red when burned
  const centralScreen = document.getElementById('centralScreen');
  if(state.burned){
    centralScreen.setAttribute('fill','#6b0000');
  } else {
    centralScreen.setAttribute('fill','#000');
  }
}
render();

// clicks per second detection (overheat)
let clickTimestamps = [];
function registerClick(){
  const now = Date.now();
  clickTimestamps.push(now);
  // keep last 1000ms
  clickTimestamps = clickTimestamps.filter(t => now - t <= 1000);
  return clickTimestamps.length;
}

// Carga manual: conmutador Cargar/Parar con l√≠mite de 3 minutos
let isCharging = false;
let chargeStartAt = 0;
let burnCheckTimer = null;
let timeWhenReachedFull = 0; 
const btnChargeToggle = document.getElementById('btnChargeToggle');




function setCharging(active){
  isCharging = !!active;
  const tickMs = 1000; // cada 1s actualizamos carga
  const maxB = () => (state.maxBattery || 100);

  if(isCharging){
    chargeStartAt = Date.now();
    btnChargeToggle.textContent = 'Parar Carga';
    // limpiar timer previo
    if(burnCheckTimer) clearInterval(burnCheckTimer);

    // arrancar timer que incrementa bater√≠a y comprueba sobrecarga
    burnCheckTimer = setInterval(()=>{
      if(!isCharging) return;

      // 1) incrementar bater√≠a de forma proporcional al tiempo de recarga configurado
      const basePerSec = maxB() / (CONFIG.rechargeBaseSec || 120); // ej. si rechargeBaseSec=120 -> llena en 120s
      const speedMultiplier = 1 + ((state.rechargeSpeedLevel || 0) * 0.1); // bonus por mejoras
      const inc = basePerSec * speedMultiplier * (tickMs / 1000);

      state.battery = Math.min(maxB(), state.battery + inc);

      // 2) gestionar momento en que llega a full y empezar el contador de sobrecarga
      if(state.battery >= maxB()){
        if(timeWhenReachedFull === 0){
          timeWhenReachedFull = Date.now();
        }
      } else {
        // si baja de full mientras sigue cargando, resetear el contador
        timeWhenReachedFull = 0;
      }

      // 3) si se mantiene FULL por 60s -> quemar
      if(timeWhenReachedFull !== 0){
        const overTimeMs = Date.now() - timeWhenReachedFull;
        if(overTimeMs >= 60 * 1000){
          state.burned = true;
          state.battery = 0;
          setCharging(false);
          showBurnSmoke();
          alert('Se quem√≥ por sobrecarga: 100% + 1 minuto.');
          render();
          saveState();
          return;
        }
      }

      // 4) actualizar UI y guardar cada tick
      render();
      saveState();
    }, tickMs);

  } else {
    // parar carga
    btnChargeToggle.textContent = 'Cargar Foso';
    timeWhenReachedFull = 0;
    if(burnCheckTimer){ clearInterval(burnCheckTimer); burnCheckTimer = null; }
    saveState();
  }
}



btnChargeToggle?.addEventListener('click', ()=>{
  if(state.burned){ alert('El foso est√° quemado. Equipa/compra otro.'); return; }
  setCharging(!isCharging);
});

function showBurnSmoke(){
  // Inserta el SVG de humo/quemado dentro del wrapper, dispara animaciones
  const wrap = document.getElementById('vaperWrap');
  if(!wrap) return;
  const existing = document.getElementById('burnSmokeSvg');
  if(existing) existing.remove();
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('id','burnSmokeSvg');
  svg.setAttribute('xmlns','http://www.w3.org/2000/svg');
  svg.setAttribute('width','200');
  svg.setAttribute('height','200');
  svg.setAttribute('viewBox','0 0 200 200');
  svg.innerHTML = `
    <defs>
      <filter id="blurSmoke" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="6"/>
      </filter>
    </defs>
    <g filter="url(#blurSmoke)">
      <ellipse cx="100" cy="150" rx="12" ry="8" fill="lightgray" opacity="0.6">
        <animate attributeName="cy" from="150" to="50" dur="2.5s" begin="0s"/>
        <animate attributeName="rx" from="12" to="40" dur="2.5s" begin="0s"/>
        <animate attributeName="opacity" from="0.6" to="0" dur="2.5s" begin="0s"/>
      </ellipse>
      <ellipse cx="90" cy="150" rx="10" ry="7" fill="lightgray" opacity="0.5">
        <animate attributeName="cy" from="150" to="60" dur="3s" begin="0s"/>
        <animate attributeName="rx" from="10" to="35" dur="3s" begin="0s"/>
        <animate attributeName="opacity" from="0.5" to="0" dur="3s" begin="0s"/>
      </ellipse>
      <ellipse cx="110" cy="150" rx="9" ry="6" fill="lightgray" opacity="0.4">
        <animate attributeName="cy" from="150" to="70" dur="3.2s" begin="0s"/>
        <animate attributeName="rx" from="9" to="30" dur="3.2s" begin="0s"/>
        <animate attributeName="opacity" from="0.4" to="0" dur="3.2s" begin="0s"/>
      </ellipse>
    </g>`;
  // posicionar en la parte superior del dispositivo
  svg.style.position='absolute';
  svg.style.left='50%';
  svg.style.top='10%';
  svg.style.transform='translate(-50%, -0%)';
  svg.style.pointerEvents='none';
  wrap.appendChild(svg);
  setTimeout(()=> svg.remove(), 3500);
}

// central click handler
function handleCentralClick(){
  if(isCharging){ 
    alert('No puedes vapear mientras se est√° cargando.'); 
    return; 
  }
  if(!state.powerOn) return; // apagado: no responde
  if(state.burned){ alert('El foso est√° quemado. Compra/selecciona otro.'); return; }
  if(state.battery <= 0){ alert('Bater√≠a agotada.'); return; }
  // Solo quemar por CPS si el clic es manual; el autoclicker no cuenta para sobrecalentamiento
  const cps = registerClick();
  const overheatLimit = CONFIG.overheatCps + (state.overheatBonus||0);
  if(!state._autoClickInProgress && cps > overheatLimit){
    state.burned = true; state.battery = 0; alert('¬°Has quemado el foso!'); render(); saveState(); return;
  }
  const basePer = FOSOS[state.activeFosoIndex].perClick;
  const per = basePer * (state.perClickMult||1);
  state.sig += per; state.totalClicks++;
  const drainEff = Math.max(0.2, 1 - (state.activeFosoIndex*0.05) - (state.batteryEfficiencyLevel*0.1));
  const drain = CONFIG.baseBatteryDrainPerClick * drainEff;
  state.battery = Math.max(0, state.battery - drain);
  try { centralFoso.style.transform = 'scale(0.98)'; setTimeout(()=> centralFoso.style.transform = '', 60);} catch(_){ }
  render(); saveState();
}
// attach clicks to both wrapper and svg para fiabilidad (evitar dobles listeners si se reinserta script)
document.getElementById('btnPower')?.addEventListener('click', ()=>{
  state.powerOn = !state.powerOn;
  const b = document.getElementById('btnPower');
  b.textContent = state.powerOn ? 'Power ON' : 'Power OFF';
  b.style.background = state.powerOn ? '#10b981' : '#9ca3af';
  // ‚ö° Nota: ahora al apagar NO se interrumpe la carga
  render(); saveState();
});

try{
 
  document.getElementById('centralFoso')?.addEventListener('click', handleCentralClick, { once:false });
  const cf = document.getElementById('centralFoso');
  cf?.setAttribute('tabindex','0');
  cf?.addEventListener('keydown', (e)=>{
    if(e.code==='Enter' || e.code==='Space'){ e.preventDefault(); handleCentralClick(); }
  });
}catch(_){}

// shop interactions: click shopCard to buy/equip


    // Si no lo tienes comprado ‚Üí comprar
 // shop interactions: comprar/equipar foso
// ======================= UPGRADES DEFINIDOS =======================
const UPGRADES = {
  battery_plus50: {
    baseCost: 100,
    name: "Bater√≠a +50 (perm)",
    maxLevel: 3,
    getCost: (level) => 100 * Math.pow(2, level),  // üëà a√±adido
    apply: () => {
      const oldMax = state.maxBattery || 100;
      const oldPercent = state.battery / oldMax;
      state.maxBattery = oldMax + 50;
      state.battery = Math.round(state.maxBattery * oldPercent);
    }
  },

  autoclick_1: {
    baseCost: 500,
    name: "Auto-clicker +1 CPS",
    maxLevel: 3,
    getCost: (level) => 500 * Math.pow(2, level),  // üëà a√±adido
    apply: () => {
      state.autoClickerLevel++;
    }
  },

  extra_click: {
    baseCost: 200,
    name: "+1 clic extra",
    maxLevel: 3,
    getCost: (level) => 200 * Math.pow(2, level),  // üëà a√±adido
    apply: () => {
      state.extraClicks = (state.extraClicks || 0) + 1;
    }
  }
};
Cost: 100,
    




// ======================= COMPRAR O EQUIPAR FOSO =======================
function buyFoso(idx, card){
  const f = FOSOS[Number(idx)];
  if(!f) return;
  state.fososOwned = state.fososOwned || {};

  if(state.fososOwned[idx]){
    state.activeFosoIndex = Number(idx);
    state.burned = false;
    render(); saveState();
    return;
  }

  if(state.sig < f.cost){
    alert('No tienes suficientes Œ£C para comprar este foso.');
    return;
  }

  state.sig -= f.cost;
  state.activeFosoIndex = Number(idx);
  state.burned = false;
const maxB = state.maxBattery || 100;
state.battery = Math.min(maxB, state.battery + CONFIG.onEquipRefill);


  state.fososOwned[idx] = true;

  if(card){
    card.querySelector(".status")?.remove();
    const status = document.createElement("div");
    status.className = "status";
    status.textContent = "Adquirido";
    status.style.color = "lime";
    card.appendChild(status);
  }

  renderShop(); render(); saveState();
}

const maxB = state.maxBattery || 100;
state.battery = Math.min(maxB, state.battery + CONFIG.onEquipRefill);

// ======================= CLICK EN SHOPGRID =======================

if (shopGrid) {
  shopGrid.addEventListener('click', (e)=>{
    const card = e.target.closest('.shopCard');
    if(!card) return;
    const upg = card.getAttribute('data-upgrade');
    const idx = card.getAttribute('data-index');
    if(upg){ buyUpgrade(upg, card); return; }
    if(idx !== null){ buyFoso(idx, card); return; }
  });
}

// pintar al inicio
renderShop();


// referencia √∫nica al grid de la tienda





// Eliminado boost de recarga: bot√≥n ya no existe

// Mata Foso: +50 Œ£C, cooldown 1800s (30min)
btnMata.addEventListener('click', ()=>{
  const now = Date.now();
  if(state.mataCooldownUntil && state.mataCooldownUntil > now) return;
  state.sig += CONFIG.mataReward;
  state.mataCooldownUntil = now + CONFIG.mataCooldownSec*1000;
  render(); saveState();
});

// Nuevo Foso: compra r√°pida por 25 Œ£C, resetea quemado y rellena bater√≠a +20%
document.getElementById('btnNuevoFoso')?.addEventListener('click', ()=>{
  const COST = 25;
  if(state.sig < COST){ alert('Necesitas 25 Œ£C para comprar un nuevo foso.'); return; }
  state.sig -= COST;
  state.burned = false;
  state.battery = Math.min(state.maxBattery || 100, state.battery + 20);

  // opcional: cambiar a un foso base (index 0), o mantener el actual
  // state.activeFosoIndex = 0;
  render(); saveState();
});

// Autoclicker + Smoker + puntero virtual


function updateAutoClickLoop() {
  if (autoClickTimer) clearInterval(autoClickTimer);

  const lvl = state.autoClickerLevel || 0;
  if (lvl > 0) {
    autoClickTimer = setInterval(() => {
      if (isCharging) return; // ‚õî no autoclick mientras carga
      for (let i = 0; i < lvl; i++) {
        doClick(); // üî• dispara un click por cada nivel
      }
    }, 1000);
  }
}

function applyOwnedUpgrades() {
  if (!state.upgradesOwned) return;
  for (const key in state.upgradesOwned) {
    const u = UPGRADES[key];
    if (u) {
      const level = state.upgradesOwned[key];

      // üëâ caso especial: autoclick
      if (key === "autoclick_1") {
        state.autoClickerLevel = level;
      } else {
        // para upgrades normales, aplicar N veces
        for (let i = 0; i < level; i++) {
          u.apply();
        }
      }
    }
  }
  // despu√©s de todo, si hab√≠a autoclickers, arrancar el loop
  updateAutoClickLoop();
}

applyOwnedUpgrades();
updateAutoClickLoop();



function spawnPointer(){
  try{
    const wrap = document.getElementById('vaperWrap');
    const pointer = document.createElement('div');
    pointer.style.position='absolute';
    pointer.style.width='18px';
    pointer.style.height='18px';
    pointer.style.borderRadius='50%';
    pointer.style.border='2px solid #fff';
    pointer.style.boxShadow='0 0 8px rgba(255,255,255,0.6)';
    pointer.style.left='50%';
    pointer.style.top='28%';
    pointer.style.transform='translate(-50%,-50%)';
    pointer.style.pointerEvents='none';
    wrap.appendChild(pointer);
    pointer.animate([
      { transform:'translate(-50%,-50%) scale(1)', opacity:1 },
      { transform:'translate(-50%,-50%) scale(0.88)', opacity:0.85 },
      { transform:'translate(-50%,-50%) scale(1)', opacity:0 }
    ], { duration: 300, easing: 'ease-out' }).onfinish=()=> pointer.remove();
  }catch(_){}
}
function updateAutoClickLoop() {
  if (autoClickTimer) clearInterval(autoClickTimer);
  if ((state.autoClickerLevel || 0) > 0) {
    autoClickTimer = setInterval(() => {
      if (isCharging) return;  // ‚õî bloquear autoclick si est√° cargando
      doClick();
    }, 1000 / (state.autoClickerLevel));
  }
}


// Botones men√∫ inferior
document.getElementById('btnAutoClick')?.addEventListener('click', ()=>{
  // Compra mejora Autoclicker: coste 500 Œ£C, duraci√≥n 10 minutos (nivel +1)
  const COST = 500;
  const DURATION_MIN = 10;
  if(state.sig < COST){ alert('Necesitas 500 Œ£C para mejorar Autocliker.'); return; }
  state.sig -= COST;
  state.autoClickerLevel = Math.min(50, state.autoClickerLevel + 1);
  // extiende/establece expiraci√≥n
  const now = Date.now();
  const extra = DURATION_MIN*60*1000;
  state.autoClickExpiresAt = Math.max(state.autoClickExpiresAt, now) + extra;
  updateAutoClickLoop();
  // Animaci√≥n de puntero haciendo click
  try {
    const wrap = document.getElementById('vaperWrap');
    const pointer = document.createElement('div');
    pointer.style.position = 'absolute';
    pointer.style.width = '22px';
    pointer.style.height = '22px';
    pointer.style.borderRadius = '50%';
    pointer.style.border = '2px solid #fff';
    pointer.style.boxShadow = '0 0 8px rgba(255,255,255,0.6)';
    pointer.style.left = '50%';
    pointer.style.top = '28%';
    pointer.style.transform = 'translate(-50%,-50%)';
    pointer.style.pointerEvents = 'none';
    wrap.appendChild(pointer);
    pointer.animate([
      { transform: 'translate(-50%,-50%) scale(1)', opacity: 1 },
      { transform: 'translate(-50%,-50%) scale(0.88)', opacity: 0.85 },
      { transform: 'translate(-50%,-50%) scale(1)', opacity: 0.0 }
    ], { duration: 450, easing: 'ease-out' }).onfinish = ()=> pointer.remove();
  } catch(_){}
  render(); saveState();
});
document.getElementById('btnSmoker')?.addEventListener('click', ()=>{
  // Fumador: compra por 500 Œ£C, dura 10 minutos, a√±ade +5 cps mientras dure
  const COST = 500;
  const DURATION_MIN = 10;
  if(state.smokerOn && Date.now() < state.smokerExpiresAt){
    alert('Fumador ya activo. Espera a que termine para volver a comprar.');
    return;
  }
  if(state.sig < COST){ alert('Necesitas 500 Œ£C para activar Fumador.'); return; }
  state.sig -= COST;
  state.smokerOn = true;
  state.smokerExpiresAt = Date.now() + DURATION_MIN*60*1000;
  updateAutoClickLoop();
  render(); saveState();
});

// Panel de Poderes (50 diferentes)

function applyPowerEffect(effect){
  switch(effect.type){
    case 'perClickMult':
      state.perClickMult = Number((state.perClickMult * effect.value).toFixed(4));
      break;
    case 'overheatBonus':
      state.overheatBonus += effect.value;
      break;
    case 'batteryEfficiency':
      state.batteryEfficiencyLevel += effect.value;
      break;
    case 'rechargeSpeed':
      state.rechargeSpeedLevel += effect.value;
      break;
    case 'passivePerSec':
      state.passivePerSec += effect.value;
      break;
  }
}


const btnPowers = document.getElementById('btnPowers');
if (btnPowers) {
  btnPowers.addEventListener('click', () => {
    const modal = document.getElementById('powersModal');
    if (modal) {
      modal.classList.remove('hidden');
    }
  });
}




// Autosave + UI tick timer + timed recharge + central battery bar fill
setInterval(()=>{
  // expirar boosts por tiempo
  const now = Date.now();
  if(state.autoClickExpiresAt && now >= state.autoClickExpiresAt){
    state.autoClickExpiresAt = 0;
    state.autoClickerLevel = 0;
    updateAutoClickLoop();
  }
  if(state.smokerOn && state.smokerExpiresAt && now >= state.smokerExpiresAt){
    state.smokerOn = false;
    state.smokerExpiresAt = 0;
    updateAutoClickLoop();
  }

  // Ingreso pasivo por poderes
  if(state.passivePerSec>0 && !state.burned){
    state.sig += state.passivePerSec * (CONFIG.uiTickMs/1000);
  }

  // Recarga pasiva por tiempo y carga manual activa acelera x2 (solo si Power ON)
let rechargeRatePerSec = 0;

// ahora ya no depende de powerOn, solo de que no est√© quemado
if(isCharging && !state.burned){
  rechargeRatePerSec = (100/CONFIG.rechargeBaseSec) * (1 + (state.rechargeSpeedLevel||0)*0.1) * 2;
}

state.battery = Math.min(100, state.battery + rechargeRatePerSec*(CONFIG.uiTickMs/1000));

render();
saveState();
}, CONFIG.uiTickMs);

// iniciar loop de autoclick si aplica
updateAutoClickLoop();

// initial render done
render();

document.getElementById('btnSigmaHack')?.addEventListener('click', () => {
  const confirmHack = confirm('¬øEst√°s seguro que quieres recibir sigma infinito?');
  if (!confirmHack) return;

  state.sig += 9999999999999999999999999;
  render();
  saveState();
  alert('¬°SigmaCoins agregados con √©xito!');
});
 // =========================
// Definici√≥n de los 50 poderes
// =========================
const POWERS = [
  {id:1, name:"AutoClicker ü§ñ", cost:2000, effect:{type:"autoClick", value:1, desc:"+1 clic autom√°tico/seg (permanente)"}},
  {id:2, name:"TurboClick ‚ö°", cost:5000, effect:{type:"perClickMult", value:1.5, desc:"+50% Œ£C por clic (permanente)"}},
  {id:3, name:"Bater√≠a Eficiente üîã", cost:8000, effect:{type:"batteryEfficiency", value:1, desc:"-25% consumo de bater√≠a (permanente)"}},
  {id:4, name:"Recarga R√°pida üîå", cost:12000, effect:{type:"rechargeSpeed", value:1, desc:"Recarga √ó2 m√°s r√°pida (permanente)"}},
  {id:5, name:"Sigma Boost üí∞", cost:20000, effect:{type:"perClickMult", value:2, desc:"Duplica Œ£C por clic (permanente)"}},
  {id:6, name:"Humo M√°gico ‚òÅÔ∏è", cost:30000, effect:{type:"passivePerSec", value:5, desc:"+5 Œ£C/seg pasivo (permanente)"}},
  {id:7, name:"Overheat Control ‚ùÑÔ∏è", cost:50000, effect:{type:"overheatBonus", value:10, desc:"+10 cps antes de quemar (permanente)"}},
  {id:8, name:"Sigma Multiplicador ‚ú®", cost:80000, effect:{type:"multiplier", value:2, desc:"Multiplica √ó2 todo (permanente)"}},
  {id:10, name:"Ultra AutoClicker üöÄ", cost:200000, effect:{type:"autoClick", value:10, desc:"+10 clics autom√°ticos/seg (permanente)"}}
];

function applyPowerEffect(effect){
  switch(effect.type){
    case "autoClick":
      state.autoClickerLevel += effect.value;
      updateAutoClickLoop();
      break;
    case "perClickMult":
      state.perClickMult *= effect.value;
      break;
    case "batteryEfficiency":
      state.batteryEfficiencyLevel += effect.value;
      break;
    case "rechargeSpeed":
      state.rechargeSpeedLevel += effect.value;
      break;
    case "passivePerSec":
      state.passivePerSec += effect.value;
      break;
    case "overheatBonus":
      state.overheatBonus += effect.value;
      break;
    case "multiplier":
      state.perClickMult *= effect.value;
      break;
    case "repair":
      state.burned = false;
      state.battery = 50; // lo repara y da 50% bater√≠a
      break;
  }
  render(); saveState();
}


function renderPowers(){
  const grid = document.getElementById("powersGrid");
  grid.innerHTML = "";

  POWERS.forEach(p => {
    const card = document.createElement("div");
    card.className = "power-card";

    const title = document.createElement("div");
    title.style.fontWeight = "bold";
    title.textContent = p.name;
    card.appendChild(title);

    const desc = document.createElement("div");
    desc.className = "metaTiny";
    desc.textContent = p.effect.desc;
    card.appendChild(desc);

    const btn = document.createElement("button");
    
    if(p.id === 9){ 
      // Reparar foso siempre se puede comprar
      btn.textContent = `${p.cost} Œ£C ‚Äî Usar`;
      btn.disabled = state.sigma < p.cost;
      btn.onclick = () => {
        if(state.sigma >= p.cost){
          state.sigma -= p.cost;
          applyPowerEffect(p.effect);
        }
      };
    } else {
      // Otros poderes solo una vez
      if(state.powersUnlocked?.includes(p.id)){
        btn.textContent = "Comprado ‚úÖ";
        btn.disabled = true;
      } else {
        btn.textContent = `${p.cost} Œ£C ‚Äî Comprar`;
        btn.disabled = state.sigma < p.cost;
        btn.onclick = () => {
          if(state.sigma >= p.cost){
            state.sigma -= p.cost;
            if(!state.powersUnlocked) state.powersUnlocked = [];
            state.powersUnlocked.push(p.id);
            applyPowerEffect(p.effect);
          }
        };
      }
    }

    card.appendChild(btn);
    grid.appendChild(card);
  });
}






// =========================
// Abrir / cerrar modal
// =========================
const powersModal = document.getElementById('powersModal');
const powersGrid = document.getElementById('powersGrid');
const closeBtn = powersModal.querySelector('.close-btn');

document.getElementById('btnPowers').addEventListener('click', ()=>{
  powersModal.classList.remove('hidden');
  renderPowers();
});

closeBtn.addEventListener('click', ()=> powersModal.classList.add('hidden'));
window.addEventListener('click', e=>{
  if(e.target === powersModal) powersModal.classList.add('hidden');
});

// =========================
// Renderizado de cartas
// =========================
function renderPowers(){
  powersGrid.innerHTML = '';
  POWERS.forEach(p=>{
    const owned = !!state.powersOwned[p.id];
    const card = document.createElement('div');
    card.className = 'power-card';
    card.innerHTML = `
      <h3>${p.name}</h3>
      <p>${p.effect.desc}</p>
      <p>Coste: ${p.cost} Œ£C</p>
      <button ${owned?'disabled':''}>
        ${owned?'Comprado':'Comprar'}
      </button>
    `;

    const btn = card.querySelector('button');
    btn.addEventListener('click', ()=>{
      if(owned) return;
      if(state.sig < p.cost){
        alert('No tienes Œ£C suficientes.');
        return;
      }
      state.sig -= p.cost;
      state.powersOwned[p.id] = true;
      applyPowerEffect(p.effect);
      renderPowers();
      render();
      saveState();
    });

    powersGrid.appendChild(card);
  });
}

function renderShop(){
  shopGrid.querySelectorAll('.shopCard').forEach(card=>{
    const idx = Number(card.getAttribute('data-index'));
    const owned = state.fososOwned && state.fososOwned[idx];
    let badge = card.querySelector('.owned-tag');
    if(owned){
      if(!badge){
        badge = document.createElement('div');
        badge.className = 'owned-tag';
        badge.textContent = '‚úÖ Adquirido';
        badge.style.marginTop = '4px';
        badge.style.fontSize = '12px';
        badge.style.color = '#0f0';
        card.appendChild(badge);
      }
    } else {
      if(badge) badge.remove();
    }
  });
}




  // Si quieres mostrar percent de bateria en la pantalla, podr√≠as:
  // const battTextEl = document.getElementById('dropPercent'); if(battTextEl) battTextEl.textContent = Math.round(state.battery) + '%';


document.querySelectorAll(".shopCard").forEach((card, idx) => {
  if (state.fososOwned && state.fososOwned[idx]) {
    const status = document.createElement("div");
    status.className = "status";
    status.textContent = "Adquirido";
    status.style.color = "lime";
    card.appendChild(status);
  }
});

// Abrir modal Configuraci√≥n
document.getElementById("btnConfig")?.addEventListener("click", ()=>{
  document.getElementById("configModal").classList.remove("hidden");
});

// Cerrar modal
document.querySelector("#configModal .close-btn")?.addEventListener("click", ()=>{
  document.getElementById("configModal").classList.add("hidden");
});

// Animaciones
document.getElementById("chkAnimations")?.addEventListener("change", (e)=>{
  state.animationsOn = e.target.checked;
  saveState();
});

// Tema
document.getElementById("themeSelect")?.addEventListener("change", (e)=>{
  state.theme = e.target.value;
  document.body.setAttribute("data-theme", state.theme);
  saveState();
});

// Reset
document.getElementById("btnReset")?.addEventListener("click", ()=>{
  if(confirm("¬øSeguro que quieres borrar tu progreso?")){
    localStorage.clear();
    location.reload();
  }
});

function spawnSmoke(){
  const layer = document.getElementById('smokeLayer');
  if(!layer) return;
  const puff = document.createElement('div');
  puff.className = 'smoke';
  layer.appendChild(puff);
  setTimeout(()=> puff.remove(), 2500); // se borra al terminar animaci√≥n
}

// A√±adir humo cuando se hace clic en el foso
const foso = document.getElementById('centralFoso');
foso?.addEventListener('click', ()=> spawnSmoke());


// Bot√≥n hack de Sigma infinito
document.getElementById('btnSigmaHack')?.addEventListener('click', ()=>{
  state.sig = Number.MAX_SAFE_INTEGER; // o pon un n√∫mero alt√≠simo
  render();
  saveState();
  alert("üí∞ Hack activado: Sigma infinito!");
});

// --- TIENDA MODAL ---

// Abrir Tienda


if (btnShop) {
  btnShop.addEventListener("click", ()=>{
    document.getElementById("shopModal").classList.remove("hidden");
  });
}

btnChargeToggle?.addEventListener('click', ()=>{
  if(state.burned){ alert('El foso est√° quemado. Equipa/compra otro.'); return; }
  setCharging(!isCharging);
});


function buyUpgrade(upgradeKey) {
  const upgrade = UPGRADES[upgradeKey];
  if (!upgrade) {
    console.error("‚ùå Upgrade no encontrado:", upgradeKey);
    return;
  }

  const level = state.upgradeLevels?.[upgradeKey] || 0;
  console.log(`Intentando comprar ${upgradeKey}, nivel actual: ${level}`);

  if (level >= upgrade.maxLevel) {
    console.log("Ya est√° en nivel m√°ximo");
    return;
  }

  const cost = upgrade.getCost(level);
  console.log(`Costo calculado: ${cost}, SIG actual: ${state.sig}`);

  if (state.sig < cost) {
    console.log("No hay suficiente SIG");
    return;
  }

  // compra
  state.sig -= cost;
  upgrade.apply();
  state.upgradeLevels[upgradeKey] = level + 1;

  console.log(`‚úîÔ∏è Compra hecha, nuevo nivel: ${state.upgradeLevels[upgradeKey]}`);
  renderUpgradeShop();
  render();
  saveState();
}



function applyOwnedUpgrades() {
  if (!state.upgradesOwned) return;
  for (const key in state.upgradesOwned) {
    const u = UPGRADES[key];
    if (u) {
      const level = state.upgradesOwned[key];

      if (key === "autoclick_1") {
        // üöÄ Asignar directamente el nivel sin sumar
        state.autoClickerLevel = level;
      } else {
        // aplicar upgrades normales tantas veces como nivel
        for (let i = 0; i < level; i++) {
          u.apply();
        }
      }
    }
  }
  // arrancar autoclick despu√©s de restaurar el nivel
  updateAutoClickLoop();
}


loadState();
applyOwnedUpgrades();

// ------------------ Recompensa AFK (l√≠mite 10.000 Œ£C) ------------------
(function grantAFK() {
  try {
    const last = state.lastPlayed || 0;
    if (!last) return; // nada que hacer si no hay marca previa

    const now = Date.now();
    let diffSeconds = Math.floor((now - last) / 1000);

    // m√≠nimo 5s para considerar AFK (evita falsos positivos)
    if (diffSeconds <= 5) {
      state.lastPlayed = now; // reajusta la marca
      return;
    }

    // limitar segundos considerados (evita n√∫meros gigantes)
    const MAX_SECONDS = 86400; // 24h
    diffSeconds = Math.min(diffSeconds, MAX_SECONDS);

    // calculamos ingreso por segundo:
    // - state.passivePerSec (poderes pasivos)
    // - + clicks autom√°ticos: autoClickerLevel * perClick * perClickMult
    const perClickBase = (FOSOS[state.activeFosoIndex] && FOSOS[state.activeFosoIndex].perClick) || 1;
    const autoClicksPerSec = (state.autoClickerLevel || 0) * perClickBase * (state.perClickMult || 1);
    const passive = state.passivePerSec || 0;
    const incomePerSec = passive + autoClicksPerSec;

    let gained = Math.floor(incomePerSec * diffSeconds);

    // l√≠mite m√°ximo total a entregar
    const MAX_GAIN = 10000;
    if (gained > MAX_GAIN) gained = MAX_GAIN;

    if (gained > 0) {
      state.sig = (state.sig || 0) + gained;
      // mensaje al usuario (puedes quitar alert y poner un modal si prefieres)
      alert(`üí§ Has ganado ${formatNum(gained)} Œ£C por ${diffSeconds} segundos AFK (l√≠mite ${formatNum(MAX_GAIN)}).`);
    }

    // actualizar la marca para que no vuelva a contarse lo mismo
    state.lastPlayed = now;

    // refrescar UI y guardar nuevo estado
    try { renderShop(); } catch(e){/* renderShop puede estar definido despu√©s pero es hoisted en funciones normales */ }
    try { render(); } catch(e){}
    try { saveState(); } catch(e){}
  } catch (err) {
    console.warn('AFK grant error', err);
  }
})();

// Guardar marca de salida al cerrar/recargar (no la pongas en autosave)
window.addEventListener('beforeunload', () => {
  try {
    state.lastPlayed = Date.now();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  } catch (e) { /* ignore */ }
});


function renderShop() {
  const shopGrid = document.getElementById("shopGrid");
  shopGrid.querySelectorAll(".shopCard").forEach(card => {
    const upgradeKey = card.getAttribute("data-upgrade");
    if (!upgradeKey) return;

    const u = UPGRADES[upgradeKey];
    if (!u) return;

    const currentLevel = state.upgradeLevels?.[upgradeKey] || 0;
    const priceEl = card.querySelector(".priceTag");

    if (!priceEl) return;

    if (currentLevel >= (u.maxLevel || 1)) {
      priceEl.textContent = `‚úîÔ∏è M√°x (${u.maxLevel})`;
      card.style.opacity = "0.7";
    } else {
      const cost = u.getCost(currentLevel); // ‚úÖ usar getCost(level)
      priceEl.textContent = `${cost} Œ£C (Lv ${currentLevel}/${u.maxLevel})`;
      card.style.opacity = "1";
    }
  });
}


const speedMultiplier = 1 + ((state.rechargeSpeedLevel || 0) * 0.1);

function doClick() {
  if (isCharging) return;   // no clikear si est√° cargando
  if (state.burned) return; // no clikear si el foso est√° quemado

  state.sig += (1 * (state.perClickMult || 1));
  state.totalClicks++;
  render();
  saveState();
}



// ---------------------- AutoClicker ----------------------

function updateAutoClickLoop() {
  if (autoClickTimer) clearInterval(autoClickTimer);

  const lvl = state.autoClickerLevel || 0;
  if (lvl > 0) {
    autoClickTimer = setInterval(() => {
      if (isCharging || state.burned) return; // no autoclick mientras carga o quemado
      for (let i = 0; i < lvl; i++) {
        doClick(); // dispara clicks autom√°ticos
      }
    }, 1000); // cada segundo
  }
}

applyOwnedUpgrades();
updateAutoClickLoop(); // activa autoclick si ya estaba comprado

// üü¢ DEBUG AUTCLICKER
setInterval(() => {
  console.log("DEBUG >>",
    "nivel:", state.autoClickerLevel,
    "sig:", state.sig,
    "battery:", Math.round(state.battery) + "/" + state.maxBattery,
    "isCharging:", isCharging,
    "burned:", state.burned,
    "autoClickTimer activo:", !!autoClickTimer
  );
}, 3000);

console.log("üü¢ Script cargado correctamente");

function pointerClickEffect() {
  const pointer = document.getElementById("autoClickPointer");
  const foso = document.getElementById("centralFoso");
  if (!pointer || !foso) return;

  const rect = foso.getBoundingClientRect();
  pointer.style.left = rect.left + rect.width / 2 - 12 + "px"; // centrado
  pointer.style.top = rect.top + rect.height / 2 - 12 + "px";

  pointer.classList.add("active");
  setTimeout(() => pointer.classList.remove("active"), 150);
}

function renderUpgradeShop() {
  Object.keys(UPGRADES).forEach(key => {
    const upgrade = UPGRADES[key];
    const level = state.upgradeLevels?.[key] || 0;
    const priceEl = document.querySelector(`.shopCard[data-upgrade="${key}"] .priceTag`);
    if (!priceEl) return;

    if (level >= upgrade.maxLevel) {
      priceEl.textContent = "MAX";
    } else {
      // üëá AQU√ç EL CAMBIO IMPORTANTE
      const cost = upgrade.getCost(level);  
      console.log("Render:", key, "nivel", level, "coste:", cost); // para verificar
      priceEl.textContent = `${cost} Œ£C (Lv ${level}/${upgrade.maxLevel})`;
    }
  });
}


// --- DEBUG DAILY REWARDS ---





// --- EVENTOS ---







renderUpgradeShop();


// Bot√≥n que abre el modal
document.getElementById("btnDaily").addEventListener("click", openDailyModal);

// Bot√≥n dentro del modal para reclamar






// Cerrar modal


 
<!-- PEGAR: Bloque de reparaci√≥n/depuraci√≥n de Recompensas Diarias -->

(function(){
  document.addEventListener('DOMContentLoaded', () => {
    console.log("DEBUG daily-fix: iniciando (pegar este script al final del HTML)");

    const dailyModal = document.getElementById('dailyModal');
    let btnDaily = document.getElementById('btnDaily');
    let btnClaimDaily = document.getElementById('btnClaimDaily');
    let closeDaily = document.getElementById('closeDaily');

    console.log("DEBUG elementos encontrados:", { btnDaily, btnClaimDaily, closeDaily, dailyModal });

    // Reemplaza nodos por clones para eliminar listeners previos
    function replaceNode(node){
      if(!node || !node.parentNode) return node;
      const clone = node.cloneNode(true);
      node.parentNode.replaceChild(clone, node);
      return clone;
    }
    if(btnDaily) btnDaily = replaceNode(btnDaily);
    if(btnClaimDaily) btnClaimDaily = replaceNode(btnClaimDaily);
    if(closeDaily) closeDaily = replaceNode(closeDaily);

    // DEFINIR openDailyModal (estable y con debug)
    window.openDailyModal = function(){
      console.log("DEBUG openDailyModal (nuevo) ejecutado");
      if(!dailyModal){
        console.warn("dailyModal no encontrado");
        return;
      }
      // rellenar carousel si existe
      const carousel = document.getElementById('carousel');
      if(carousel && Array.isArray(window.DAILY_REWARDS)){
        carousel.innerHTML = '';
        window.DAILY_REWARDS.forEach((r, idx) => {
          const card = document.createElement('div');
          card.style.minWidth = "120px";
          card.style.padding = "10px";
          card.style.borderRadius = "8px";
          card.style.background = (idx === (state.dailyDay || 0)) ? "#0f0" : "#333";
          card.style.color = "#fff";
          card.innerHTML = `
            <div style="font-size:32px">${r.icon || ''}</div>
            <div>D√≠a ${idx + 1}</div>
            <div style="font-size:14px">${r.label || ''}</div>
          `;
          carousel.appendChild(card);
        });
      }
      dailyModal.classList.remove('hidden');
    };

    // DEFINIR claimDailyReward (estable y con debug)
    window.claimDailyReward = function(){
      console.log("DEBUG claimDailyReward (nuevo) ejecutado");
      try {
        const today = new Date().toDateString();
        if(state.lastDailyClaim === today){
          console.log("DEBUG: ya reclamado hoy");
          alert("Ya reclamaste la recompensa de hoy.");
          return;
        }

        if(!Array.isArray(window.DAILY_REWARDS) || window.DAILY_REWARDS.length === 0){
          console.error("DEBUG: DAILY_REWARDS no definido o vac√≠o");
          alert("No hay recompensas definidas. Mira la consola.");
          return;
        }

        const reward = window.DAILY_REWARDS[state.dailyDay] || window.DAILY_REWARDS[window.DAILY_REWARDS.length - 1];
        console.log("DEBUG: recompensa seleccionada:", reward);

        switch(reward.type){
          case "coins":
            state.sig = (state.sig || 0) + (reward.amount || 0);
            console.log(`DEBUG: +${reward.amount} Œ£C`);
            break;
          case "power":
            // compatibilidad con estructuras previas
            const mult = (reward.effect && reward.effect === "x2") ? 2 : 1;
            state.perClickMult = (state.perClickMult || 1) * mult;
            if(reward.duration) setTimeout(()=> { state.perClickMult = (state.perClickMult || 1) / mult; }, (reward.duration || 60) * 1000);
            console.log("DEBUG: power aplicado", reward);
            break;
          case "foso":
            if(reward.foso) {
              FOSOS.push(reward.foso);
              console.log("DEBUG: foso a√±adido:", reward.foso);
            }
            break;
          default:
            console.warn("DEBUG: tipo de recompensa desconocido", reward);
        }

        state.lastDailyClaim = today;
        state.dailyDay = (state.dailyDay || 0) + 1;

        if(typeof saveState === 'function') try { saveState(); } catch(e){ console.warn('saveState err', e); }
        if(typeof render === 'function') try { render(); } catch(e){ console.warn('render err', e); }
        if(typeof renderShop === 'function') try { renderShop(); } catch(e){ console.warn('renderShop err', e); }

        if(dailyModal) dailyModal.classList.add('hidden');
        console.log("DEBUG: claim complete ‚Äî sig:", state.sig, "dailyDay:", state.dailyDay);
        alert(`Has ganado: ${reward.label || 'recompensa'}`);
      } catch(err){
        console.error("DEBUG claimDailyReward error:", err);
        alert("Error al reclamar. Mira la consola para detalles.");
      }
    };

    // Adjuntar listeners nuevos (solo uno)
    if(btnDaily){
      btnDaily.addEventListener('click', () => {
        console.log("EVENT: click en btnDaily");
        window.openDailyModal();
      });
    } else console.warn("btnDaily no existe en DOM (no se a√±adi√≥ listener)");

    if(btnClaimDaily){
      btnClaimDaily.addEventListener('click', () => {
        console.log("EVENT: click en btnClaimDaily");
        window.claimDailyReward();
      });
    } else console.warn("btnClaimDaily no existe en DOM (no se a√±adi√≥ listener)");

    if(closeDaily){
      closeDaily.addEventListener('click', () => {
        console.log("EVENT: click en closeDaily");
        if(dailyModal) dailyModal.classList.add('hidden');
      });
    } else console.warn("closeDaily no existe en DOM (no se a√±adi√≥ listener)");

    console.log("DEBUG daily-fix: listeners nuevos instalados");
  });
})();


</script>
<!-- FIN bloque reparaci√≥n -->



</script>
</body>
</html>
