<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Foso Tycoon — Juego</title>
<style>
  :root{
    --bg:#071026; --panel:#0b1220; --accent:#f59e0b; --muted:#93a3b8;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:#eef6ff;
    /* Fondo mejorado estilo cielo con nubes suaves y degradé vertical */
    background:
      linear-gradient(180deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 25%),
      radial-gradient(ellipse at top, rgba(255,255,255,0.20) 0%, rgba(0,0,0,0) 60%),
      linear-gradient(180deg, #1291ff 0%, #0a63c4 40%, #092048 100%);
    background-attachment: fixed;
  }
  /* Capa de nubes parallax sutil */
  .bg-clouds::before{
    content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
    background:
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 200"><g fill="%23ffffff" opacity="0.15"><ellipse cx="120" cy="120" rx="120" ry="60"/><ellipse cx="260" cy="100" rx="160" ry="70"/><ellipse cx="480" cy="120" rx="140" ry="60"/><ellipse cx="680" cy="110" rx="180" ry="75"/></g></svg>') repeat-x top/1200px auto;
    animation: cloudsMove 35s linear infinite;
    filter: blur(1px);
  }
  @keyframes cloudsMove{ from{ background-position-x:0; } to{ background-position-x:-1200px; } }
  .wrap{max-width:1200px;margin:18px auto;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:18px}
  header{display:flex;align-items:center;gap:12px}
  header h1{margin:0;font-size:20px}
  .stage{background:linear-gradient(180deg,#071328,#061026);border-radius:12px;padding:18px;display:flex;flex-direction:column;align-items:center;gap:12px;box-shadow:0 12px 30px rgba(0,0,0,0.6)}
  .topRow{width:100%;display:flex;justify-content:space-between;align-items:center}
  .bigCounter{font-size:20px;font-weight:800}
  .metaTiny{font-size:12px;color:var(--muted)}
  .vaperWrap{width:300px;height:360px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .vaperWrap svg{width:72%;height:auto;max-height:90%;cursor:pointer;user-select:none}
  /* Smoke overlay */
  .smoke-layer{position:absolute;inset:0;pointer-events:none;overflow:visible}
  .smoke{position:absolute;width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.6);filter:blur(0.5px);animation:smokeUp 1.2s ease-out forwards;will-change:transform,opacity}
  @keyframes smokeUp{0%{transform:translateY(0) scale(0.8);opacity:.85}100%{transform:translateY(-120px) scale(1.6);opacity:0}}
  /* Shop title fit for long names */
  .shopGrid .shopCard > div[style*="font-weight:700"]{font-size:13px;text-align:center;line-height:1.15}
  .controlsRow{display:flex;gap:10px;width:100%;justify-content:center;flex-wrap:wrap}
  .mata-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.08));color:#eef6ff;font-weight:800;cursor:pointer;box-shadow:0 4px 14px rgba(0,0,0,0.35);transition:transform .15s ease, box-shadow .15s ease, background .2s ease}
  .mata-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(0,0,0,0.45)}
  .mata-btn:active{transform:translateY(0)}
  .mata-btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  .mata-btn[disabled]{opacity:.45;cursor:not-allowed}
  .mata-btn .icon{width:18px;height:18px;stroke:#081018;stroke-width:2;fill:none}
  .icon-16{width:16px;height:16px}
  .icon-20{width:20px;height:20px}
  .social-bar{position:fixed;bottom:14px;left:50%;transform:translateX(-50%);display:flex;gap:12px;padding:8px 12px;background:rgba(8,16,24,0.6);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.08);border-radius:14px;z-index:9998}
  .social-bar a{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:10px;color:#cbd5e1;background:rgba(255,255,255,0.04);transition:background .2s ease, transform .15s ease, color .2s ease}
  .social-bar a:hover{background:rgba(255,255,255,0.1);color:#fff;transform:translateY(-2px)}
  .social-bar svg{width:18px;height:18px;stroke:currentColor;fill:none;stroke-width:2;vector-effect:non-scaling-stroke}
  .panel{background:var(--glass);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .shopGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px;max-height:520px;overflow:auto;padding-right:6px}
  .shopCard{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px;border-radius:8px;display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
  .shopCard img, .shopCard svg{width:72px;height:auto}
  .priceTag{background:rgba(0,0,0,0.25);padding:4px 6px;border-radius:6px;font-weight:700;font-size:13px}
  .icon-sm{width:18px;height:18px;vertical-align:middle}
  .hint{color:var(--muted);font-size:13px}
  footer{grid-column:1/-1;margin-top:10px;text-align:center;color:var(--muted);font-size:13px}
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr;padding:12px}
    .vaperWrap{width:320px;height:420px}
  }
  @media (max-width:600px){
    .wrap{padding:12px}
    header h1{font-size:18px}
    .bigCounter{font-size:18px}
    .vaperWrap{width:280px;height:360px}
    .shopGrid{grid-template-columns:repeat(2,1fr)}
    .social-bar{gap:8px;padding:6px 8px}
    .social-bar a{width:32px;height:32px}
  }
  /* Modal mejorado: glass + bordes suaves + encabezado */
  .modal { position: fixed; inset:0; display:flex; justify-content:center; align-items:center; z-index:9999; background: rgba(3,10,20,0.65); backdrop-filter: blur(6px); }
  .modal.hidden { display:none; }
  .modal-content {
    position: relative;
    background: linear-gradient(180deg, rgba(12,18,30,0.85), rgba(6,10,18,0.85));
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 20px 60px rgba(0,0,0,0.55);
    border-radius: 16px;
    padding: 18px 18px 14px;
    width: min(94%, 980px); max-height: 84vh; overflow: hidden; color: #e7edf6; font-family: Inter, system-ui, Arial;
  }
  .modal-header { display:flex; align-items:center; justify-content:space-between; gap:10px; padding-bottom:10px; border-bottom:1px solid rgba(255,255,255,0.06); }
  .modal-title { font-weight:800; letter-spacing:.2px; }
  .close-btn { display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:8px; cursor:pointer; color:#9fb2c8; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06); }
  .close-btn:hover { background:rgba(255,255,255,0.08); color:#fff; }
  .modal-body { overflow:auto; max-height: calc(84vh - 56px); padding-top:12px; }
.powers-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  gap: 15px;
  margin-top: 20px;
}
.power-card {
  background: #222;
  border: 1px solid #444;
  border-radius: 8px;
  padding: 12px;
  transition: transform 0.2s, box-shadow 0.2s;
}
.power-card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 12px #0ff;
}
.power-card button {
  margin-top: 10px;
  width: 100%;
  padding: 6px;
  background: #0ff;
  border: none;
  border-radius: 6px;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}
.power-card button:disabled {
  background: #444; color:#999; cursor: not-allowed;
}


/* Humo animado */
.smoke {
  position: absolute;
  bottom: 80px; /* punto de salida aprox. del foso */
  left: 50%;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.7);
  transform: translateX(-50%) scale(0.8);
  animation: smokeUp 2.5s ease-out forwards;
  pointer-events: none;
}

@keyframes smokeUp {
  0% {
    transform: translate(-50%, 0) scale(0.8);
    opacity: 0.8;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    transform: translate(-50%, -150px) scale(1.5);
    opacity: 0;
  }
}

.smoke circle {
  fill: lightgray;
  opacity: 0.8;
  animation: rise 3s infinite ease-in-out;
}

.smoke circle:nth-child(2) {
  animation-delay: 1s;
}
.smoke circle:nth-child(3) {
  animation-delay: 2s;
}

@keyframes rise {
  0% {
    transform: translateY(0) scale(0.5);
    opacity: 0;
  }
  20% {
    opacity: 0.8;
  }
  100% {
    transform: translateY(-60px) scale(1.6);
    opacity: 0;
  }
}

.smoke path {
  fill: lightgray;
  opacity: 0.7;
  animation: puff 4s infinite ease-in-out;
}

@keyframes puff {
  0% {
    transform: translateY(0) scale(0.6);
    opacity: 0;
  }
  20% {
    opacity: 0.8;
  }
  100% {
    transform: translateY(-80px) scale(1.8);
    opacity: 0;
  }
}

.smoke ellipse {
  fill: lightgray;
  opacity: 0.7;
  animation: puff 5s infinite ease-in-out;
}

.smoke ellipse:nth-child(2) {
  animation-delay: 1.5s;
}
.smoke ellipse:nth-child(3) {
  animation-delay: 3s;
}

@keyframes puff {
  0%   { transform: translateY(0) scale(0.6); opacity: 0; }
  20%  { opacity: 0.8; }
  100% { transform: translateY(-80px) scale(1.8); opacity: 0; }
}

#autoClickPointer {
  position: absolute;
  width: 24px;         /* más pequeño */
  height: 24px;
  background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23ffffff' d='M3 2l7 18 2-7 7-2z'/><path fill='%23000000' opacity='0.2' d='M10 20l2-7 7-2-9 9z'/></svg>") no-repeat center;
  background-size: contain;
  pointer-events: none;  /* no bloquea nada */
  opacity: 0;
  transform: scale(1);
  transition: transform 0.15s ease, opacity 0.15s ease;
  z-index: 1;           /* por debajo de UI pero encima del foso */
}
#autoClickPointer.active {
  opacity: 0.8;         /* aparece más sutil */
  transform: scale(0.7);
}

.hidden {
  display: none !important;
}


.notify-dot {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 10px;
  height: 10px;
  background: red;
  border-radius: 50%;
}
.button-wrapper {
  position: relative;
  display: inline-block;
}

</style>
  <link rel="icon" type="image/png" href="logo%20oficial.png">
  <link rel="apple-touch-icon" href="logo%20oficial.png">
  <meta property="og:image" content="logo%20oficial.png">
</head>
<body>
  <!-- Pantalla de advertencia mejorada -->
  <div id="advertencia" style="position:fixed;inset:0;background:#000;display:flex;justify-content:center;align-items:center;z-index:9999">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600" style="width:80%;height:auto">
      <defs>
        <radialGradient id="gBg" cx="50%" cy="40%" r="70%">
          <stop offset="0%" stop-color="#111"/>
          <stop offset="100%" stop-color="#000"/>
        </radialGradient>
      </defs>
      <rect width="800" height="600" fill="url(#gBg)"/>
      <polygon points="400,100 500,300 300,300" fill="yellow" stroke="black" stroke-width="5"/>
      <text x="400" y="270" text-anchor="middle" font-size="80" fill="black" font-weight="bold">!</text>
      <text x="400" y="380" text-anchor="middle" font-size="28" fill="white" font-family="Arial" font-weight="bold">FOSO IDLE TYCOON es una obra de ficción.</text>
      <text x="400" y="420" text-anchor="middle" font-size="24" fill="white" font-family="Arial">Fumar y vapear dañan la salud y generan adicción.</text>
      <text x="400" y="460" text-anchor="middle" font-size="22" fill="white" font-family="Arial">Juega de forma responsable.</text>
    </svg>
  </div>
  <script>
    // Bloquear scroll y ocultar advertencia tras 3s
    document.documentElement.style.overflow = 'hidden';
    setTimeout(()=>{
      const adv = document.getElementById('advertencia');
      if(adv) adv.style.display = 'none';
      document.documentElement.style.overflow = '';
    }, 3000);
  </script>
  
  <div class="wrap">
    <div>
      <header>
        <svg width="44" height="44" viewBox="0 0 64 64" aria-hidden>
          <rect x="6" y="6" width="52" height="52" rx="10" fill="#081026" stroke="#f59e0b" stroke-width="2" />
        </svg>
        <div>
          <h1>Foso Tycoon</h1>
          <div class="hint">Haz click en el foso grande; compra fosos desde la tienda (clic en miniaturas).</div>
        </div>
      </header>




      <main style="margin-top:14px">
        <section class="stage">
          <div class="topRow">
            <div>
              <div class="bigCounter">Sigmacoin: <span id="sigTotal">0</span> ΣC</div>
              <div class="metaTiny">Por clic: <span id="perClick">1</span> ΣC • Clicks totales: <span id="totalClicks">0</span></div>
            </div>
            <div class="panel" style="display:flex;align-items:center;gap:8px">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
              <div style="display:flex;flex-direction:column;gap:2px">
                <div style="font-weight:800">Racha: <span id="dailyStreak">0</span> días</div>
                <div class="metaTiny" id="streakHint">Vuelve cada día para aumentar tu racha</div>
              </div>
            </div>
          </div>

          <!-- Vaper grande (click anywhere on SVG) -->
          <div class="vaperWrap" id="vaperWrap" title="Haz click en cualquier parte del foso para generar ΣC">
            <div id="smokeLayer"></div>
            <!-- Ejemplo Foso Básico Tropical (inline SVG) -->
            <svg id="centralFoso" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 260" role="img" aria-label="Foso central">
              <rect x="20" y="20" width="60" height="220" rx="12" ry="12" fill="url(#g1)" stroke="#0b0c2a" stroke-width="3"/>
              <rect x="20" y="0" width="60" height="20" rx="10" ry="10" fill="url(#mouth1)"/>
<!-- Pantalla central -->
<!--rect x="35" y="110" width="30" height="40" rx="4" ry="4" fill="#000" id="centralScreen"/-->
<!-- PANTALLA CENTRAL (dentro del svg centralFoso) -->
<rect x="35" y="100" width="30" height="50" rx="4" ry="4" fill="#000" id="centralScreen"/>
<text id="batteryText" x="50" y="125" font-size="10" fill="#0f0" text-anchor="middle">0%</text>


  <!-- niveles: vamos a usar máscaras para "llenar" o simplemente cambiar color/opacity -->
  <!-- para simplicidad controlamos solo el color/opacity del path según drops -->


<!-- Texto de porcentaje -->




              <defs>
                <linearGradient id="g1" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#f1c40f"/>
                  <stop offset="50%" stop-color="#2ecc71"/>
                  <stop offset="100%" stop-color="#1e3799"/>
                </linearGradient>
                <linearGradient id="mouth1" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#2c2c54"/>
                  <stop offset="100%" stop-color="#000"/>
                </linearGradient>
                <linearGradient id="batteryGrad" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stop-color="#00ff99"/>
                  <stop offset="100%" stop-color="#00a86b"/>
                </linearGradient>
              </defs>
            </svg>
              <div id="autoClickPointer"></div> 
          </div>

         <div class="controlsRow" id="controlsRow">

  <!-- Fila 1 -->
  <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; width:100%">
    <button id="btnPower" class="mata-btn" style="background:#0ea5b7">
      <svg class="icon" viewBox="0 0 24 24"><path d="M12 2v8"/><path d="M5.2 5.2a9 9 0 1 0 12.7 0"/></svg>
      Power
    </button>

    <button id="btnChargeToggle" class="mata-btn" style="background:#00cfff">
      <svg class="icon" viewBox="0 0 24 24"><path d="M13 2 L4 14h6l-1 8 10-12h-7z" fill="currentColor"/></svg>
      <span id="chargeLabel">Cargar</span>
    </button>
    <button id="btnAutoClickToggle" class="mata-btn" style="background:#36d399">
      <svg class="icon" viewBox="0 0 24 24"><path d="M4 12h16M12 4v16" stroke="currentColor" fill="none"/></svg>
      Autoclicker: Off
    </button>
    <button id="btnAutoClickUpgrade" class="mata-btn" style="background:#60a5fa">
      <svg class="icon" viewBox="0 0 24 24"><path d="M12 2l3 6 6 1-4 4 1 6-6-3-6 3 1-6-4-4 6-1z" fill="currentColor"/></svg>
      Subir Autoclicker (Lv <span id="autoClickLevelLabel">0</span>/10)
    </button>

    <button id="btnNuevoFoso" class="mata-btn" style="background:#ffa726">
      <svg class="icon" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="3"/><path d="M12 8v8M8 12h8"/></svg>
      Nuevo Foso
    </button>

    <button id="btnMata" class="mata-btn" style="background:#ef4444">
      <svg class="icon" viewBox="0 0 24 24"><path d="M7 7l10 10M17 7L7 17"/><circle cx="12" cy="12" r="9"/></svg>
      <span id="mataLabel">Mata Foso</span>
    </button>
  </div>

  <!-- Fila 2 -->
  <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; width:100%">
    <button id="btnShop" class="mata-btn" style="background:#facc15">
      <svg class="icon" viewBox="0 0 24 24"><circle cx="9" cy="20" r="1.5"/><circle cx="18" cy="20" r="1.5"/><path d="M3 4h2l2 10h11l2-7H6"/></svg>
      Tienda
    </button>

    <button id="btnRebirth" class="mata-btn" style="background:#a78bfa">
      <svg class="icon" viewBox="0 0 24 24"><path d="M3 10v4h4"/><path d="M21 14v-4h-4"/><path d="M21 10a8 8 0 0 0-13.66-5.66L7 6"/><path d="M3 14a8 8 0 0 0 13.66 5.66L17 18"/></svg>
      Rebirth
    </button>

    <div class="button-wrapper">
      <button id="btnDaily" class="mata-btn">
        <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="16" rx="2"/><path d="M16 3v4M8 3v4M3 11h18"/></svg>
        Regalo Diario
      </button>
      <span id="dotDaily" class="notify-dot hidden"></span>
    </div>

    <div class="button-wrapper">
      <button id="btnAFK" class="mata-btn" style="background:#8e44ad">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
        Mejoras AFK
      </button>
      <span id="dotAFK" class="notify-dot hidden"></span>
    </div>
  </div>

  <!-- Fila 3 (alineada a la derecha) -->
  <div style="display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; width:100%">
    <!-- Promo Codes -->
    <div class="panel" style="display:flex; align-items:center; gap:8px; flex:1; max-width:300px">
      <input id="promoInput" placeholder="Código promo" 
             style="flex:1; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.12);
                    background:rgba(255,255,255,0.03); color:#eef6ff"/>
      <button id="promoBtn" class="mata-btn" style="background:#34d399">Canjear</button>
    </div>

    <button id="btnConfig" class="mata-btn" style="background:#c084fc">
      <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.11a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.11a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.06 3.3l.06.06a1.65 1.65 0 0 0 1.82.33H8a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.11a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06A2 2 0 1 1 20.7 6.06l-.06.06a1.65 1.65 0 0 0-.33 1.82V8c0 .64.39 1.22 1 1.51.35.17.73.49.73.49"/></svg>
      Configuración
    </button>
  </div>
</div>







          <div class="hint">Tienda: clic en la miniatura para equipar/comprar. El central cambia según lo equipado.</div>
        </section>
      </main>
    </div>

    <!-- Right column: tienda con 15 miniaturas -->
    
    <!-- Modal Tienda -->
<div id="shopModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" style="display:flex;align-items:center;gap:8px">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden><path fill="#f59e0b" d="M7 18a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm10 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4ZM5 4h2l2 10h11l2-7H6.2L5.3 4Z"/></svg>
        Tienda — Fositos
      </div>
      <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body">

    <!-- Aquí metemos la tienda -->
    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;align-items:center;gap:8px">
          <!-- Carrito SVG -->
          <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden>
            <path fill="#f59e0b" d="M7 18c-1.1 0-1.99.9-1.99 
            2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 
            0c-1.1 0-1.99.9-1.99 2S15.9 22 17 
            22s2-.9 2-2-.9-2-2-2zM7.16 
            14h9.45c.75 0 1.41-.41 
            1.75-1.03l3.58-6.49c.37-.67-.11-1.48-.88-1.48H6.21L5.27 
            2H2v2h2l3.6 7.59-1.35 
            2.45C5.52 14.37 6.23 15 7.07 
            15h11.93v-2H7.42l.74-1.35z"/>
          </svg>
          <div style="font-weight:800">Tienda — Fositos</div>
        </div>
        <div class="metaTiny">ΣC: <span id="shopSigma">0</span></div>
      </div>

      <div class="shopGrid" id="shopGrid">

      

 
        <div class="shopCard" data-index="0" title="Foso 1: Mango Ice 🥭❄️ (0 ΣC)">
  <div class="metaTiny" style="font-weight:800">Foso 1: Mango Ice 🥭❄️</div>
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g1_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth1_shop)"/>
<!-- Humo del foso central -->
<!-- Humo del foso central (nube más realista) -->
<!-- Humo del foso central (3 óvalos juntos → nube) -->
<g class="smoke">
  <ellipse cx="50" cy="40" rx="18" ry="12" />
  <ellipse cx="65" cy="35" rx="14" ry="10" />
  <ellipse cx="40" cy="35" rx="14" ry="10" />
</g>


    <defs>
      <linearGradient id="g1_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#f1c40f"/><stop offset="50%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#1e3799"/>
      </linearGradient>
      <linearGradient id="mouth1_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 1: Mango Ice 🥭❄️</div>
  <div class="priceTag">0 ΣC</div>
</div>

<!-- 2 -->
<div class="shopCard" data-index="1" title="Foso 2: Strawberry Kiwi 🍓🥝 (200 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g2_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth2_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g2_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff7675"/><stop offset="100%" stop-color="#fd7e14"/></linearGradient>
      <linearGradient id="mouth2_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 2: Strawberry Kiwi 🍓🥝</div>
  <div class="priceTag">100 ΣC</div>
</div>

<!-- 3 -->
<div class="shopCard" data-index="2" title="Foso 3: Blue Razz 🫐💙 (400 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g3_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth3_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g3_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00c6ff"/><stop offset="100%" stop-color="#0072ff"/></linearGradient>
      <linearGradient id="mouth3_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 3: Blue Razz 🫐💙</div>
  <div class="priceTag">10&nbsp;000</div>
</div>

<!-- 4 -->
<div class="shopCard" data-index="3" title="Foso 4: Watermelon Ice 🍉❄️ (1 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g4_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth4_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g4_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ecf0f1"/><stop offset="100%" stop-color="#95a5a6"/></linearGradient>
      <linearGradient id="mouth4_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 4: Watermelon Ice 🍉❄️</div>
  <div class="priceTag">100&nbsp;000</div>
</div>

<!-- 5 -->
<div class="shopCard" data-index="4" title="Foso 5: Pineapple Coconut 🍍🥥 (5 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g5_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth5_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g5_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffd700"/><stop offset="100%" stop-color="#ffb400"/></linearGradient>
      <linearGradient id="mouth5_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 5: Pineapple Coconut 🍍🥥</div>
  <div class="priceTag">1&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 6 -->
<div class="shopCard" data-index="5" title="Foso 6: Grape Ice 🍇❄️ (20 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g6_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth6_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g6_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#9b59b6"/><stop offset="100%" stop-color="#2c003e"/></linearGradient>
      <linearGradient id="mouth6_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">10&nbsp;000&nbsp;000 </div>
  <div class="priceTag">20&nbsp;000 ΣC</div>
</div>

<!-- 7 -->
<div class="shopCard" data-index="6" title="Foso 7: Peach Mango 🍑🥭 (50 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g7_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth7_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g7_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff0000"/><stop offset="100%" stop-color="#000"/></linearGradient>
    <linearGradient id="mouth7_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 7: Peach Mango 🍑🥭</div>
  <div class="priceTag">100&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 8 -->
<div class="shopCard" data-index="7" title="Foso 8: Cola Ice 🥤❄️ (80 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g8_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth8_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g8_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#00aaff"/></linearGradient>
    <linearGradient id="mouth8_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 8: Cola Ice 🥤❄️</div>
  <div class="priceTag">1&nbsp;000&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 9 -->
<div class="shopCard" data-index="8" title="Foso 9: Lychee Rose 🌸🍒 (120 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g9_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth9_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g9_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#145a32"/></linearGradient>
    <linearGradient id="mouth9_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 9: Lychee Rose 🌸🍒</div>
  <div class="priceTag">10&nbsp;000&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 10 -->
<div class="shopCard" data-index="9" title="Foso 10: Apple Mint 🍏🌿 (250 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g10_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth10_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g10_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff5733"/><stop offset="100%" stop-color="#900c3f"/></linearGradient>
    <linearGradient id="mouth10_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 10: Apple Mint 🍏🌿</div>
  <div class="priceTag">100&nbsp;000&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 11 -->
<div class="shopCard" data-index="10" title="Foso 11: Banana Ice Cream 🍌🍦 (500 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g11_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth11_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g11_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#39ff14"/><stop offset="100%" stop-color="#0ff"/></linearGradient>
    <linearGradient id="mouth11_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 11: Banana Ice Cream 🍌🍦</div>
  <div class="priceTag">1&nbsp;000&nbsp;000&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 12 -->
<div class="shopCard" data-index="11" title="Foso 12: Lemon Tart 🍋🥧 (1 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g12_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth12_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs><linearGradient id="g12_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00f5ff"/><stop offset="50%" stop-color="#7f00ff"/><stop offset="100%" stop-color="#00ff88"/></linearGradient>
    <linearGradient id="mouth12_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700">Foso 12: Lemon Tart 🍋🥧</div>
  <div class="priceTag">10&nbsp;000&nbsp;000&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 13 -->
<div class="shopCard" data-index="12" title="Foso 13: Cherry Cola 🍒🥤 (2 500 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g13_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth13_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g13_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#cd7f32"/><stop offset="100%" stop-color="#6e2c00"/>
      </linearGradient>
      <linearGradient id="mouth13_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 13: Cherry Cola 🍒🥤</div>
  <div class="priceTag">100&nbsp;000&nbsp;000&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 14 -->
<div class="shopCard" data-index="13" title="Foso 14: Cotton Candy 🍭 (5 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g14_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth14_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g14_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#85c1e9"/>
      </linearGradient>
      <linearGradient id="mouth14_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 14: Cotton Candy 🍭</div>
  <div class="priceTag">1&nbsp;000&nbsp;000&nbsp;000&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- 15 (especial: cuerpo cambia rojo->azul->verde con animate) -->
<div class="shopCard" data-index="14" title="Foso 15: Black Diamond Reserve 💎🔥 (10 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g15_shop)" stroke="#222" stroke-width="1"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth15_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#000"/>
    <defs>
      <linearGradient id="g15_shop" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="red">
          <animate attributeName="stop-color" values="red;blue;green;red" dur="3s" repeatCount="indefinite"/>
        </stop>
        <stop offset="100%" stop-color="red">
          <animate attributeName="stop-color" values="red;blue;green;red" dur="3s" repeatCount="indefinite"/>
        </stop>
      </linearGradient>
      <linearGradient id="mouth15_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700">Foso 15: Black Diamond Reserve 💎🔥</div>
  <div class="priceTag">10&nbsp;000&nbsp;000&nbsp;000&nbsp;000&nbsp;000 ΣC</div>
</div>

<!-- --- SECCION: Mejoras permanentes --- -->
<div style="grid-column:1/-1; font-weight:800; margin-top:10px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.03)">
  🔧 Mejoras permanentes
</div>

<!-- Upgrade: Batería -->
<div class="shopCard" data-upgrade="battery_plus50" title="Aumenta la batería en +50">
  <div class="metaTiny" style="font-weight:700">Batería +50</div>
  <div class="priceTag"></div>
</div>

<!-- Upgrade: Auto-clicker -->
<div class="shopCard" data-upgrade="autoclick_1" title="Añade 1 clic automático por segundo">
  <div class="metaTiny" style="font-weight:700">Auto-clicker +1 CPS</div>
  <div class="priceTag"></div>
</div>

<!-- Upgrade: Extra clic -->
<div class="shopCard" data-upgrade="extra_click" title="Permite 1 clic extra antes de gastar batería">
  <div class="metaTiny" style="font-weight:700">+1 clic extra</div>
  <div class="priceTag"></div>
</div>


      </div>
    </aside>

    </div>
  </div>
</div>
  </div>
</div>



  
    <footer>
      <div style="display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap">
        <span class="metaTiny">Síguenos:</span>
        <a href="https://instagram.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://tiktok.com/@sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://x.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://facebook.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://youtube.com/@sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
      </div>
      <div class="metaTiny" style="margin-top:6px">Maqueta funcional — HTML/CSS/JS puro. Guardado automático en localStorage.</div>
    </footer>
  </div>
   <button id="btnSigmaHack">💰 Sigma Infinito</button>
  <!-- Modal Poderes -->
<div id="powersModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Poderes</h2>
    <div id="powersGrid" class="powers-grid"></div>
  </div>
</div>

<!-- Modal Configuración -->
<div id="configModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>⚙️ Configuración</h2>

    <div class="config-grid">
      <!-- Tema -->
      <div class="config-item">
        <label for="themeSelect">Tema 🎨</label>
        <select id="themeSelect">
          <option value="dark">Oscuro</option>
          <option value="light">Claro</option>
          <option value="neon">Neón</option>
        </select>
      </div>

      <!-- Animaciones -->
      <div class="config-item">
        <label>
          <input type="checkbox" id="chkAnimations" checked>
          Activar Animaciones ✨
        </label>
      </div>

      <!-- Reset -->
      <div class="config-item">
        <button id="btnReset" style="background:#ff4d4d;color:#fff;padding:8px 14px;border:none;border-radius:6px;cursor:pointer">
          Borrar Progreso 💣
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Modal Recompensas Diarias -->
<div id="dailyModal" class="hidden" style="
  position: fixed; top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.8); display:flex;
  align-items:center; justify-content:center;
  z-index:1000;">

  <div style="background:#111; padding:20px; border-radius:12px;
              max-width:600px; width:90%; text-align:center; color:#fff; position:relative;">

    <span id="closeDaily" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:28px;">&times;</span>
    <h2>🎁 Recompensas Diarias</h2>

    <div id="carousel" style="display:flex; overflow-x:auto; gap:15px; padding:10px;">
      <!-- Tarjetas generadas por JS -->
    </div>

    <button id="btnClaimDaily" style="margin-top:15px; padding:8px 16px; font-weight:bold;">
      Reclamar de hoy
    </button>
  </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" style="
  position: fixed;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 9999;
"></div>

<!-- Modal AFK -->
<div id="afkModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>⏰ Mejoras AFK</h2>
    <p id="afkInfo"></p>
    <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
      <button id="btnUpgradeAFK" class="mata-btn">⬆️ Mejorar</button>
      <button id="btnClaimAFK" class="mata-btn">💰 Reclamar</button>
    </div>
  </div>
</div>




<script>
// --- Configuración de recompensas diarias ---
const DAILY_REWARDS = [
  { type: "coins", amount: 100, label: "100 ΣC", icon: "💰" },
  { type: "coins", amount: 500, label: "500 ΣC", icon: "💰" },
  { type: "power", effect: "x2", duration: 60, label: "Poder x2 por 1 min", icon: "⚡" },
  { type: "coins", amount: 2000, label: "2000 ΣC", icon: "💰" },
  { type: "power", effect: "x2", duration: 300, label: "Poder x2 por 5 min", icon: "⚡" },
  { 
    type: "foso",
    foso: {
      name: "Foso Especial 💎",
      perClick: 100,
      svg: `
        <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
          <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#gSpecial)"/>
          <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouthSpecial)"/>
          <defs>
            <linearGradient id="gSpecial" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#00eaff"/>
              <stop offset="100%" stop-color="#0077ff"/>
            </linearGradient>
            <linearGradient id="mouthSpecial" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#2c2c54"/>
              <stop offset="100%" stop-color="#000"/>
            </linearGradient>
          </defs>
        </svg>`
    },
    label: "Foso Especial (100 ΣC/click)", icon: "💎"
  }
];


(function () {
  document.addEventListener('DOMContentLoaded', () => {
    const btnAFK = document.getElementById('btnAFK');
    const afkModal = document.getElementById('afkModal');
    const afkInfo = document.getElementById('afkInfo');
    const btnUpgrade = document.getElementById('btnUpgradeAFK');
    const btnClaim = document.getElementById('btnClaimAFK');

    if (!btnAFK || !afkModal || !afkInfo || !btnUpgrade || !btnClaim) {
      console.warn('AFK: faltan elementos (btnAFK / afkModal / btnUpgradeAFK / btnClaimAFK).');
      return;
    }

    // Forzar que el botón esté activo
    try {
      btnAFK.removeAttribute('disabled');
      btnAFK.style.pointerEvents = 'auto';
      btnAFK.style.opacity = '';
      btnAFK.style.cursor = 'pointer';
    } catch(e){/* noop */ }

    function afkMaxPerHour(level) {
      const min = 1000;
      const max = 100000;
      const l = (typeof level === 'number' && !isNaN(level)) ? level : 0;
      const capped = Math.max(0, Math.min(10, Math.floor(l)));
      return Math.round(min + ((max - min) / 10) * capped);
    }

function updateAFKInfo() {
  const lvl = Number(state.afkLevel) || 0;
  const maxHour = afkMaxPerHour(lvl);
  const nextCost = 5000 * (lvl + 1);

  // Tiempo y recompensa acumulada
  const now = Date.now();
  const last = state.afkLastClaim || now;
  const minutesElapsed = Math.floor((now - last) / (1000 * 60));
  const blocks = Math.floor(minutesElapsed / 15);
  const reward = Math.max(0, blocks * (maxHour / 4)); // acumulado por bloques de 15 min
  const minutesToNext = 15 - (minutesElapsed % 15);

  // Texto base
  let info = `Nivel actual: ${lvl} • Máx/hora: ${maxHour.toLocaleString()} ΣC\n`;

  if (lvl >= 10) {
    info += `⚡ Nivel máximo alcanzado\n`;
    btnUpgrade.textContent = "⬆️ Mejorar (MAX)";
    btnUpgrade.setAttribute("disabled", "true");
  } else {
    info += `Costo próxima mejora: ${nextCost.toLocaleString()} ΣC\n`;
    btnUpgrade.textContent = `⬆️ Mejorar (${nextCost.toLocaleString()} ΣC)`;
    btnUpgrade.removeAttribute("disabled");
  }

  info += `\n💰 Acumulado: ${Math.floor(reward).toLocaleString()} ΣC`;
  info += `\n⏳ Próximo reclamo en: ${minutesToNext} min`;

  afkInfo.textContent = info;
}

// Actualizar cada segundo el contador
setInterval(() => {
  if (!afkModal.classList.contains("hidden")) {
    updateAFKInfo();
  }
}, 1000);


    // Abrir modal AFK
    btnAFK.addEventListener('click', () => {
      updateAFKInfo();
      afkModal.classList.remove('hidden');
    });

    // Cerrar modal
    const closeBtn = afkModal.querySelector('.close-btn');
    if (closeBtn) closeBtn.addEventListener('click', () => afkModal.classList.add('hidden'));

    // Mejorar AFK
    btnUpgrade.addEventListener("click", () => {
      if (!state) state = {};

      const lvl = Number(state.afkLevel) || 0;
      const cost = 5000 * (lvl + 1);
      const sigmas = Number(state.sig) || 0; // ✅ usamos state.sig real

      console.log("DEBUG AFK >>> lvl:", lvl, "cost:", cost, "sigmas:", sigmas);

      if (sigmas < cost) {
        if (typeof showToast === "function") {
          showToast("❌ No tienes suficientes ΣC", "error");
        } else {
          alert("No tienes suficientes ΣC");
        }
        return;
      }

      // aplicar mejora
      state.sig = sigmas - cost;
      state.afkLevel = Math.min(10, lvl + 1);

      if (typeof saveState === "function") saveState();
      if (typeof render === "function") render();
      updateAFKInfo();

      if (typeof showToast === "function") {
        showToast(`⬆️ AFK mejorado a nivel ${state.afkLevel}`, "success");
      }
    });

    // Reclamar AFK (cada 15 minutos)
    btnClaim.addEventListener('click', () => {
      if (!state) state = {};
      const now = Date.now();
      const last = state.afkLastClaim || now;

      // Diferencia en minutos
      const minutesElapsed = Math.floor((now - last) / (1000 * 60));

      // Requiere al menos 15 minutos
      if (minutesElapsed < 15) {
        if (typeof showToast === 'function') {
          showToast('⏳ Debes esperar al menos 15 minutos para reclamar', 'info');
        } else {
          alert('Debes esperar al menos 15 minutos para reclamar');
        }
        return;
      }

      // Recompensa proporcional en bloques de 15 minutos
      const blocks = Math.floor(minutesElapsed / 15); // cuántos bloques de 15m
      const perHour = afkMaxPerHour(Number(state.afkLevel) || 0);
      const reward = Math.max(0, blocks * (perHour / 4)); // dividir hora en 4 bloques de 15m

      if (reward <= 0) {
        if (typeof showToast === 'function') showToast('⚠️ Nada para reclamar aún', 'warning');
        else alert('Nada para reclamar');
        return;
      }

      state.sig = (Number(state.sig) || 0) + Math.floor(reward);
      state.afkLastClaim = now;

      if (typeof saveState === 'function') saveState();
      if (typeof render === 'function') render();
      if (typeof showToast === 'function') {
        showToast(`💰 Reclamas ${Math.floor(reward).toLocaleString()} ΣC de AFK`, 'success');
      }
      updateAFKInfo();
    });

    // Estado inicial
    updateAFKInfo();
  });
})();



document.addEventListener("DOMContentLoaded", () => {
  const dailyModal = document.getElementById("dailyModal");
  const btnDaily = document.getElementById("btnDaily");
  const btnClaimDaily = document.getElementById("btnClaimDaily");
  const closeDaily = document.getElementById("closeDaily");
  const carousel = document.getElementById("carousel");

  let countdownInterval;

  // --- Formatear tiempo en hh:mm:ss ---
  function formatTime(ms) {
    const totalSec = Math.max(0, Math.floor(ms / 1000));
    const h = String(Math.floor(totalSec / 3600)).padStart(2, "0");
    const m = String(Math.floor((totalSec % 3600) / 60)).padStart(2, "0");
    const s = String(totalSec % 60).padStart(2, "0");
    return `${h}:${m}:${s}`;
  }

  // --- Abrir modal y rellenar carrusel ---
  function openDailyModal() {
    if (!carousel) return;
    carousel.innerHTML = "";

    DAILY_REWARDS.forEach((reward, idx) => {
      const card = document.createElement("div");
      card.style.minWidth = "120px";
      card.style.padding = "10px";
      card.style.borderRadius = "8px";
      card.style.background = (idx === (state.dailyDay || 0)) ? "#facc15" : "#333";
      card.style.color = "#fff";
      card.style.textAlign = "center";

      let extra = "";
      if (idx === (state.dailyDay || 0) && state.nextDailyTime) {
        const msLeft = state.nextDailyTime - Date.now();
        if (msLeft > 0) {
          extra = `<div id="dailyCountdownCard" style="margin-top:6px; font-size:12px; color:#000">⏳ ${formatTime(msLeft)}</div>`;
        }
      }

      card.innerHTML = `
        <div style="font-size:32px">${reward.icon}</div>
        <div><strong>Día ${idx + 1}</strong></div>
        <div style="font-size:14px">${reward.label}</div>
        ${extra}
      `;
      carousel.appendChild(card);
    });

    updateCountdown();
    countdownInterval = setInterval(updateCountdown, 1000);

    dailyModal.classList.remove("hidden");
  }

  // --- Actualizar cuenta atrás ---
  function updateCountdown() {
    const btn = btnClaimDaily;
    const countdownCard = document.getElementById("dailyCountdownCard");

    if (!state.nextDailyTime) {
      btn.disabled = false;
      if (countdownCard) countdownCard.textContent = "";
      return;
    }

    const msLeft = state.nextDailyTime - Date.now();

    if (msLeft > 0) {
      btn.disabled = true;
      btn.textContent = `🎁 Reclamar recompensa diaria (⏳ ${formatTime(msLeft)})`;
      if (countdownCard) countdownCard.textContent = `⏳ ${formatTime(msLeft)}`;
    } else {
      btn.disabled = false;
      btn.textContent = "🎁 Reclamar recompensa diaria";
      if (countdownCard) countdownCard.textContent = "✅ Disponible!";
      clearInterval(countdownInterval);
    }
  }

  // --- Reclamar recompensa ---
  function claimDailyReward() {
    const now = Date.now();
    if (state.nextDailyTime && now < state.nextDailyTime) {
      showToast("Ya reclamaste tu recompensa diaria, vuelve más tarde!", "info");
      return;
    }

    const reward = DAILY_REWARDS[state.dailyDay] || DAILY_REWARDS[DAILY_REWARDS.length - 1];

    switch (reward.type) {
      case "coins":
        state.sig = (state.sig || 0) + reward.amount;
        break;

      case "power":
        const mult = reward.effect === "x2" ? 2 : 1;
        state.perClickMult = (state.perClickMult || 1) * mult;
        if (reward.duration) {
          setTimeout(() => { state.perClickMult /= mult; }, reward.duration * 1000);
        }
        break;

      case "foso":
        if (reward.foso) {
          FOSOS.push(reward.foso);
        }
        break;
    }

    state.lastDailyClaim = new Date().toDateString();
    state.dailyDay = (state.dailyDay || 0) + 1;
    state.nextDailyTime = now + 24 * 60 * 60 * 1000; // 24 horas

    if (typeof saveState === "function") saveState();
    if (typeof render === "function") render();
    if (typeof renderShop === "function") renderShop();

    showToast(`Has ganado: ${reward.label}`, "info");
    dailyModal.classList.add("hidden");
    clearInterval(countdownInterval);
  }

  // --- Listeners ---
  if (btnDaily) btnDaily.addEventListener("click", openDailyModal);

  if (btnClaimDaily) {
    btnClaimDaily.type = "button";
    btnClaimDaily.addEventListener("click", (e) => {
      e.stopPropagation();
      claimDailyReward();
    });
  }

  if (closeDaily) {
    closeDaily.addEventListener("click", (e) => {
      e.stopPropagation();
      dailyModal.classList.add("hidden");
      clearInterval(countdownInterval);
    });
  }

  if (dailyModal) {
    dailyModal.addEventListener("click", (e) => {
      if (e.target === dailyModal) {
        dailyModal.classList.add("hidden");
        clearInterval(countdownInterval);
      }
    });
  }
});
</script>




<!-- REEMPLAZA/PEGAR: Bloque limpio para Recompensas Diarias (solo 1 copia) -->

<!-- FIN bloque limpio -->



<style>
  .config-grid {
    display: grid;
    gap: 15px;
    margin-top: 20px;
  }
  .config-item {
    background: #222;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #444;
  }
  .config-item label {
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .config-item select {
    background: #111;
    color: #fff;
    border: 1px solid #555;
    padding: 5px;
    border-radius: 4px;
  }
</style>


<script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("✅ DOM cargado, iniciando script...");

  let chargingInterval = null;
  const batteryText = document.getElementById("batteryText");
  const btnCharge = document.getElementById("btnChargeToggle");

  // Cargar datos desde localStorage

  function updateBattery() {
    console.log("🔋 Actualizando batería:", gameData.battery + "%");
    batteryText.textContent = `${gameData.battery}%`;
    if (gameData.battery < 20) {
      batteryText.setAttribute("fill", "red");
    } else if (gameData.battery < 80) {
      batteryText.setAttribute("fill", "yellow");
    } else {
      batteryText.setAttribute("fill", "lime");
    }

    // Guardar en localStorage
    localStorage.setItem("gameData", JSON.stringify(gameData));
  }

  function chargeBattery() {
    if (gameData.battery >= gameData.maxBattery) {
      console.log("⚠️ La batería ya está llena.");
      return;
    }
    if (chargingInterval) {
      console.log("⚠️ Ya se está cargando.");
      return;
    }
    console.log("▶️ Iniciando carga lenta (+2% por segundo)...");
    chargingInterval = setInterval(() => {
      if (gameData.battery < gameData.maxBattery) {
        gameData.battery = Math.min(gameData.maxBattery, gameData.battery + 2);
        console.log("🔼 Batería subió a:", gameData.battery + "%");
        updateBattery();
      } else {
        console.log("✅ Batería llegó al 100%. Deteniendo carga.");
        clearInterval(chargingInterval);
        chargingInterval = null;
      }
    }, 1000);
  }

  if (btnCharge) {
    console.log("✅ Botón de carga encontrado.");
    btnCharge.addEventListener("click", () => {
      console.log("👉 Botón de carga presionado.");
      chargeBattery();
    });
  } else {
    console.log("❌ No encontré el botón de carga (#btnChargeToggle).");
  }

  // Mostrar batería al inicio desde localStorage
  updateBattery();


  // ==============================
  // 💨 CLICK EN EL FOSO (añade humo)
  // ==============================
  const vaperWrap = document.getElementById("vaperWrap");
  const smokeLayer = document.getElementById("smokeLayer");

  function spawnSmoke() {
    if (gameData.battery <= 0) {
      console.log("⚠️ Sin batería, no puedes hacer humo.");
      return;
    }

    console.log("💨 Creando humo...");
    const puff = document.createElement("div");
    puff.className = "smoke";
    puff.style.left = `${50 + (Math.random() * 20 - 10)}%`;
    smokeLayer.appendChild(puff);

    // Gastar 1% batería por cada click
    gameData.battery = Math.max(0, gameData.battery - 1);
    updateBattery();

    setTimeout(() => {
      console.log("💨 Humo eliminado.");
      puff.remove();
    }, 2500);
  }

  if (vaperWrap) {
    console.log("✅ Zona del foso encontrada.");
    vaperWrap.addEventListener("click", () => {
      console.log("👉 Click en el foso.");
      spawnSmoke();
    });
  } else {
    console.log("❌ No encontré el foso (#vaperWrap).");
  }
});
</script>


<script>
window.onload = () => {
  const btnShop = document.getElementById("btnShop");
  console.log("¿Encontró el botón?", btnShop);

  if (btnShop) {
    btnShop.addEventListener("click", () => {
      console.log("🟡 Hiciste clic en el botón Tienda!");
    });
  }
};
</script>
<script>
/* Lógica JS mínima para la maqueta:
   - 15 fosos con costes y sigmacoin-per-click
   - central clickable (anywhere inside SVG)
   - shop: click miniatura buys/equips foso (if enough ΣC)
   - battery: each click consumes battery; buy battery restores
   - overheating (>7 cps) burns the active foso (requires buying another)
   - Mata Foso: +50 ΣC, cooldown 1800s (30 min)
   - Save/load to localStorage
*/

// Configuración inicial (puedes ajustar)

let isCharging = false;

const FOSOS = [
 {id:1,  name:'Foso 1',  cost:0,                    perClick:1},
 {id:2,  name:'Foso 2',  cost:100,                  perClick:2},
 {id:3,  name:'Foso 3',  cost:10_000,               perClick:10},
 {id:4,  name:'Foso 4',  cost:100_000,              perClick:100},
 {id:5,  name:'Foso 5',  cost:1_000_000,            perClick:1_000},
 {id:6,  name:'Foso 6',  cost:10_000_000,           perClick:10_000},
 {id:7,  name:'Foso 7',  cost:100_000_000,          perClick:100_000},
 {id:8,  name:'Foso 8',  cost:1_000_000_000,        perClick:1_000_000},
 {id:9,  name:'Foso 9',  cost:10_000_000_000,       perClick:10_000_000},
 {id:10, name:'Foso 10', cost:100_000_000_000,      perClick:100_000_000},
 {id:11, name:'Foso 11', cost:1_000_000_000_000,    perClick:1_000_000_000},
 {id:12, name:'Foso 12', cost:10_000_000_000_000,   perClick:10_000_000_000},
 {id:13, name:'Foso 13', cost:100_000_000_000_000,  perClick:100_000_000_000},
 {id:14, name:'Foso 14', cost:1_000_000_000_000_000, perClick:1_000_000_000_000},
 {id:15, name:'Foso 15', cost:10_000_000_000_000_000, perClick:10_000_000_000_000}
];


function updateBatteryText(value) {
  const batteryText = document.getElementById("batteryText");
  const clamped = Math.max(0, Math.min(100, value));
  batteryText.textContent = clamped + "%";
}


const shopGrid = document.getElementById('shopGrid');
// --- Habilitar compra de fosos desde la tienda ---
shopGrid.querySelectorAll(".shopCard[data-index]").forEach(card => {
  card.addEventListener("click", () => {
    const idx = parseInt(card.dataset.index);
    const foso = FOSOS[idx];

    if (!foso) return;

    if (state.sig >= foso.cost) {
      state.sig -= foso.cost;               // Resta monedas
      state.activeFosoIndex = idx;          // Activa el foso comprado
      state.battery = Math.min(
        state.battery + CONFIG.onEquipRefill,
        state.maxBattery
      ); // recarga un poco al equipar
      saveState();
      render();
      showToast(`✅ Compraste y equipaste ${foso.name}`, "info");
    } else {
      showToast("❌ No tienes suficientes ΣC", "info");
    }
  });
});


let autoClickTimer = null;



// Estado
let state = {
  sig: 0,
  totalClicks: 0,
  activeFosoIndex: 0, // index in FOSOS array, default 0
  battery: 100, // percent
  maxBattery: 100, // can be increased with upgrades
  burned: false,
  powerOn: true,
  mataCooldownUntil: 0, // timestamp
  autoClickerLevel: 0,
  smokerOn: false,
  autoClickExpiresAt: 0, // timestamp when autoclick boost ends
  smokerExpiresAt: 0,
  dailyDay: 0,   
    rebirths: 0,       // cuántos rebirths ha hecho
  rebirthBonus: 1,      // progreso en la lista de recompensas
lastDailyClaim: null,  
// --- Sistema de batería ---
 // capacidad máxima


afkLevel: 0,
afkLastClaim: Date.now(),
// fecha del último reclamo (timestamp)


  // caladas acumuladas desde última recarga
  // Nuevos campos
  lang: 'es',
  powersOwned: {}, // id -> true
  overheatBonus: 0, // +cps al umbral
  batteryEfficiencyLevel: 0, // each level reduces drain by 10%
  rechargeSpeedLevel: 0, // each level increases recharge rate by 10%
  perClickMult: 1,
  passivePerSec: 0,

  // 🔧 añadidos para que no salga undefined:
  upgradeLevels: {
    battery_plus50: 0,
    autoclick_1: 0,
    extra_click: 0
  },
  extraClicks: 0
  
};
if (typeof state.battery !== "number") state.battery = 0;
if (typeof state.batteryMax !== "number") state.batteryMax = 100;



// DOM refs
const sigTotalEl = document.getElementById('sigTotal');
const perClickEl = document.getElementById('perClick');
const totalClicksEl = document.getElementById('totalClicks');
const batteryFill = document.getElementById('batteryFill');
const batteryLabel = document.getElementById('batteryLabel');
const shopSigma = document.getElementById('shopSigma');
const btnMata = document.getElementById('btnMata');
const mataLabel = document.getElementById('mataLabel');

const centralFoso = document.getElementById('centralFoso');
const vaperWrap = document.getElementById('vaperWrap');

const CONFIG = {
  storageKey: 'foso_tycoon_state_v1',
  autosaveMs: 10000,
  uiTickMs: 1000,
  // Battery drains slower with better fosos (multiplier applied)
  baseBatteryDrainPerClick: 1,
  // Base overheat threshold (poderes pueden aumentarlo)
  overheatCps: 15,
  mataReward: 50,
  // 5 minutes cooldown
  mataCooldownSec: 300,
  // timed recharge (no cost): seconds to fully recharge baseline
  rechargeBaseSec: 120,
  // boost on click: extra recharge during continuous clicking
  clickRechargeBoost: 0.9, // 90% of base per-click as extra timed recharge
  onEquipRefill: 20 // +20% batería al equipar/comprar un foso
};
const STORAGE_KEY = CONFIG.storageKey;

// Botón de "Borrar Progreso 💣" dentro del modal Configuración
// Botón de "Borrar Progreso 💣" dentro del modal Configuración
// Abrir modal de configuración
document.getElementById('btnConfig')?.addEventListener('click', ()=>{
  document.getElementById('configModal').classList.remove('hidden');
});

// Cerrar modal de configuración
document.querySelectorAll('#configModal .close-btn').forEach(btn=>{
  btn.addEventListener('click', ()=> document.getElementById('configModal').classList.add('hidden'));
});

// Botón de "Borrar Progreso 💣"
document.getElementById('btnReset')?.addEventListener('click', ()=>{
  if(confirm('⚠️ Esto borrará absolutamente TODO el progreso guardado en este juego.')){
    localStorage.clear();         // 🔥 borra todas las claves del localStorage
    state = {};                   // resetea también la variable en memoria
    location.reload(true);        // recarga la página desde cero
  }
});
     // recarga la página limpia
     // Botón de Tienda
const btnShop = document.getElementById('btnShop');
const shopModal = document.getElementById('shopModal');


// Abrir tienda
btnShop?.addEventListener('click', () => {
  shopModal.classList.remove('hidden');
});

// --- Rebirth ---
const btnRebirth = document.getElementById("btnRebirth");

btnRebirth?.addEventListener("click", () => {
  if (state.sig < 1_000) { // coste mínimo para renacer
    showToast("❌ Necesitas al menos 1,000 ΣC para hacer Rebirth.", "info");
    return;
  }

  if (!confirm("⚠️ El Rebirth reiniciará tu progreso, pero ganarás un bonus permanente. ¿Seguro?")) {
    return;
  }

  // Aumentar contador y bonus
  state.rebirths = (state.rebirths || 0) + 1;
  state.rebirthBonus = (state.rebirthBonus || 1) + 0.5;

  // Reiniciar progreso principal
  state.sig = 0;
  state.totalClicks = 0;
  state.activeFosoIndex = 0;

  state.maxBattery = 100;

  saveState();
  render();

  showToast(`✅ Hiciste Rebirth #${state.rebirths}! Nuevo bonus permanente: x${state.rebirthBonus}`, "info");
});


// Cerrar tienda (los botones con la clase .close-btn dentro del modal)
shopModal.querySelectorAll('.close-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    shopModal.classList.add('hidden');
  });
});





// load/save
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);
    Object.assign(state, s);
  }catch(e){ console.warn('load state err', e); }
}
function saveState(){
  state.lastPlayed = Date.now();   // 👈 guarda hora de salida
  localStorage.setItem("gameState", JSON.stringify(state));

  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){}
}
setInterval(saveState, CONFIG.autosaveMs);
loadState();

// helper
function formatNum(n){
  if(n>=1e9) return (n/1e9).toFixed(2)+'B';
  if(n>=1e6) return (n/1e6).toFixed(2)+'M';
  if(n>=1e3) return (n/1e3).toFixed(2)+'K';
  return Math.floor(n).toString();
}

// UI update
function syncCentralAppearance(activeIndex){
  const activeCard = shopGrid.querySelector(`.shopCard[data-index="${activeIndex}"]`);
  if(!activeCard) return;
  const cardSvg = activeCard.querySelector('svg');
  const cardDefs = cardSvg ? cardSvg.querySelector('defs') : null;
  const centralDefs = centralFoso.querySelector('defs');
  if(!cardDefs || !centralDefs) return;

  // Find gradient nodes in card defs
  const gradBody = cardDefs.querySelector('linearGradient[id^="g"]');
  const gradMouth = cardDefs.querySelector('linearGradient[id^="mouth"]');

  // Remove previous active gradients
  centralDefs.querySelectorAll('#gActive, #mouthActive').forEach(n=>n.remove());

  // Clone and rename gradients
  if(gradBody){
    const cloneBody = gradBody.cloneNode(true);
    cloneBody.setAttribute('id','gActive');
    centralDefs.appendChild(cloneBody);
  }
  if(gradMouth){
    const cloneMouth = gradMouth.cloneNode(true);
    cloneMouth.setAttribute('id','mouthActive');
    centralDefs.appendChild(cloneMouth);
  }

  // Apply fills to central rects (body and mouth)
  const rects = centralFoso.querySelectorAll('rect');
  const bodyRect = rects[0];
  const mouthRect = rects[1];
  if(bodyRect) bodyRect.setAttribute('fill','url(#gActive)');
 


}

function render(){
  sigTotalEl.textContent = formatNum(state.sig);
  shopSigma.textContent = formatNum(state.sig);
  totalClicksEl.textContent = state.totalClicks;
  const basePer = FOSOS[state.activeFosoIndex].perClick;
  const per = basePer * state.perClickMult * (state.rebirthBonus || 1);

  perClickEl.textContent = formatNum(per);
const batteryText = document.getElementById("batteryText");
if (batteryText) {
  const maxB = state.maxBattery || 100;
  const percent = Math.floor((state.battery / maxB) * 100);

  batteryText.textContent = percent + "%";
  batteryText.setAttribute("fill", percent > 20 ? "#0f0" : "#f00");
}


  // Mata cooldown
  const now = Date.now();
  if(state.mataCooldownUntil && state.mataCooldownUntil > now){
    btnMata.disabled = true;
    const sec = Math.ceil((state.mataCooldownUntil - now)/1000);
    const mm = String(Math.floor(sec/60)).padStart(2,'0'), ss = String(sec%60).padStart(2,'0');
    mataLabel.textContent = `Cooldown ${mm}:${ss}`;
  } else {
    btnMata.disabled = false;
    mataLabel.textContent = 'Mata Foso';
  }

  // Sync central SVG appearance with active foso
  syncCentralAppearance(state.activeFosoIndex);

  // burned visual: tint the central screen red when burned
  const centralScreen = document.getElementById('centralScreen');
  if(state.burned){
    centralScreen.setAttribute('fill','#6b0000');
  } else {
    centralScreen.setAttribute('fill','#000');
  }

}
render();

// clicks per second detection (overheat)
let clickTimestamps = [];
function registerClick(){
  const now = Date.now();
  clickTimestamps.push(now);
  // keep last 1000ms
  clickTimestamps = clickTimestamps.filter(t => now - t <= 1000);
  return clickTimestamps.length;
}







btnChargeToggle?.addEventListener('click', ()=>{
  if(state.burned){ showToast('El foso está quemado. Equipa/compra otro.', "info"); return; }
  chargeBattery(!isCharging);
});

function showBurnSmoke(){
  // Inserta el SVG de humo/quemado dentro del wrapper, dispara animaciones
  const wrap = document.getElementById('vaperWrap');
  if(!wrap) return;
  const existing = document.getElementById('burnSmokeSvg');
  if(existing) existing.remove();
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('id','burnSmokeSvg');
  svg.setAttribute('xmlns','http://www.w3.org/2000/svg');
  svg.setAttribute('width','200');
  svg.setAttribute('height','200');
  svg.setAttribute('viewBox','0 0 200 200');
  svg.innerHTML = `
    <defs>
      <filter id="blurSmoke" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="6"/>
      </filter>
    </defs>
    <g filter="url(#blurSmoke)">
      <ellipse cx="100" cy="150" rx="12" ry="8" fill="lightgray" opacity="0.6">
        <animate attributeName="cy" from="150" to="50" dur="2.5s" begin="0s"/>
        <animate attributeName="rx" from="12" to="40" dur="2.5s" begin="0s"/>
        <animate attributeName="opacity" from="0.6" to="0" dur="2.5s" begin="0s"/>
      </ellipse>
      <ellipse cx="90" cy="150" rx="10" ry="7" fill="lightgray" opacity="0.5">
        <animate attributeName="cy" from="150" to="60" dur="3s" begin="0s"/>
        <animate attributeName="rx" from="10" to="35" dur="3s" begin="0s"/>
        <animate attributeName="opacity" from="0.5" to="0" dur="3s" begin="0s"/>
      </ellipse>
      <ellipse cx="110" cy="150" rx="9" ry="6" fill="lightgray" opacity="0.4">
        <animate attributeName="cy" from="150" to="70" dur="3.2s" begin="0s"/>
        <animate attributeName="rx" from="9" to="30" dur="3.2s" begin="0s"/>
        <animate attributeName="opacity" from="0.4" to="0" dur="3.2s" begin="0s"/>
      </ellipse>
    </g>`;
  // posicionar en la parte superior del dispositivo
  svg.style.position='absolute';
  svg.style.left='50%';
  svg.style.top='10%';
  svg.style.transform='translate(-50%, -0%)';
  svg.style.pointerEvents='none';
  wrap.appendChild(svg);
  setTimeout(()=> svg.remove(), 3500);
}

// central click handler
function handleCentralClick(){
  if(isCharging){ 
    showToast('No puedes vapear mientras se está cargando.', "info"); 
    return; 
  }
  if(!state.powerOn) return; // apagado: no responde
  if(state.burned){ showToast('El foso está quemado. Compra/selecciona otro.', "info"); return; }
  if(state.battery <= 0){ showToast('Batería agotada.', "info"); return; }
  // Solo quemar por CPS si el clic es manual; el autoclicker no cuenta para sobrecalentamiento
  const cps = registerClick();
  const overheatLimit = CONFIG.overheatCps + (state.overheatBonus||0);
  if(!state._autoClickInProgress && cps > overheatLimit){
    state.burned = true; state.battery = 0; showToast('¡Has quemado el foso!', "info"); render(); saveState(); return;
  }
  const basePer = FOSOS[state.activeFosoIndex].perClick;
  const per = basePer * (state.perClickMult||1);
  state.sig += per; state.totalClicks++;
  const drainEff = Math.max(0.2, 1 - (state.activeFosoIndex*0.05) - (state.batteryEfficiencyLevel*0.1));
  const drain = CONFIG.baseBatteryDrainPerClick * drainEff;
  state.battery = Math.max(0, state.battery - drain);
  try { centralFoso.style.transform = 'scale(0.98)'; setTimeout(()=> centralFoso.style.transform = '', 60);} catch(_){ }
  render(); saveState();
}
// attach clicks to both wrapper and svg para fiabilidad (evitar dobles listeners si se reinserta script)
document.getElementById('btnPower')?.addEventListener('click', ()=>{
  state.powerOn = !state.powerOn;
  const b = document.getElementById('btnPower');
  b.textContent = state.powerOn ? 'Power ON' : 'Power OFF';
  b.style.background = state.powerOn ? '#10b981' : '#9ca3af';
  // ⚡ Nota: ahora al apagar NO se interrumpe la carga
  render(); saveState();
});

try{
 
  document.getElementById('centralFoso')?.addEventListener('click', handleCentralClick, { once:false });
  const cf = document.getElementById('centralFoso');
  cf?.setAttribute('tabindex','0');
  cf?.addEventListener('keydown', (e)=>{
    if(e.code==='Enter' || e.code==='Space'){ e.preventDefault(); handleCentralClick(); }
  });
}catch(_){}

// shop interactions: click shopCard to buy/equip


    // Si no lo tienes comprado → comprar
 // shop interactions: comprar/equipar foso
// ======================= UPGRADES DEFINIDOS =======================
const UPGRADES = {
  battery_plus50: {
    baseCost: 100,
    name: "Batería +50 (perm)",
    maxLevel: 3,
    getCost: (level) => 100 * Math.pow(2, level),  // 👈 añadido
    apply: () => {
      const oldMax = state.maxBattery || 100;
      const oldPercent = state.battery / oldMax;
      state.maxBattery = oldMax + 50;
      state.battery = Math.round(state.maxBattery * oldPercent);
    }
  },

  autoclick_1: {
    baseCost: 500,
    name: "Auto-clicker +1 CPS",
    maxLevel: 3,
    getCost: (level) => 500 * Math.pow(2, level),  // 👈 añadido
    apply: () => {
      state.autoClickerLevel++;
    }
  },

  extra_click: {
    baseCost: 200,
    name: "+1 clic extra",
    maxLevel: 3,
    getCost: (level) => 200 * Math.pow(2, level),  // 👈 añadido
    apply: () => {
      state.extraClicks = (state.extraClicks || 0) + 1;
    }
  }
};
Cost: 100,
    




// ======================= COMPRAR O EQUIPAR FOSO =======================
function buyFoso(idx, card){
  const f = FOSOS[Number(idx)];
  if(!f) return;
  state.fososOwned = state.fososOwned || {};

  if(state.fososOwned[idx]){
    state.activeFosoIndex = Number(idx);
    state.burned = false;
    render(); saveState();
    return;
  }

  if(state.sig < f.cost){
    showToast('No tienes suficientes ΣC para comprar este foso.', "info");
    return;
  }

  state.sig -= f.cost;
  state.activeFosoIndex = Number(idx);
  state.burned = false;
const maxB = state.maxBattery || 100;
state.battery = Math.min(maxB, state.battery + CONFIG.onEquipRefill);


  state.fososOwned[idx] = true;

  if(card){
    card.querySelector(".status")?.remove();
    const status = document.createElement("div");
    status.className = "status";
    status.textContent = "Adquirido";
    status.style.color = "lime";
    card.appendChild(status);
  }

  renderShop(); render(); saveState();
}

const maxB = state.maxBattery || 100;
state.battery = Math.min(maxB, state.battery + CONFIG.onEquipRefill);

// ======================= CLICK EN SHOPGRID =======================

if (shopGrid) {
  shopGrid.addEventListener('click', (e)=>{
    const card = e.target.closest('.shopCard');
    if(!card) return;
    const upg = card.getAttribute('data-upgrade');
    const idx = card.getAttribute('data-index');
    if(upg){ buyUpgrade(upg, card); return; }
    if(idx !== null){ buyFoso(idx, card); return; }
  });
}

// pintar al inicio
renderShop();


// referencia única al grid de la tienda





// Eliminado boost de recarga: botón ya no existe

// Mata Foso: +50 ΣC, cooldown 1800s (30min)
btnMata.addEventListener('click', ()=>{
  const now = Date.now();
  if(state.mataCooldownUntil && state.mataCooldownUntil > now) return;
  state.sig += CONFIG.mataReward;
  state.mataCooldownUntil = now + CONFIG.mataCooldownSec*1000;
  render(); saveState();
});

// Nuevo Foso: compra rápida por 25 ΣC, resetea quemado y rellena batería +20%
document.getElementById('btnNuevoFoso')?.addEventListener('click', ()=>{
  const COST = 25;
  if(state.sig < COST){ showToast('Necesitas 25 ΣC para comprar un nuevo foso.', "info"); return; }
  state.sig -= COST;
  state.burned = false;
  state.battery = Math.min(state.maxBattery || 100, state.battery + 20);

  // opcional: cambiar a un foso base (index 0), o mantener el actual
  // state.activeFosoIndex = 0;
  render(); saveState();
});

// Autoclicker + Smoker + puntero virtual


function updateAutoClickLoop() {
  if (autoClickTimer) clearInterval(autoClickTimer);

  const lvl = state.autoClickerLevel || 0;
  if (lvl > 0) {
    autoClickTimer = setInterval(() => {
      if (isCharging) return; // ⛔ no autoclick mientras carga
      for (let i = 0; i < lvl; i++) {
        doClick(); // 🔥 dispara un click por cada nivel
      }
    }, 1000);
  }
}

function applyOwnedUpgrades() {
  if (!state.upgradesOwned) return;
  for (const key in state.upgradesOwned) {
    const u = UPGRADES[key];
    if (u) {
      const level = state.upgradesOwned[key];

      // 👉 caso especial: autoclick
      if (key === "autoclick_1") {
        state.autoClickerLevel = level;
      } else {
        // para upgrades normales, aplicar N veces
        for (let i = 0; i < level; i++) {
          u.apply();
        }
      }
    }
  }
  // después de todo, si había autoclickers, arrancar el loop
  updateAutoClickLoop();
}

applyOwnedUpgrades();
updateAutoClickLoop();



function spawnPointer(){
  try{
    const wrap = document.getElementById('vaperWrap');
    const pointer = document.createElement('div');
    pointer.style.position='absolute';
    pointer.style.width='18px';
    pointer.style.height='18px';
    pointer.style.borderRadius='50%';
    pointer.style.border='2px solid #fff';
    pointer.style.boxShadow='0 0 8px rgba(255,255,255,0.6)';
    pointer.style.left='50%';
    pointer.style.top='28%';
    pointer.style.transform='translate(-50%,-50%)';
    pointer.style.pointerEvents='none';
    wrap.appendChild(pointer);
    pointer.animate([
      { transform:'translate(-50%,-50%) scale(1)', opacity:1 },
      { transform:'translate(-50%,-50%) scale(0.88)', opacity:0.85 },
      { transform:'translate(-50%,-50%) scale(1)', opacity:0 }
    ], { duration: 300, easing: 'ease-out' }).onfinish=()=> pointer.remove();
  }catch(_){}
}
function updateAutoClickLoop() {
  if (autoClickTimer) clearInterval(autoClickTimer);
  if ((state.autoClickerLevel || 0) > 0) {
    autoClickTimer = setInterval(() => {
      if (isCharging) return;  // ⛔ bloquear autoclick si está cargando
      doClick();
    }, 1000 / (state.autoClickerLevel));
  }
}


// Botones menú inferior
document.getElementById('btnAutoClick')?.addEventListener('click', ()=>{
  // Compra mejora Autoclicker: coste 500 ΣC, duración 10 minutos (nivel +1)
  const COST = 500;
  const DURATION_MIN = 10;
  if(state.sig < COST){ showToast('Necesitas 500 ΣC para mejorar Autocliker.', "info"); return; }
  state.sig -= COST;
  state.autoClickerLevel = Math.min(50, state.autoClickerLevel + 1);
  // extiende/establece expiración
  const now = Date.now();
  const extra = DURATION_MIN*60*1000;
  state.autoClickExpiresAt = Math.max(state.autoClickExpiresAt, now) + extra;
  updateAutoClickLoop();
  // Animación de puntero haciendo click
  try {
    const wrap = document.getElementById('vaperWrap');
    const pointer = document.createElement('div');
    pointer.style.position = 'absolute';
    pointer.style.width = '22px';
    pointer.style.height = '22px';
    pointer.style.borderRadius = '50%';
    pointer.style.border = '2px solid #fff';
    pointer.style.boxShadow = '0 0 8px rgba(255,255,255,0.6)';
    pointer.style.left = '50%';
    pointer.style.top = '28%';
    pointer.style.transform = 'translate(-50%,-50%)';
    pointer.style.pointerEvents = 'none';
    wrap.appendChild(pointer);
    pointer.animate([
      { transform: 'translate(-50%,-50%) scale(1)', opacity: 1 },
      { transform: 'translate(-50%,-50%) scale(0.88)', opacity: 0.85 },
      { transform: 'translate(-50%,-50%) scale(1)', opacity: 0.0 }
    ], { duration: 450, easing: 'ease-out' }).onfinish = ()=> pointer.remove();
  } catch(_){}
  render(); saveState();
});
document.getElementById('btnSmoker')?.addEventListener('click', ()=>{
  // Fumador: compra por 500 ΣC, dura 10 minutos, añade +5 cps mientras dure
  const COST = 500;
  const DURATION_MIN = 10;
  if(state.smokerOn && Date.now() < state.smokerExpiresAt){
    showToast('Fumador ya activo. Espera a que termine para volver a comprar.', "info");
    return;
  }
  if(state.sig < COST){ showToast('Necesitas 500 ΣC para activar Fumador.', "info"); return; }
  state.sig -= COST;
  state.smokerOn = true;
  state.smokerExpiresAt = Date.now() + DURATION_MIN*60*1000;
  updateAutoClickLoop();
  render(); saveState();
});

// Panel de Poderes (50 diferentes)

function applyPowerEffect(effect){
  switch(effect.type){
    case 'perClickMult':
      state.perClickMult = Number((state.perClickMult * effect.value).toFixed(4));
      break;
    case 'overheatBonus':
      state.overheatBonus += effect.value;
      break;
    case 'batteryEfficiency':
      state.batteryEfficiencyLevel += effect.value;
      break;
    case 'rechargeSpeed':
      state.rechargeSpeedLevel += effect.value;
      break;
    case 'passivePerSec':
      state.passivePerSec += effect.value;
      break;
  }
}


const btnPowers = document.getElementById('btnPowers');
if (btnPowers) {
  btnPowers.addEventListener('click', () => {
    const modal = document.getElementById('powersModal');
    if (modal) {
      modal.classList.remove('hidden');
    }
  });
}




// Autosave + UI tick timer + timed recharge + central battery bar fill
setInterval(()=>{
  // expirar boosts por tiempo
  const now = Date.now();
  if(state.autoClickExpiresAt && now >= state.autoClickExpiresAt){
    state.autoClickExpiresAt = 0;
    state.autoClickerLevel = 0;
    updateAutoClickLoop();
  }
  if(state.smokerOn && state.smokerExpiresAt && now >= state.smokerExpiresAt){
    state.smokerOn = false;
    state.smokerExpiresAt = 0;
    updateAutoClickLoop();
  }

  // Ingreso pasivo por poderes
  if(state.passivePerSec>0 && !state.burned){
    state.sig += state.passivePerSec * (CONFIG.uiTickMs/1000);
  }

  // Recarga pasiva por tiempo y carga manual activa acelera x2 (solo si Power ON)
let rechargeRatePerSec = 0;

// ahora ya no depende de powerOn, solo de que no esté quemado
if(isCharging && !state.burned){
  rechargeRatePerSec = (100/CONFIG.rechargeBaseSec) * (1 + (state.rechargeSpeedLevel||0)*0.1) * 2;
}

state.battery = Math.min(100, state.battery + rechargeRatePerSec*(CONFIG.uiTickMs/1000));

render();
saveState();
}, CONFIG.uiTickMs);

// iniciar loop de autoclick si aplica
updateAutoClickLoop();

// initial render done
render();

document.getElementById('btnSigmaHack')?.addEventListener('click', () => {
  const confirmHack = confirm('¿Estás seguro que quieres recibir sigma infinito?');
  if (!confirmHack) return;

  state.sig += 9999999999999999999999999;
  render();
  saveState();
  showToast('¡SigmaCoins agregados con éxito!', "info");
});
 // =========================
// Definición de los 50 poderes
// =========================
const POWERS = [
  {id:1, name:"AutoClicker 🤖", cost:2000, effect:{type:"autoClick", value:1, desc:"+1 clic automático/seg (permanente)"}},
  {id:2, name:"TurboClick ⚡", cost:5000, effect:{type:"perClickMult", value:1.5, desc:"+50% ΣC por clic (permanente)"}},
  {id:3, name:"Batería Eficiente 🔋", cost:8000, effect:{type:"batteryEfficiency", value:1, desc:"-25% consumo de batería (permanente)"}},
  {id:4, name:"Recarga Rápida 🔌", cost:12000, effect:{type:"rechargeSpeed", value:1, desc:"Recarga ×2 más rápida (permanente)"}},
  {id:5, name:"Sigma Boost 💰", cost:20000, effect:{type:"perClickMult", value:2, desc:"Duplica ΣC por clic (permanente)"}},
  {id:6, name:"Humo Mágico ☁️", cost:30000, effect:{type:"passivePerSec", value:5, desc:"+5 ΣC/seg pasivo (permanente)"}},
  {id:7, name:"Overheat Control ❄️", cost:50000, effect:{type:"overheatBonus", value:10, desc:"+10 cps antes de quemar (permanente)"}},
  {id:8, name:"Sigma Multiplicador ✨", cost:80000, effect:{type:"multiplier", value:2, desc:"Multiplica ×2 todo (permanente)"}},
  {id:10, name:"Ultra AutoClicker 🚀", cost:200000, effect:{type:"autoClick", value:10, desc:"+10 clics automáticos/seg (permanente)"}}
];

function applyPowerEffect(effect){
  switch(effect.type){
    case "autoClick":
      state.autoClickerLevel += effect.value;
      updateAutoClickLoop();
      break;
    case "perClickMult":
      state.perClickMult *= effect.value;
      break;
    case "batteryEfficiency":
      state.batteryEfficiencyLevel += effect.value;
      break;
    case "rechargeSpeed":
      state.rechargeSpeedLevel += effect.value;
      break;
    case "passivePerSec":
      state.passivePerSec += effect.value;
      break;
    case "overheatBonus":
      state.overheatBonus += effect.value;
      break;
    case "multiplier":
      state.perClickMult *= effect.value;
      break;
    case "repair":
      state.burned = false;
      state.battery = 50; // lo repara y da 50% batería
      break;
  }
  render(); saveState();
}


function renderPowers(){
  const grid = document.getElementById("powersGrid");
  grid.innerHTML = "";

  POWERS.forEach(p => {
    const card = document.createElement("div");
    card.className = "power-card";

    const title = document.createElement("div");
    title.style.fontWeight = "bold";
    title.textContent = p.name;
    card.appendChild(title);

    const desc = document.createElement("div");
    desc.className = "metaTiny";
    desc.textContent = p.effect.desc;
    card.appendChild(desc);

    const btn = document.createElement("button");
    
    if(p.id === 9){ 
      // Reparar foso siempre se puede comprar
      btn.textContent = `${p.cost} ΣC — Usar`;
      btn.disabled = state.sigma < p.cost;
      btn.onclick = () => {
        if(state.sigma >= p.cost){
          state.sigma -= p.cost;
          applyPowerEffect(p.effect);
        }
      };
    } else {
      // Otros poderes solo una vez
      if(state.powersUnlocked?.includes(p.id)){
        btn.textContent = "Comprado ✅";
        btn.disabled = true;
      } else {
        btn.textContent = `${p.cost} ΣC — Comprar`;
        btn.disabled = state.sigma < p.cost;
        btn.onclick = () => {
          if(state.sigma >= p.cost){
            state.sigma -= p.cost;
            if(!state.powersUnlocked) state.powersUnlocked = [];
            state.powersUnlocked.push(p.id);
            applyPowerEffect(p.effect);
          }
        };
      }
    }

    card.appendChild(btn);
    grid.appendChild(card);
  });
}






// =========================
// Abrir / cerrar modal
// =========================
const powersModal = document.getElementById('powersModal');
const powersGrid = document.getElementById('powersGrid');
const closeBtn = powersModal.querySelector('.close-btn');

document.getElementById('btnPowers').addEventListener('click', ()=>{
  powersModal.classList.remove('hidden');
  renderPowers();
});

closeBtn.addEventListener('click', ()=> powersModal.classList.add('hidden'));
window.addEventListener('click', e=>{
  if(e.target === powersModal) powersModal.classList.add('hidden');
});

// =========================
// Renderizado de cartas
// =========================
function renderPowers(){
  powersGrid.innerHTML = '';
  POWERS.forEach(p=>{
    const owned = !!state.powersOwned[p.id];
    const card = document.createElement('div');
    card.className = 'power-card';
    card.innerHTML = `
      <h3>${p.name}</h3>
      <p>${p.effect.desc}</p>
      <p>Coste: ${p.cost} ΣC</p>
      <button ${owned?'disabled':''}>
        ${owned?'Comprado':'Comprar'}
      </button>
    `;

    const btn = card.querySelector('button');
    btn.addEventListener('click', ()=>{
      if(owned) return;
      if(state.sig < p.cost){
        showToast('No tienes ΣC suficientes.', "info");
        return;
      }
      state.sig -= p.cost;
      state.powersOwned[p.id] = true;
      applyPowerEffect(p.effect);
      renderPowers();
      render();
      saveState();
    });

    powersGrid.appendChild(card);
  });
}

function renderShop(){
  shopGrid.querySelectorAll('.shopCard').forEach(card=>{
    const idx = Number(card.getAttribute('data-index'));
    const owned = state.fososOwned && state.fososOwned[idx];
    let badge = card.querySelector('.owned-tag');
    if(owned){
      if(!badge){
        badge = document.createElement('div');
        badge.className = 'owned-tag';
        badge.textContent = '✅ Adquirido';
        badge.style.marginTop = '4px';
        badge.style.fontSize = '12px';
        badge.style.color = '#0f0';
        card.appendChild(badge);
      }
    } else {
      if(badge) badge.remove();
    }
  });
}




  // Si quieres mostrar percent de bateria en la pantalla, podrías:
  // const battTextEl = document.getElementById('dropPercent'); if(battTextEl) battTextEl.textContent = Math.round(state.battery) + '%';


document.querySelectorAll(".shopCard").forEach((card, idx) => {
  if (state.fososOwned && state.fososOwned[idx]) {
    const status = document.createElement("div");
    status.className = "status";
    status.textContent = "Adquirido";
    status.style.color = "lime";
    card.appendChild(status);
  }
});

// Abrir modal Configuración
document.getElementById("btnConfig")?.addEventListener("click", ()=>{
  document.getElementById("configModal").classList.remove("hidden");
});

// Cerrar modal
document.querySelector("#configModal .close-btn")?.addEventListener("click", ()=>{
  document.getElementById("configModal").classList.add("hidden");
});

// Animaciones
document.getElementById("chkAnimations")?.addEventListener("change", (e)=>{
  state.animationsOn = e.target.checked;
  saveState();
});

// Tema
document.getElementById("themeSelect")?.addEventListener("change", (e)=>{
  state.theme = e.target.value;
  document.body.setAttribute("data-theme", state.theme);
  saveState();
});

// Reset
document.getElementById("btnReset")?.addEventListener("click", ()=>{
  if(confirm("¿Seguro que quieres borrar tu progreso?")){
    localStorage.clear();
    location.reload();
  }
});

function spawnSmoke(){
  const layer = document.getElementById('smokeLayer');
  if(!layer) return;
  const puff = document.createElement('div');
  puff.className = 'smoke';
  layer.appendChild(puff);
  setTimeout(()=> puff.remove(), 2500); // se borra al terminar animación
}

// Añadir humo cuando se hace clic en el foso
const foso = document.getElementById('centralFoso');
foso?.addEventListener('click', ()=> spawnSmoke());


// Botón hack de Sigma infinito
document.getElementById('btnSigmaHack')?.addEventListener('click', ()=>{
  state.sig = Number.MAX_SAFE_INTEGER; // o pon un número altísimo
  render();
  saveState();
  showToast("💰 Hack activado: Sigma infinito!", "info");
});

// --- TIENDA MODAL ---

// Abrir Tienda


if (btnShop) {
  btnShop.addEventListener("click", ()=>{
    document.getElementById("shopModal").classList.remove("hidden");
  });
}

btnChargeToggle?.addEventListener('click', ()=>{
  if(state.burned){ showToast('El foso está quemado. Equipa/compra otro.', "info"); return; }
  chargeBattery(!isCharging);
});


function buyUpgrade(upgradeKey) {
  const upgrade = UPGRADES[upgradeKey];
  if (!upgrade) {
    console.error("❌ Upgrade no encontrado:", upgradeKey);
    return;
  }

  const level = state.upgradeLevels?.[upgradeKey] || 0;
  console.log(`Intentando comprar ${upgradeKey}, nivel actual: ${level}`);

  if (level >= upgrade.maxLevel) {
    console.log("Ya está en nivel máximo");
    return;
  }

  const cost = upgrade.getCost(level);
  console.log(`Costo calculado: ${cost}, SIG actual: ${state.sig}`);

  if (state.sig < cost) {
    console.log("No hay suficiente SIG");
    return;
  }

  // compra
  state.sig -= cost;
  upgrade.apply();
  state.upgradeLevels[upgradeKey] = level + 1;

  console.log(`✔️ Compra hecha, nuevo nivel: ${state.upgradeLevels[upgradeKey]}`);
  renderUpgradeShop();
  render();
  saveState();
}



function applyOwnedUpgrades() {
  if (!state.upgradesOwned) return;
  for (const key in state.upgradesOwned) {
    const u = UPGRADES[key];
    if (u) {
      const level = state.upgradesOwned[key];

      if (key === "autoclick_1") {
        // 🚀 Asignar directamente el nivel sin sumar
        state.autoClickerLevel = level;
      } else {
        // aplicar upgrades normales tantas veces como nivel
        for (let i = 0; i < level; i++) {
          u.apply();
        }
      }
    }
  }
  // arrancar autoclick después de restaurar el nivel
  updateAutoClickLoop();
}


loadState();
applyOwnedUpgrades();

// ------------------ Recompensa AFK (límite 10.000 ΣC) ------------------






function renderShop() {
  const shopGrid = document.getElementById("shopGrid");
  shopGrid.querySelectorAll(".shopCard").forEach(card => {
    const upgradeKey = card.getAttribute("data-upgrade");
    if (!upgradeKey) return;

    const u = UPGRADES[upgradeKey];
    if (!u) return;

    const currentLevel = state.upgradeLevels?.[upgradeKey] || 0;
    const priceEl = card.querySelector(".priceTag");

    if (!priceEl) return;

    if (currentLevel >= (u.maxLevel || 1)) {
      priceEl.textContent = `✔️ Máx (${u.maxLevel})`;
      card.style.opacity = "0.7";
    } else {
      const cost = u.getCost(currentLevel); // ✅ usar getCost(level)
      priceEl.textContent = `${cost} ΣC (Lv ${currentLevel}/${u.maxLevel})`;
      card.style.opacity = "1";
    }
  });
}


const speedMultiplier = 1 + ((state.rechargeSpeedLevel || 0) * 0.1);

function doClick() {
  if (isCharging) return;   // no clikear si está cargando
  if (state.burned) return; // no clikear si el foso está quemado

  state.sig += (1 * (state.perClickMult || 1));
  state.totalClicks++;
  render();
  saveState();
}



// ---------------------- AutoClicker ----------------------

function updateAutoClickLoop() {
  if (autoClickTimer) clearInterval(autoClickTimer);

  const lvl = state.autoClickerLevel || 0;
  if (lvl > 0) {
    autoClickTimer = setInterval(() => {
      if (isCharging || state.burned) return; // no autoclick mientras carga o quemado
      for (let i = 0; i < lvl; i++) {
        doClick(); // dispara clicks automáticos
      }
    }, 1000); // cada segundo
  }
}

applyOwnedUpgrades();
updateAutoClickLoop(); // activa autoclick si ya estaba comprado

// 🟢 DEBUG AUTCLICKER
setInterval(() => {
  console.log("DEBUG >>",
    "nivel:", state.autoClickerLevel,
    "sig:", state.sig,
    "battery:", Math.round(state.battery) + "/" + state.maxBattery,
    "isCharging:", isCharging,
    "burned:", state.burned,
    "autoClickTimer activo:", !!autoClickTimer
  );
}, 3000);

console.log("🟢 Script cargado correctamente");

function pointerClickEffect() {
  const pointer = document.getElementById("autoClickPointer");
  const foso = document.getElementById("centralFoso");
  if (!pointer || !foso) return;

  const rect = foso.getBoundingClientRect();
  pointer.style.left = rect.left + rect.width / 2 - 12 + "px"; // centrado
  pointer.style.top = rect.top + rect.height / 2 - 12 + "px";

  pointer.classList.add("active");
  setTimeout(() => pointer.classList.remove("active"), 150);
}

function renderUpgradeShop() {
  Object.keys(UPGRADES).forEach(key => {
    const upgrade = UPGRADES[key];
    const level = state.upgradeLevels?.[key] || 0;
    const priceEl = document.querySelector(`.shopCard[data-upgrade="${key}"] .priceTag`);
    if (!priceEl) return;

    if (level >= upgrade.maxLevel) {
      priceEl.textContent = "MAX";
    } else {
      // 👇 AQUÍ EL CAMBIO IMPORTANTE
      const cost = upgrade.getCost(level);  
      console.log("Render:", key, "nivel", level, "coste:", cost); // para verificar
      priceEl.textContent = `${cost} ΣC (Lv ${level}/${upgrade.maxLevel})`;
    }
  });
}


// --- DEBUG DAILY REWARDS ---





// --- EVENTOS ---







renderUpgradeShop();


// Botón que abre el modal
document.getElementById("btnDaily").addEventListener("click", openDailyModal);

// Botón dentro del modal para reclamar






// Cerrar modal


 
<!-- PEGAR: Bloque de reparación/depuración de Recompensas Diarias -->

(function(){
  document.addEventListener('DOMContentLoaded', () => {
    console.log("DEBUG daily-fix: iniciando (pegar este script al final del HTML)");

    const dailyModal = document.getElementById('dailyModal');
    let btnDaily = document.getElementById('btnDaily');
    let btnClaimDaily = document.getElementById('btnClaimDaily');
    let closeDaily = document.getElementById('closeDaily');

    console.log("DEBUG elementos encontrados:", { btnDaily, btnClaimDaily, closeDaily, dailyModal });

    // Reemplaza nodos por clones para eliminar listeners previos
    function replaceNode(node){
      if(!node || !node.parentNode) return node;
      const clone = node.cloneNode(true);
      node.parentNode.replaceChild(clone, node);
      return clone;
    }
    if(btnDaily) btnDaily = replaceNode(btnDaily);
    if(btnClaimDaily) btnClaimDaily = replaceNode(btnClaimDaily);
    if(closeDaily) closeDaily = replaceNode(closeDaily);

    // DEFINIR openDailyModal (estable y con debug)
    window.openDailyModal = function(){
      console.log("DEBUG openDailyModal (nuevo) ejecutado");
      if(!dailyModal){
        console.warn("dailyModal no encontrado");
        return;
      }
      // rellenar carousel si existe
      const carousel = document.getElementById('carousel');
      if(carousel && Array.isArray(window.DAILY_REWARDS)){
        carousel.innerHTML = '';
        window.DAILY_REWARDS.forEach((r, idx) => {
          const card = document.createElement('div');
          card.style.minWidth = "120px";
          card.style.padding = "10px";
          card.style.borderRadius = "8px";
          card.style.background = (idx === (state.dailyDay || 0)) ? "#0f0" : "#333";
          card.style.color = "#fff";
          card.innerHTML = `
            <div style="font-size:32px">${r.icon || ''}</div>
            <div>Día ${idx + 1}</div>
            <div style="font-size:14px">${r.label || ''}</div>
          `;
          carousel.appendChild(card);
        });
      }
      dailyModal.classList.remove('hidden');
    };

    // DEFINIR claimDailyReward (estable y con debug)
    window.claimDailyReward = function(){
      console.log("DEBUG claimDailyReward (nuevo) ejecutado");
      try {
        const today = new Date().toDateString();
        if(state.lastDailyClaim === today){
          console.log("DEBUG: ya reclamado hoy");
          showToast("Ya reclamaste la recompensa de hoy.", "info");
          return;
        }

        if(!Array.isArray(window.DAILY_REWARDS) || window.DAILY_REWARDS.length === 0){
          console.error("DEBUG: DAILY_REWARDS no definido o vacío");
          showToast("No hay recompensas definidas. Mira la consola.", "info");
          return;
        }

        const reward = window.DAILY_REWARDS[state.dailyDay] || window.DAILY_REWARDS[window.DAILY_REWARDS.length - 1];
        console.log("DEBUG: recompensa seleccionada:", reward);

        switch(reward.type){
          case "coins":
            state.sig = (state.sig || 0) + (reward.amount || 0);
            console.log(`DEBUG: +${reward.amount} ΣC`);
            break;
          case "power":
            // compatibilidad con estructuras previas
            const mult = (reward.effect && reward.effect === "x2") ? 2 : 1;
            state.perClickMult = (state.perClickMult || 1) * mult;
            if(reward.duration) setTimeout(()=> { state.perClickMult = (state.perClickMult || 1) / mult; }, (reward.duration || 60) * 1000);
            console.log("DEBUG: power aplicado", reward);
            break;
          case "foso":
            if(reward.foso) {
              FOSOS.push(reward.foso);
              console.log("DEBUG: foso añadido:", reward.foso);
            }
            break;
          default:
            console.warn("DEBUG: tipo de recompensa desconocido", reward);
        }

        state.lastDailyClaim = today;
        state.dailyDay = (state.dailyDay || 0) + 1;

        if(typeof saveState === 'function') try { saveState(); } catch(e){ console.warn('saveState err', e); }
        if(typeof render === 'function') try { render(); } catch(e){ console.warn('render err', e); }
        if(typeof renderShop === 'function') try { renderShop(); } catch(e){ console.warn('renderShop err', e); }

        if(dailyModal) dailyModal.classList.add('hidden');
        console.log("DEBUG: claim complete — sig:", state.sig, "dailyDay:", state.dailyDay);
        showToast(`Has ganado: ${reward.label || 'recompensa'}`, "info");
      } catch(err){
        console.error("DEBUG claimDailyReward error:", err);
        showToast("Error al reclamar. Mira la consola para detalles.", "info");
      }
    };

    // Adjuntar listeners nuevos (solo uno)
    if(btnDaily){
      btnDaily.addEventListener('click', () => {
        console.log("EVENT: click en btnDaily");
        window.openDailyModal();
      });
    } else console.warn("btnDaily no existe en DOM (no se añadió listener)");

    if(btnClaimDaily){
      btnClaimDaily.addEventListener('click', () => {
        console.log("EVENT: click en btnClaimDaily");
        window.claimDailyReward();
      });
    } else console.warn("btnClaimDaily no existe en DOM (no se añadió listener)");

    if(closeDaily){
      closeDaily.addEventListener('click', () => {
        console.log("EVENT: click en closeDaily");
        if(dailyModal) dailyModal.classList.add('hidden');
      });
    } else console.warn("closeDaily no existe en DOM (no se añadió listener)");

    console.log("DEBUG daily-fix: listeners nuevos instalados");
  });
})();

// --- Rebirth ---
document.getElementById("btnRebirth")?.addEventListener("click", () => {
  if (state.sig < 1_000_000) { // coste mínimo
    showToast("❌ Necesitas al menos 1,000,000 ΣC para hacer Rebirth.", "info");
    return;
  }

  if (!confirm("⚠️ El Rebirth reiniciará tu progreso, pero ganarás un bonus permanente. ¿Seguro?")) {
    return;
  }

  // Aumentar contador de rebirths y bonus permanente
  state.rebirths += 1;
  state.rebirthBonus += 0.5; // +50% ΣC permanente por rebirth

  // Reiniciar progreso principal
  state.sig = 0;
  state.totalClicks = 0;
  state.activeFosoIndex = 0;
  state.battery = 100;
  state.maxBattery = 100;

  // Guardar y refrescar
  saveState();
  render();

  showToast(`✅ Hiciste Rebirth #${state.rebirths}! Ahora ganas x${state.rebirthBonus} ΣC permanentemente.`, "info");
});

function showToast(message, type = "info", duration = 3000) {
  const container = document.getElementById("toastContainer");
  if (!container) return;

  const toast = document.createElement("div");
  toast.textContent = message;

  // Estilos base
  toast.style.padding = "10px 16px";
  toast.style.borderRadius = "12px";
  toast.style.fontWeight = "bold";
  toast.style.color = "#fff";
  toast.style.boxShadow = "0 4px 10px rgba(0,0,0,0.3)";
  toast.style.opacity = "0";
  toast.style.transition = "opacity 0.3s, transform 0.3s";
  toast.style.transform = "translateY(-10px)";

  // Colores según tipo
  if (type === "success") toast.style.background = "#27ae60"; // verde
  else if (type === "error") toast.style.background = "#e74c3c"; // rojo
  else if (type === "warning") toast.style.background = "#f39c12"; // amarillo
  else toast.style.background = "#3498db"; // azul info

  container.appendChild(toast);

  // Mostrar con animación
  requestAnimationFrame(() => {
    toast.style.opacity = "1";
    toast.style.transform = "translateY(0)";
  });

  // Ocultar y borrar
  setTimeout(() => {
    toast.style.opacity = "0";
    toast.style.transform = "translateY(-10px)";
    setTimeout(() => toast.remove(), 300);
  }, duration);
}



// Configuración de AFK
const AFK_CONFIG = {
  baseReward: 1000,          // Nivel 0 → 1000 ΣC
  maxLevel: 10,
  maxReward: 100000          // Nivel 10 → 100000 ΣC
};

// Función para calcular recompensa según nivel
function getAfkReward(level) {
  if (level <= 0) return AFK_CONFIG.baseReward;
  const step = (AFK_CONFIG.maxReward - AFK_CONFIG.baseReward) / AFK_CONFIG.maxLevel;
  return Math.floor(AFK_CONFIG.baseReward + step * level);
}

// Renderizar info del modal
function renderAFK() {
  afkInfo.textContent = `Nivel AFK: ${state.afkLevel || 0} 
  • Recompensa/hora: ${getAfkReward(state.afkLevel || 0)} ΣC`;
}
renderAFK();

// Abrir modal
btnAFK?.addEventListener("click", () => {
  renderAFK();
  afkModal.classList.remove("hidden");
});

// Cerrar modal
afkModal.querySelector(".close-btn").addEventListener("click", () => {
  afkModal.classList.add("hidden");
});

// Mejorar AFK
// Mejorar AFK
btnUpgrade.addEventListener('click', () => {
  if (!window.state) window.state = {};
  const lvl = Number(window.state.afkLevel) || 0;
  const cost = 5000 * (lvl + 1);
  const sigmas = Number(window.state.sig) || 0; // 👈 forzamos a número

  if (sigmas < cost) {
    if (typeof showToast === 'function') {
      showToast('❌ No tienes suficientes ΣC', 'error');
    } else {
      alert('No tienes ΣC');
    }
    return;
  }

  // aplicar mejora
  window.state.sig = sigmas - cost;
  window.state.afkLevel = Math.min(10, lvl + 1);

  if (typeof saveState === 'function') saveState();
  if (typeof render === 'function') render();
  updateAFKInfo();

  if (typeof showToast === 'function') {
    showToast(`⬆️ AFK mejorado a nivel ${window.state.afkLevel}`, 'success');
  }
});


// Reclamar AFK
btnClaimAFK?.addEventListener("click", () => {
  const now = Date.now();
  const elapsedHours = (now - (state.afkLastClaim || now)) / (1000 * 60 * 60);
  if (elapsedHours < 1) {
    showToast("⏳ Espera al menos 1 hora para reclamar", "info");
    return;
  }
  const reward = getAfkReward(state.afkLevel || 0) * Math.floor(elapsedHours);
  state.sig += reward;
  state.afkLastClaim = now;
  saveState();
  render();
  showToast(`💰 Reclamas ${reward} ΣC por ${elapsedHours.toFixed(1)} horas AFK`, "info");
});


document.getElementById("btnAFK").removeAttribute("disabled");

console.log("---- DEBUG MEJORAR AFK ----");
console.log("Nivel actual:", lvl);
console.log("Costo de mejora:", cost);
console.log("Sigmas en state (raw):", window.state.sig);
console.log("Sigmas convertidos a número:", sigmas);
console.log("-----------------------------");
document.addEventListener("DOMContentLoaded", () => {
  const btnTest = document.getElementById("btnUpgradeAFK");
  console.log("Botón encontrado:", btnTest);

  if (btnTest) {
    btnTest.addEventListener("click", () => {
      console.log("✅ CLICK DETECTADO en Mejorar AFK");
    });
  }
});

function checkNotifications() {
  const now = Date.now();

  // --- Diario ---
  const nextDaily = state.nextDailyTime || 0;
  const dotDaily = document.getElementById("dotDaily");
  if (dotDaily) {
    if (now >= nextDaily) {
      dotDaily.classList.remove("hidden");
      showToast("🎁 ¡Tu regalo diario está listo!", "info");
    } else {
      dotDaily.classList.add("hidden");
    }
  }

  // --- AFK ---
  const last = state.afkLastClaim || now;
  const minutesElapsed = Math.floor((now - last) / (1000 * 60));
  const lvl = Number(state.afkLevel) || 0;
  const perHour = afkMaxPerHour(lvl);
  const blocks = Math.floor(minutesElapsed / 15);
  const reward = Math.max(0, blocks * (perHour / 4));
  const dotAFK = document.getElementById("dotAFK");

  if (dotAFK) {
    if (reward > 0) {
      dotAFK.classList.remove("hidden");
      showToast(`💰 Tienes ${reward.toLocaleString()} ΣC acumulados AFK`, "info");
    } else {
      dotAFK.classList.add("hidden");
    }
  }
}

// Ejecutar al inicio
document.addEventListener("DOMContentLoaded", checkNotifications);
// Repetir cada minuto
setInterval(checkNotifications, 60 * 1000);
document.getElementById("dotAFK")?.classList.add("hidden");
document.getElementById("dotDaily")?.classList.add("hidden");

  // --- A

function updateDailyStreak() {
  const streakEl = document.getElementById("dailyStreak");
  if (!streakEl) return;

  const streak = state.dailyStreak || 0;
  streakEl.textContent = streak;
}
state.batteryMax = state.batteryMax || 100; // valor base
battery = Math.min(state.batteryMax, battery + 1);
function updateBatteryText(value) {
  const batteryText = document.getElementById("batteryText");
  const clamped = Math.max(0, Math.min(state.batteryMax, value));
  batteryText.textContent = clamped + " / " + state.batteryMax;
}
state.batteryMax += 20; // aumenta capacidad
saveState();


// Cuando reclamas el diario
btnClaimDaily?.addEventListener("click", () => {
  state.dailyStreak = state.dailyStreak || 0;

  const today = new Date().toDateString();
  const last = state.lastDailyClaim || "";

  // si el último reclamo fue ayer → sumamos
  const yesterday = new Date(Date.now() - 86400000).toDateString();
  if (last === yesterday) {
    state.dailyStreak++;
  } else if (last !== today) {
    // si no fue ayer ni hoy → reiniciar
    state.dailyStreak = 1;
  }

  state.lastDailyClaim = today;

  if (typeof saveState === "function") saveState();
  updateDailyStreak();
});

function updateDailyStreakBox() {
  const streakEl = document.getElementById("dailyStreak");
  if (!streakEl) return;

  const streak = state.dailyStreak || 0;
  streakEl.textContent = streak;
}


document.addEventListener("DOMContentLoaded", () => {
  const today = new Date().toDateString();
  const yesterday = new Date(Date.now() - 86400000).toDateString();

  // Si no existe el contador → iniciar en 1
  if (!state.dailyStreak) {
    state.dailyStreak = 1;
    state.lastDailyLogin = today;
    console.log("🎉 Primera entrada → racha = 1");
  } else {
    // Si ya entraste hoy → no sumar
    if (state.lastDailyLogin === today) {
      console.log("⚠️ Ya entraste hoy, racha sin cambios:", state.dailyStreak);
    } else if (state.lastDailyLogin === yesterday) {
      // Si entraste ayer → sumamos 1
      state.dailyStreak++;
      state.lastDailyLogin = today;
      console.log("✅ Nueva entrada consecutiva, racha =", state.dailyStreak);
    } else {
      // Si no entraste ayer → reiniciamos a 1
      state.dailyStreak = 1;
      state.lastDailyLogin = today;
      console.log("🔄 Racha reiniciada = 1");
    }
  }

  if (typeof saveState === "function") saveState();
  updateDailyStreakBox();

  if (typeof showToast === "function") {
    showToast(`🔥 Racha actual: ${state.dailyStreak} días`, "success");
  }
});

document.addEventListener("DOMContentLoaded", () => {
  const today = new Date().toDateString();

  if (!state.dailyStreak) state.dailyStreak = 0;
  if (!state.lastDailyLogin) state.lastDailyLogin = null;

  if (state.lastDailyLogin !== today) {
    // Es un nuevo día
    if (state.lastDailyLogin) {
      const yesterday = new Date(Date.now() - 86400000).toDateString();
      if (state.lastDailyLogin === yesterday) {
        // Sumamos racha continua
        state.dailyStreak += 1;
      } else {
        // Reinicia si se saltó un día
        state.dailyStreak = 1;
      }
    } else {
      // Primera vez que juega → inicia en 1
      state.dailyStreak = 1;
    }

    state.lastDailyLogin = today;

    if (typeof saveState === "function") saveState();
  }

  // Crear el cuadro de racha si no existe
  let streakBox = document.getElementById("streakBox");
  if (!streakBox) {
    streakBox = document.createElement("div");
    streakBox.id = "streakBox";
    streakBox.style.position = "absolute";
    streakBox.style.top = "10px";
    streakBox.style.right = "10px";
    streakBox.style.background = "#222";
    streakBox.style.color = "#fff";
    streakBox.style.padding = "6px 10px";
    streakBox.style.borderRadius = "8px";
    streakBox.style.fontSize = "14px";
    streakBox.style.zIndex = "9999";
    document.body.appendChild(streakBox);
  }

  streakBox.textContent = `🔥 Racha: ${state.dailyStreak} días`;
});




</script>
<!-- FIN bloque reparación -->



</script>

</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  if (!window.state) window.state = {};

  const today = new Date().toDateString();
  const lastDay = state.lastStreakDay || null;

  if (!lastDay) {
    // Primera vez: empieza la racha en 1
    state.dailyStreak = 1;
    state.lastStreakDay = today;
  } else {
    if (lastDay !== today) {
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);

      if (lastDay === yesterday.toDateString()) {
        // Se conecta en días consecutivos → sumar racha
        state.dailyStreak = (state.dailyStreak || 0) + 1;
      } else {
        // Se rompió la racha → reiniciar
        state.dailyStreak = 1;
      }
      state.lastStreakDay = today;
    }
  }

  // Mostrar en el cuadro
  const el = document.getElementById("dailyStreak");
  if (el) el.textContent = state.dailyStreak;

  if (typeof saveState === "function") saveState();
});
</script>

<script>
// Cierre del modal mejorado
document.addEventListener('click', (e)=>{
  const btn = e.target.closest('[data-close]');
  if(btn){ document.getElementById('shopModal')?.classList.add('hidden'); }
});

// Códigos promocionales: x2 permanente si coincide la palabra clave (déjalo en blanco para que la pongas tú)
const PROMO_SECRET = ""; // <-- pon aquí la palabra clave de tu código
const promoInput = document.getElementById('promoInput');
const promoBtn = document.getElementById('promoBtn');
const promoMsg = document.getElementById('promoMsg');

function ensureState(){ if(!window.state) window.state = {}; }

promoBtn?.addEventListener('click', ()=>{
  ensureState();
  const code = (promoInput?.value || '').trim();
  if(!code){ promoMsg.textContent = 'Ingresa un código válido'; return; }
  if(!PROMO_SECRET){ promoMsg.textContent = 'Código no configurado aún.'; return; }
  if(code.toLowerCase() === PROMO_SECRET.toLowerCase()){
    state.permanentX2 = true;
    if(typeof saveState === 'function') saveState();
    promoMsg.textContent = '✅ Código aplicado: multiplicador x2 permanente activado.';
  } else {
    promoMsg.textContent = '❌ Código inválido';
  }
});

// Helper: aplicar multiplicador a contadores visibles si existe estado x2
function applyX2UI(){
  const perClickEl = document.getElementById('perClick');
  if(perClickEl){
    const base = Number(perClickEl.dataset.base || perClickEl.textContent || 1);
    perClickEl.dataset.base = String(base);
    perClickEl.textContent = state?.permanentX2 ? String(base * 2) : String(base);
  }
}
document.addEventListener('DOMContentLoaded', ()=> setTimeout(applyX2UI, 0));

// Estado inicial
state.fosos = state.fosos || [0]; // siempre tienes el primero gratis
state.equippedFoso = state.equippedFoso || 0;

// Comprar foso
function buyFoso(index, cost) {
  if (state.fosos.includes(index)) {
    // Ya comprado → solo equipar
    state.equippedFoso = index;
    saveState(); render();
    showToast("✅ Foso equipado", "success");
    return;
  }

  if (state.sig >= cost) {
    state.sig -= cost;
    state.fosos.push(index);
    state.equippedFoso = index;
    saveState(); render();
    showToast("🔥 Nuevo foso comprado y equipado", "success");
  } else {
    showToast("❌ No tienes suficientes ΣC", "error");
  }
}

let chargeInterval;

function toggleCharge() {
  if (charging) {
    clearInterval(chargeInterval);
    charging = false;
    showToast("🔋 Carga detenida", "info");
  } else {
    charging = true;
    chargeInterval = setInterval(() => {
      // 👉 Aquí estaba el bug: usabas un número fijo (100)
      if (state.battery < state.maxBattery) {
        state.battery++;
        saveState();
        render();
      } else {
        clearInterval(chargeInterval);
        charging = false;
        showToast("🔋 Batería completa", "success");
      }
    }, 500); // sube 1% cada medio segundo
  }
}
// --- Variables de batería ---





// Botón Cargar


// Botón Nuevo/Reparar Foso → reinicia batería
document.getElementById("btnNuevoFoso").addEventListener("click", () => {
  battery = maxBattery;
  
});

// Si compras mejora de batería (+50)
function upgradeBattery() {
  maxBattery += 50;
  battery = maxBattery;
  
}

// inicializar


// ================= BATERÍA ==================
if (!state.battery) ;
if (!state.maxBattery) state.maxBattery = 100;






// --- Botón Parar Carga (si lo tienes en tu HTML) ---
const btnParar = document.getElementById("btnParar");
if (btnParar) {
  btnParar.addEventListener("click", () => {
    if (chargingInterval) {
      clearInterval(chargingInterval);
      chargingInterval = null;
      isCharging = false;
    }
  });
}

// --- Botón Nuevo/Reparar Foso ---
document.getElementById("btnNuevoFoso").addEventListener("click", () => {
  state.battery = state.maxBattery;
  
  saveState();
});

// --- Upgrade batería ---
function upgradeBattery() {
  state.maxBattery += 50;
  state.battery = state.maxBattery;
  
  saveState();
}

// Hook batería al render global
const oldRender = render;
render = function() {
  oldRender();
  
};

// Inicializar



function updateBatteryText(value) {
  const batteryText = document.getElementById("batteryText");
  const clamped = Math.max(0, Math.min(100, value));
  batteryText.textContent = clamped + "%";
}


let charging = false;

document.getElementById("btnChargeToggle").addEventListener("click", () => { chargeBattery(); });




if (typeof upgrade !== "undefined" && upgrade === "battery_plus50") {
  state.batteryMax += 50;
  saveState();
  
}




</script>

<script>
// Eliminado bloque duplicado de carga para unificar la lógica


// === BATERÍA — módulo unificado ===
document.addEventListener("DOMContentLoaded", () => {
  // Estado inicial
  // Migración de claves antiguas para evitar desajustes (batteryMax → maxBattery)
  if (state && state.batteryMax != null && state.maxBattery == null) {
    state.maxBattery = state.batteryMax;
    try { if (typeof saveState === "function") saveState(); } catch {}
  }
  let battery = typeof state?.battery === "number" ? state.battery : 100;
  let maxBattery = typeof state?.maxBattery === "number" ? state.maxBattery : 100;
  if (battery > maxBattery) battery = maxBattery; // clamp si viniera corrupto

  let rechargeTimer = null;

  function saveBattery() {
    state.battery = battery;
    state.maxBattery = maxBattery;
    if (typeof saveState === "function") saveState();
  }

  function updateBatteryUI() {
    const el = document.getElementById("batteryText");
    if (el) el.textContent = Math.max(0, Math.min(100, battery)) + "%";
  }

  // Recarga manual (solo cuando pulsa Cargar). Velocidad depende de la capacidad.
  function startRecharge() {
    if (rechargeTimer) return;
    const baseMs = 600; // base más lenta
    const speedFactor = Math.max(0.4, 100 / maxBattery); // más capacidad → más rápido
    const intervalMs = Math.max(60, Math.floor(baseMs * speedFactor));
    rechargeTimer = setInterval(() => {
      if (battery < maxBattery) {
        battery++;
        updateBatteryUI();
        saveBattery();
      } else {
        clearInterval(rechargeTimer);
        rechargeTimer = null;
        // Auto cambiar etiqueta a "Cargar" cuando se llena
        const label = document.getElementById("chargeLabel");
        if (label) label.textContent = "Cargar";
      }
    }, intervalMs);
    const label = document.getElementById("chargeLabel");
    if (label) label.textContent = "Parar de cargar";
  }
  function stopRecharge(){
    if (rechargeTimer) { clearInterval(rechargeTimer); rechargeTimer = null; }
    const label = document.getElementById("chargeLabel");
    if (label) label.textContent = "Cargar";
  }

  // Consumo al hacer click en el foso (antes de otros listeners)
  const foso = document.getElementById("vaperWrap");
  if (foso) {
    foso.addEventListener(
      "click",
      (e) => {
        if (battery <= 0) {
          e.stopImmediatePropagation?.();
          if (typeof showToast === "function") showToast("🔋 Batería agotada", "warning");
          return;
        }
        battery = Math.max(0, battery - 1);
        updateBatteryUI();
        saveBattery();
        // La recarga es manual, no auto
      },
      { capture: true }
    );
  }

  // Mejora de batería accesible globalmente
  window.upgradeBattery = function () {
    maxBattery = Math.floor(maxBattery * 1.5);
    if (battery > maxBattery) battery = maxBattery;
    updateBatteryUI();
    saveBattery();
    if (typeof showToast === "function") showToast("🔋 Capacidad máxima: " + maxBattery + "%", "success");
    // Si estaba cargando, recalcula velocidad: parar y reiniciar
    if (rechargeTimer){ stopRecharge(); startRecharge(); }
  };

  // Inicializar UI
  updateBatteryUI();

  // Botón Cargar/Parar (toggle)
  document.getElementById("btnChargeToggle")?.addEventListener("click", () => {
    if (rechargeTimer) { stopRecharge(); } else { startRecharge(); }
  });

  // ==== Autoclicker ====
  const autoPointer = document.getElementById("autoClickPointer");
  let autoClickLevel = Number(state.autoClickerLevel || 0); // 0..10
  let autoClickActive = Boolean(state.autoClickerActive || false);
  let autoClickTimer = null;

  function saveAutoClickState(){
    state.autoClickerLevel = autoClickLevel;
    state.autoClickerActive = autoClickActive;
    if (typeof saveState === "function") saveState();
  }

  function autoClickIntervalMs(level){
    // Nivel 0: desactivado. 1..10: más nivel = más rápido.
    // 900ms/lv con piso de 80ms
    const base = 900;
    const ms = Math.max(80, Math.floor(base / Math.max(1, level)));
    return ms;
  }

  function performClick(){
    // Simula un click al foso si hay batería
    if (battery <= 0) return;
    // Efecto visual opcional del puntero
    if (autoPointer){
      autoPointer.classList.add("active");
      setTimeout(()=>autoPointer.classList.remove("active"), 120);
    }
    // Disminuir batería y propagar como un click normal
    battery = Math.max(0, battery - 1);
    updateBatteryUI();
    saveBattery();
    // Si existe una función global que otorga monedas por click, intenta llamarla
    try { if (typeof window.handleFosoClick === "function") window.handleFosoClick(); } catch {}
  }

  function startAutoClick(){
    if (autoClickActive || autoClickLevel <= 0) return;
    autoClickActive = true;
    const btn = document.getElementById("btnAutoClickToggle");
    if (btn) btn.textContent = "Autoclicker: On";
    autoClickTimer = setInterval(performClick, autoClickIntervalMs(autoClickLevel));
    saveAutoClickState();
  }
  function stopAutoClick(){
    if (!autoClickActive) return;
    autoClickActive = false;
    const btn = document.getElementById("btnAutoClickToggle");
    if (btn) btn.textContent = "Autoclicker: Off";
    if (autoClickTimer){ clearInterval(autoClickTimer); autoClickTimer = null; }
    saveAutoClickState();
  }
  function restartAutoClickIfNeeded(){
    if (!autoClickActive) return;
    if (autoClickTimer){ clearInterval(autoClickTimer); autoClickTimer = null; }
    autoClickTimer = setInterval(performClick, autoClickIntervalMs(autoClickLevel));
  }

  // Botones de autoclicker
  document.getElementById("btnAutoClickToggle")?.addEventListener("click", () => {
    if (!autoClickActive) startAutoClick(); else stopAutoClick();
  });
  document.getElementById("btnAutoClickUpgrade")?.addEventListener("click", () => {
    if (autoClickLevel < 10){
      autoClickLevel += 1;
      const lbl = document.getElementById("autoClickLevelLabel");
      if (lbl) lbl.textContent = String(autoClickLevel);
      saveAutoClickState();
      restartAutoClickIfNeeded();
    } else {
      if (typeof showToast === "function") showToast("Autoclicker ya está al nivel máximo (10)", "info");
    }
  });
  // Reflejar nivel inicial en la UI
  const levelLbl = document.getElementById("autoClickLevelLabel");
  if (levelLbl) levelLbl.textContent = String(Math.min(10, Math.max(0, autoClickLevel)));
  // Reflejar estado del toggle
  const toggleBtn = document.getElementById("btnAutoClickToggle");
  if (toggleBtn) toggleBtn.textContent = autoClickActive ? "Autoclicker: On" : "Autoclicker: Off";
});

</script>










<!-- Social bar -->
<nav class="social-bar" aria-label="Redes Sociales">
  <a href="https://x.com/sigmacompanyoficial" target="_blank" rel="noopener" aria-label="X (Twitter)">
    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
      <path d="M3 3l18 18M21 3L3 21"/>
    </svg>
  </a>
  <a href="https://instagram.com/sigmacompanyoficial" target="_blank" rel="noopener" aria-label="Instagram">
    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
      <rect x="3" y="3" width="18" height="18" rx="5"/>
      <circle cx="12" cy="12" r="4"/>
      <circle cx="17" cy="7" r="1"/>
    </svg>
  </a>
  <a href="https://www.tiktok.com/@sigmacompanyoficial" target="_blank" rel="noopener" aria-label="TikTok">
    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
      <path d="M9 3v10.5a3.5 3.5 0 1 1-3.5-3.5"/>
      <path d="M9 6.5c1.2 1.6 3.2 2.6 5.3 2.6v3.2c-2.6 0-4.6-1.1-5.3-2"/>
    </svg>
  </a>
  <a href="https://youtube.com/@sigmacompanyoficial" target="_blank" rel="noopener" aria-label="YouTube">
    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
      <rect x="3" y="6" width="18" height="12" rx="3"/>
      <path d="M11 10l4 2-4 2z" fill="currentColor" stroke="none"/>
    </svg>
  </a>
</nav>

</body>
</html>



